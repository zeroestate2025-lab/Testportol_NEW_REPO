{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\HP\\\\Downloads\\\\INTERVIEW PROCESS\\\\INTERVIEW PROCESS\\\\client\\\\src\\\\pages\\\\TestPage.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport API from \"../services/api\";\nimport \"../styles/TestPage.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function TestPage() {\n  _s();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const {\n    fullName,\n    email\n  } = location.state || {};\n  const [questions, setQuestions] = useState([]);\n  const [answers, setAnswers] = useState({});\n  const [currentIdx, setCurrentIdx] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [submitted, setSubmitted] = useState(false);\n  const [score, setScore] = useState(0);\n  const [resultSaved, setResultSaved] = useState(false);\n  const [testEnded, setTestEnded] = useState(false);\n  const [testNotStarted, setTestNotStarted] = useState(false);\n  const [errorMsg, setErrorMsg] = useState(\"\");\n  const [timeLeft, setTimeLeft] = useState(null);\n\n  // IMPORTANT: Fix for cancel popup blur issue\n  const [ignoreBlur, setIgnoreBlur] = useState(false);\n  const [initialDimensions, setInitialDimensions] = useState({\n    width: typeof window !== \"undefined\" ? window.outerWidth : 0,\n    height: typeof window !== \"undefined\" ? window.outerHeight : 0\n  });\n\n  // Load test controls and questions\n  useEffect(() => {\n    if (!fullName || !email) {\n      navigate(\"/\");\n      return;\n    }\n    const loadTest = async () => {\n      try {\n        var _qRes$data;\n        const controlRes = await API.testcontrol.get();\n        if (!(controlRes !== null && controlRes !== void 0 && controlRes.data)) {\n          setTestNotStarted(true);\n          setLoading(false);\n          return;\n        }\n        const {\n          isActive,\n          questionLimit,\n          timeLimit\n        } = controlRes.data;\n        if (!isActive) {\n          setTestNotStarted(true);\n          setLoading(false);\n          return;\n        }\n        const qRes = await API.questions.getAll();\n        if ((_qRes$data = qRes.data) !== null && _qRes$data !== void 0 && _qRes$data.error) {\n          setErrorMsg(qRes.data.error);\n          setTestNotStarted(true);\n          setLoading(false);\n          return;\n        }\n        const list = Array.isArray(qRes.data.questions) ? qRes.data.questions : Array.isArray(qRes.data) ? qRes.data : [];\n        if (!list.length) setErrorMsg(\"No questions available right now.\");\n        setQuestions(list.slice(0, questionLimit || list.length));\n        setTimeLeft((timeLimit || 30) * 60);\n      } catch (err) {\n        setErrorMsg(\"Could not load test. Check your backend connection.\");\n      } finally {\n        setLoading(false);\n      }\n    };\n    loadTest();\n  }, [fullName, email, navigate]);\n\n  // Countdown Timer\n  useEffect(() => {\n    if (timeLeft === null) return;\n    if (timeLeft <= 0) {\n      alert(\"‚è∞ Time‚Äôs up! Submitting automatically...\");\n      handleSubmit();\n      return;\n    }\n    const t = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\n    return () => clearTimeout(t);\n  }, [timeLeft]);\n\n  // Detect tab switch, minimize (via blur), and maximize via resize\n  useEffect(() => {\n    const handleTab = () => {\n      if (document.hidden) setTestEnded(true);\n    };\n    document.addEventListener(\"visibilitychange\", handleTab);\n\n    // FIXED blur handler (now respects ignoreBlur flag)\n    const handleBlur = () => {\n      if (!ignoreBlur) {\n        setTestEnded(true);\n      }\n    };\n    window.addEventListener(\"blur\", handleBlur);\n    return () => {\n      document.removeEventListener(\"visibilitychange\", handleTab);\n      window.removeEventListener(\"blur\", handleBlur);\n    };\n  }, [ignoreBlur]);\n\n  // Anti-cheat detection\n  useEffect(() => {\n    // MULTI-TAB\n    let bc;\n    try {\n      bc = new window.BroadcastChannel(\"anti_cheat_channel\");\n      bc.postMessage(\"active\");\n      bc.onmessage = msg => {\n        if (msg.data === \"active\") setTestEnded(true);\n      };\n    } catch (err) {\n      const tabId = `${Date.now()}_${Math.random().toString(36).slice(2)}`;\n      const key = `test_tab_${tabId}`;\n      try {\n        localStorage.setItem(key, String(Date.now()));\n      } catch (err) {}\n      const hb = setInterval(() => {\n        try {\n          localStorage.setItem(key, String(Date.now()));\n        } catch (err) {}\n      }, 2000);\n      const onStorage = e => {\n        if (!e.key) return;\n        if (e.key.startsWith(\"test_tab_\") && e.key !== key) setTestEnded(true);\n      };\n      window.addEventListener(\"storage\", onStorage);\n      window.addEventListener(\"beforeunload\", () => {\n        try {\n          localStorage.removeItem(key);\n        } catch (err) {}\n      });\n      return () => {\n        clearInterval(hb);\n        try {\n          localStorage.removeItem(key);\n        } catch (err) {}\n        window.removeEventListener(\"storage\", onStorage);\n      };\n    }\n\n    // BLOCK COPY/PASTE/CONTEXT MENU\n    const blockAndEnd = e => {\n      try {\n        if (e) e.preventDefault();\n      } catch (err) {}\n      setTestEnded(true);\n    };\n    const onCopy = e => blockAndEnd(e);\n    const onCut = e => blockAndEnd(e);\n    const onPaste = e => {\n      const tag = e.target && e.target.tagName || \"\";\n      if (tag === \"TEXTAREA\" || tag === \"INPUT\") return;\n      blockAndEnd(e);\n    };\n    const onContext = e => blockAndEnd(e);\n    document.addEventListener(\"copy\", onCopy);\n    document.addEventListener(\"cut\", onCut);\n    document.addEventListener(\"paste\", onPaste);\n    document.addEventListener(\"contextmenu\", onContext);\n\n    // Keyboard shortcuts\n    const onKey = e => {\n      const target = e.target || {};\n      const tag = target.tagName || \"\";\n      const isInput = tag === \"INPUT\" || tag === \"TEXTAREA\" || target.isContentEditable;\n      if ((e.ctrlKey || e.metaKey) && ([\"c\", \"x\", \"t\", \"n\"].includes((e.key || \"\").toLowerCase()) || !isInput && [\"v\", \"p\"].includes((e.key || \"\").toLowerCase()))) {\n        e.preventDefault();\n        setTestEnded(true);\n        return;\n      }\n      if (e.key === \"F12\" || e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"i\" || e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"c\") {\n        e.preventDefault();\n        setTestEnded(true);\n      }\n    };\n    window.addEventListener(\"keydown\", onKey, true);\n\n    // RESIZE\n    const initial = {\n      width: window.outerWidth,\n      height: window.outerHeight\n    };\n    setInitialDimensions(initial);\n    const handleResize = () => {\n      if (window.outerWidth === 0 && window.outerHeight === 0) {\n        setTestEnded(true);\n        return;\n      }\n      if (Math.abs(window.outerWidth - initial.width) > 5 || Math.abs(window.outerHeight - initial.height) > 5) {\n        setTestEnded(true);\n      }\n    };\n    window.addEventListener(\"resize\", handleResize);\n    return () => {\n      try {\n        if (bc) bc.close();\n      } catch (err) {}\n      document.removeEventListener(\"copy\", onCopy);\n      document.removeEventListener(\"cut\", onCut);\n      document.removeEventListener(\"paste\", onPaste);\n      document.removeEventListener(\"contextmenu\", onContext);\n      window.removeEventListener(\"keydown\", onKey, true);\n      window.removeEventListener(\"resize\", handleResize);\n    };\n  }, []);\n  const handleSelect = (id, val) => setAnswers({\n    ...answers,\n    [id]: val\n  });\n  const goNext = () => currentIdx < questions.length - 1 && setCurrentIdx(currentIdx + 1);\n  const goPrev = () => currentIdx > 0 && setCurrentIdx(currentIdx - 1);\n\n  // FIXED submit function with ignoreBlur\n  const handleSubmit = async () => {\n    if (submitted) return;\n    if (Object.keys(answers).length < questions.length) {\n      setIgnoreBlur(true); // Prevent blur ‚Üí testEnded\n\n      const ok = window.confirm(\"Some questions are unanswered. Submit anyway?\");\n      setIgnoreBlur(false); // Restore blur protection\n\n      if (!ok) return; // User cancelled\n    }\n    let s = 0;\n    questions.forEach(q => {\n      if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s++;\n    });\n    setScore(s);\n    setSubmitted(true);\n    const formatted = questions.map(q => ({\n      question: q.questionText,\n      userAnswer: answers[q._id] || \"Not answered\",\n      correctAnswer: q.correctAnswer || \"\",\n      isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\n      type: q.questionType\n    }));\n    try {\n      await API.tests.submit({\n        name: fullName,\n        email,\n        answers: formatted,\n        totalQuestions: questions.length,\n        correctAnswers: s,\n        scorePercent: (s / questions.length * 100).toFixed(2)\n      });\n      setResultSaved(true);\n    } catch (err) {\n      alert(\"Failed to save result to server.\");\n    }\n  };\n  if (testEnded) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container container-center text-center\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"text-danger\",\n      children: \"\\u26A0\\uFE0F Test Ended\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"You switched tabs, minimized, maximized, or resized the window.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-primary mt-3\",\n      onClick: () => navigate(\"/\"),\n      children: \"Go Home\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 285,\n    columnNumber: 7\n  }, this);\n  if (testNotStarted) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container container-center text-center\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"text-warning\",\n      children: \"\\u26A0\\uFE0F Test Not Active\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Waiting for admin to start the test... Please restore the page for sometime while\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 295,\n    columnNumber: 7\n  }, this);\n  if (errorMsg) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container container-center text-center\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"text-danger\",\n      children: \"\\u274C Error\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 303,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: errorMsg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 302,\n    columnNumber: 7\n  }, this);\n  if (loading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container container-center text-center\",\n    children: /*#__PURE__*/_jsxDEV(\"h5\", {\n      children: \"Loading questions\\u2026\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 309,\n    columnNumber: 7\n  }, this);\n  if (!questions.length) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container container-center text-center\",\n    children: /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"No questions available.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 315,\n    columnNumber: 7\n  }, this);\n  if (submitted && resultSaved) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container container-center text-center\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card card-clean p-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"text-success\",\n          children: \"\\uD83C\\uDF89 Thank You for Completing the Test!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: fullName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 13\n          }, this), \" (\", email, \")\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Your responses have been recorded successfully.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-primary mt-3\",\n          onClick: () => navigate(\"/\"),\n          children: \"Go to Home\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 7\n    }, this);\n  }\n  const currentQ = questions[currentIdx];\n  const selectedAnswer = answers[currentQ._id] || \"\";\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"test-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card test-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"test-header d-flex justify-content-between align-items-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n            className: \"text-danger fw-bold\",\n            children: [\"Candidate: \", fullName]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 345,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n            children: email\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"badge bg-primary me-2\",\n            children: [\"Q \", currentIdx + 1, \"/\", questions.length]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 349,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"badge bg-danger\",\n            children: [\"\\u23F3 \", Math.floor(timeLeft / 60), \":\", (timeLeft % 60).toString().padStart(2, \"0\")]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 352,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"test-body\",\n        children: [/*#__PURE__*/_jsxDEV(\"h6\", {\n          children: [/*#__PURE__*/_jsxDEV(\"b\", {\n            children: [\"Q\", currentIdx + 1, \":\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 359,\n            columnNumber: 13\n          }, this), \" \", currentQ.questionText]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 358,\n          columnNumber: 11\n        }, this), currentQ.questionType === \"MCQ\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"options-container\",\n          children: currentQ.options.map((opt, i) => /*#__PURE__*/_jsxDEV(\"label\", {\n            className: `option-item ${selectedAnswer === opt ? \"selected\" : \"\"}`,\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"radio\",\n              name: `question-${currentQ._id}`,\n              value: opt,\n              checked: selectedAnswer === opt,\n              onChange: e => handleSelect(currentQ._id, e.target.value)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 365,\n              columnNumber: 19\n            }, this), opt]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 364,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"textarea\", {\n          className: \"theory-input\",\n          placeholder: \"Type your answer...\",\n          value: selectedAnswer,\n          onChange: e => handleSelect(currentQ._id, e.target.value),\n          rows: 5\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 377,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 357,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"test-footer d-flex justify-content-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-secondary me-2\",\n            disabled: currentIdx === 0,\n            onClick: goPrev,\n            children: \"Previous\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 388,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-secondary\",\n            disabled: currentIdx === questions.length - 1,\n            onClick: goNext,\n            children: \"Next\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 391,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 387,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-success\",\n          onClick: handleSubmit,\n          children: \"Submit Test\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 399,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 386,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 341,\n    columnNumber: 5\n  }, this);\n}\n\n// import React, { useEffect, useState } from \"react\";\n// import { useLocation, useNavigate } from \"react-router-dom\";\n// import API from \"../services/api\";\n// import \"../styles/TestPage.css\";\n\n// export default function TestPage() {\n//   const location = useLocation();\n//   const navigate = useNavigate();\n//   const { fullName, email } = location.state || {};\n\n//   const [questions, setQuestions] = useState([]);\n//   const [answers, setAnswers] = useState({});\n//   const [currentIdx, setCurrentIdx] = useState(0);\n//   const [loading, setLoading] = useState(true);\n//   const [submitted, setSubmitted] = useState(false);\n//   const [score, setScore] = useState(0);\n//   const [resultSaved, setResultSaved] = useState(false);\n//   const [testEnded, setTestEnded] = useState(false);\n//   const [testNotStarted, setTestNotStarted] = useState(false);\n//   const [errorMsg, setErrorMsg] = useState(\"\");\n//   const [timeLeft, setTimeLeft] = useState(null);\n//   // For window resize detection\n//   const [initialDimensions, setInitialDimensions] = useState({\n//     width: typeof window !== \"undefined\" ? window.outerWidth : 0,\n//     height: typeof window !== \"undefined\" ? window.outerHeight : 0,\n//   });\n\n//   // Load test controls and questions\n//   useEffect(() => {\n//     if (!fullName || !email) {\n//       navigate(\"/\");\n//       return;\n//     }\n//     const loadTest = async () => {\n//       try {\n//         const controlRes = await API.testcontrol.get();\n//         if (!controlRes?.data) {\n//           setTestNotStarted(true);\n//           setLoading(false);\n//           return;\n//         }\n//         const { isActive, questionLimit, timeLimit } = controlRes.data;\n//         if (!isActive) {\n//           setTestNotStarted(true);\n//           setLoading(false);\n//           return;\n//         }\n//         const qRes = await API.questions.getAll();\n//         if (qRes.data?.error) {\n//           setErrorMsg(qRes.data.error);\n//           setTestNotStarted(true);\n//           setLoading(false);\n//           return;\n//         }\n//         const list = Array.isArray(qRes.data.questions)\n//           ? qRes.data.questions\n//           : Array.isArray(qRes.data)\n//           ? qRes.data\n//           : [];\n//         if (!list.length) setErrorMsg(\"No questions available right now.\");\n//         setQuestions(list.slice(0, questionLimit || list.length));\n//         setTimeLeft((timeLimit || 30) * 60);\n//       } catch (err) {\n//         setErrorMsg(\"Could not load test. Check your backend connection.\");\n//       } finally {\n//         setLoading(false);\n//       }\n//     };\n//     loadTest();\n//   }, [fullName, email, navigate]);\n\n//   // Countdown Timer\n//   useEffect(() => {\n//     if (timeLeft === null) return;\n//     if (timeLeft <= 0) {\n//       alert(\"‚è∞ Time‚Äôs up! Submitting automatically...\");\n//       handleSubmit();\n//       return;\n//     }\n//     const t = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\n//     return () => clearTimeout(t);\n//   }, [timeLeft]);\n\n//   // Detect tab switch, minimize (via blur), and maximize via resize\n//   useEffect(() => {\n//     const handleTab = () => {\n//       if (document.hidden) setTestEnded(true);\n//     };\n//     document.addEventListener(\"visibilitychange\", handleTab);\n\n//     // Extra: Detect minimize/focus loss\n//     const handleBlur = () => setTestEnded(true);\n//     window.addEventListener(\"blur\", handleBlur);\n\n//     return () => {\n//       document.removeEventListener(\"visibilitychange\", handleTab);\n//       window.removeEventListener(\"blur\", handleBlur);\n//     };\n//   }, []);\n\n//   // Anti-cheat: Multi-tab and window detection (BroadcastChannel and localStorage fallback), clipboard/shortcut/contextmenu blocking, window resizing\n//   useEffect(() => {\n//     // --- MULTI-TAB ---\n//     let bc;\n//     try {\n//       bc = new window.BroadcastChannel(\"anti_cheat_channel\");\n//       bc.postMessage(\"active\");\n//       bc.onmessage = (msg) => {\n//         if (msg.data === \"active\") setTestEnded(true);\n//       };\n//     } catch (err) {\n//       // fallback: localStorage\n//       const tabId = `${Date.now()}_${Math.random().toString(36).slice(2)}`;\n//       const key = `test_tab_${tabId}`;\n//       try { localStorage.setItem(key, String(Date.now())); } catch (err) {}\n//       const hb = setInterval(() => {\n//         try { localStorage.setItem(key, String(Date.now())); } catch (err) {}\n//       }, 2000);\n//       const onStorage = (e) => {\n//         if (!e.key) return;\n//         if (e.key.startsWith(\"test_tab_\") && e.key !== key) setTestEnded(true);\n//       };\n//       window.addEventListener(\"storage\", onStorage);\n//       window.addEventListener(\"beforeunload\", () => {\n//         try { localStorage.removeItem(key); } catch (err) {}\n//       });\n//       return () => {\n//         clearInterval(hb);\n//         try { localStorage.removeItem(key); } catch (err) {}\n//         window.removeEventListener(\"storage\", onStorage);\n//       };\n//     }\n\n//     // --- BLOCK CLIPBOARD/SHORTCUTS/CONTEXTMENU ---\n//     const blockAndEnd = (e) => {\n//       try { if (e) e.preventDefault(); } catch (err) {}\n//       setTestEnded(true);\n//     };\n//     const onCopy = (e) => blockAndEnd(e);\n//     const onCut = (e) => blockAndEnd(e);\n//     const onPaste = (e) => {\n//       // Allow paste in text input/textarea for theory questions if desired\n//       const tag = (e.target && e.target.tagName) || \"\";\n//       if (tag === \"TEXTAREA\" || tag === \"INPUT\") return;\n//       blockAndEnd(e);\n//     };\n//     const onContext = (e) => blockAndEnd(e);\n//     document.addEventListener(\"copy\", onCopy);\n//     document.addEventListener(\"cut\", onCut);\n//     document.addEventListener(\"paste\", onPaste);\n//     document.addEventListener(\"contextmenu\", onContext);\n\n//     // Keyboard shortcuts -- allow some in inputs only\n//     const onKey = (e) => {\n//       const target = e.target || {};\n//       const tag = target.tagName || \"\";\n//       const isInput = tag === \"INPUT\" || tag === \"TEXTAREA\" || target.isContentEditable;\n//       if (\n//         (e.ctrlKey || e.metaKey) &&\n//         (\n//           [\"c\", \"x\", \"t\", \"n\"].includes((e.key || \"\").toLowerCase()) ||\n//           (!isInput && [\"v\", \"p\"].includes((e.key || \"\").toLowerCase()))\n//         )\n//       ) {\n//         e.preventDefault();\n//         setTestEnded(true);\n//         return;\n//       }\n//       if (\n//         e.key === \"F12\" ||\n//         (e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"i\") ||\n//         (e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"c\")\n//       ) {\n//         e.preventDefault();\n//         setTestEnded(true);\n//       }\n//     };\n//     window.addEventListener(\"keydown\", onKey, true);\n\n//     // --- WINDOW RESIZE / MAXIMIZE / MINIMIZE / SNAP ---\n//     // Store initial dimensions for comparison (already state)\n//     const initial = { width: window.outerWidth, height: window.outerHeight };\n//     setInitialDimensions(initial);\n\n//     const handleResize = () => {\n//       // If minimized, outerWidth/outerHeight may be zero\n//       if (window.outerWidth === 0 && window.outerHeight === 0) {\n//         setTestEnded(true);\n//         return;\n//       }\n//       // End test if resized away from initial size (can allow margin if you wish)\n//       if (\n//         Math.abs(window.outerWidth - initial.width) > 5 ||\n//         Math.abs(window.outerHeight - initial.height) > 5\n//       ) {\n//         setTestEnded(true);\n//       }\n//     };\n//     window.addEventListener(\"resize\", handleResize);\n\n//     return () => {\n//       try { if (bc) bc.close(); } catch (err) {}\n//       document.removeEventListener(\"copy\", onCopy);\n//       document.removeEventListener(\"cut\", onCut);\n//       document.removeEventListener(\"paste\", onPaste);\n//       document.removeEventListener(\"contextmenu\", onContext);\n//       window.removeEventListener(\"keydown\", onKey, true);\n//       window.removeEventListener(\"resize\", handleResize);\n//     };\n//   }, []);\n\n//   const handleSelect = (id, val) => setAnswers({ ...answers, [id]: val });\n//   const goNext = () => currentIdx < questions.length - 1 && setCurrentIdx(currentIdx + 1);\n//   const goPrev = () => currentIdx > 0 && setCurrentIdx(currentIdx - 1);\n\n//   const handleSubmit = async () => {\n//     if (submitted) return;\n//     if (Object.keys(answers).length < questions.length) {\n//       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\n//     }\n//     let s = 0;\n//     questions.forEach((q) => {\n//       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s++;\n//     });\n//     setScore(s);\n//     setSubmitted(true);\n//     const formatted = questions.map((q) => ({\n//       question: q.questionText,\n//       userAnswer: answers[q._id] || \"Not answered\",\n//       correctAnswer: q.correctAnswer || \"\",\n//       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\n//       type: q.questionType,\n//     }));\n//     try {\n//       await API.tests.submit({\n//         name: fullName,\n//         email,\n//         answers: formatted,\n//         totalQuestions: questions.length,\n//         correctAnswers: s,\n//         scorePercent: ((s / questions.length) * 100).toFixed(2),\n//       });\n//       setResultSaved(true);\n//     } catch (err) {\n//       alert(\"Failed to save result to server.\");\n//     }\n//   };\n\n//   if (testEnded)\n//     return (\n//       <div className=\"container container-center text-center\">\n//         <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\n//         <p>You switched tabs, minimized, maximized, or resized the window.</p>\n//         <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\n//           Go Home\n//         </button>\n//       </div>\n//     );\n//   if (testNotStarted)\n//     return (\n//       <div className=\"container container-center text-center\">\n//         <h3 className=\"text-warning\">‚ö†Ô∏è Test Not Active</h3>\n//         <p>Waiting for admin to start the test... Please restore the page for sometime while</p>\n//       </div>\n//     );\n//   if (errorMsg)\n//     return (\n//       <div className=\"container container-center text-center\">\n//         <h3 className=\"text-danger\">‚ùå Error</h3>\n//         <p>{errorMsg}</p>\n//       </div>\n//     );\n//   if (loading)\n//     return (\n//       <div className=\"container container-center text-center\">\n//         <h5>Loading questions‚Ä¶</h5>\n//       </div>\n//     );\n//   if (!questions.length)\n//     return (\n//       <div className=\"container container-center text-center\">\n//         <p>No questions available.</p>\n//       </div>\n//     );\n\n//   if (submitted && resultSaved) {\n//     return (\n//       <div className=\"container container-center text-center\">\n//         <div className=\"card card-clean p-4\">\n//           <h3 className=\"text-success\">üéâ Thank You for Completing the Test!</h3>\n//           <p>\n//             <strong>{fullName}</strong> ({email})\n//           </p>\n//           <p>Your responses have been recorded successfully.</p>\n//           <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\n//             Go to Home\n//           </button>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   const currentQ = questions[currentIdx];\n//   const selectedAnswer = answers[currentQ._id] || \"\";\n\n//   return (\n//     <div className=\"test-container\">\n//       <div className=\"card test-card\">\n//         <div className=\"test-header d-flex justify-content-between align-items-center\">\n//           <div>\n//             <h5 className=\"text-danger fw-bold\">Candidate: {fullName}</h5>\n//             <small>{email}</small>\n//           </div>\n//           <div>\n//             <span className=\"badge bg-primary me-2\">\n//               Q {currentIdx + 1}/{questions.length}\n//             </span>\n//             <span className=\"badge bg-danger\">\n//               ‚è≥ {Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, \"0\")}\n//             </span>\n//           </div>\n//         </div>\n//         <div className=\"test-body\">\n//           <h6>\n//             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\n//           </h6>\n//           {currentQ.questionType === \"MCQ\" ? (\n//             <div className=\"options-container\">\n//               {currentQ.options.map((opt, i) => (\n//                 <label key={i} className={`option-item ${selectedAnswer === opt ? \"selected\" : \"\"}`}>\n//                   <input\n//                     type=\"radio\"\n//                     name={`question-${currentQ._id}`}\n//                     value={opt}\n//                     checked={selectedAnswer === opt}\n//                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n//                   />\n//                   {opt}\n//                 </label>\n//               ))}\n//             </div>\n//           ) : (\n//             <textarea\n//               className=\"theory-input\"\n//               placeholder=\"Type your answer...\"\n//               value={selectedAnswer}\n//               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n//               rows={5}\n//             />\n//           )}\n//         </div>\n//         <div className=\"test-footer d-flex justify-content-between\">\n//           <div>\n//             <button className=\"btn btn-secondary me-2\" disabled={currentIdx === 0} onClick={goPrev}>\n//               Previous\n//             </button>\n//             <button\n//               className=\"btn btn-secondary\"\n//               disabled={currentIdx === questions.length - 1}\n//               onClick={goNext}\n//             >\n//               Next\n//             </button>\n//           </div>\n//           <button className=\"btn btn-success\" onClick={handleSubmit}>\n//             Submit Test\n//           </button>\n//         </div>\n//       </div>\n//     </div>\n//   );\n// }\n\n// // import React, { useEffect, useState, useRef } from \"react\";\n// // import { useLocation, useNavigate } from \"react-router-dom\";\n// // import API from \"../services/api\";\n// // import \"../styles/TestPage.css\";\n\n// // export default function TestPage() {\n// //   const location = useLocation();\n// //   const navigate = useNavigate();\n// //   const { fullName, email } = location.state || {};\n\n// //   const [questions, setQuestions] = useState([]);\n// //   const [answers, setAnswers] = useState({});\n// //   const [currentIdx, setCurrentIdx] = useState(0);\n// //   const [loading, setLoading] = useState(true);\n// //   const [submitted, setSubmitted] = useState(false);\n// //   const [score, setScore] = useState(0);\n// //   const [resultSaved, setResultSaved] = useState(false);\n// //   const [testEnded, setTestEnded] = useState(false);\n// //   const [testNotStarted, setTestNotStarted] = useState(false);\n// //   const [errorMsg, setErrorMsg] = useState(\"\");\n// //   const [timeLeft, setTimeLeft] = useState(null);\n\n// //   // ‚úÖ Step 1 ‚Äî Load test control and questions\n// //   useEffect(() => {\n// //     if (!fullName || !email) {\n// //       navigate(\"/\");\n// //       return;\n// //     }\n\n// //     const loadTest = async () => {\n// //       console.log(\"üü¢ Step 1: Fetching /api/testcontrol ...\");\n// //       try {\n// //         const controlRes = await API.testcontrol.get();\n// //         console.log(\"‚úÖ Test Control Response:\", controlRes.data);\n\n// //         if (!controlRes?.data) {\n// //           console.log(\"‚ùå No test control found in DB\");\n// //           setTestNotStarted(true);\n// //           setLoading(false);\n// //           return;\n// //         }\n\n// //         const { isActive, questionLimit, timeLimit } = controlRes.data;\n\n// //         if (!isActive) {\n// //           console.log(\"‚ö†Ô∏è Test inactive. Waiting for admin to start...\");\n// //           setTestNotStarted(true);\n// //           setLoading(false);\n// //           return;\n// //         }\n\n// //         console.log(\"üü¢ Test is active. Now fetching questions...\");\n// //         const qRes = await API.questions.getAll();\n// //         console.log(\"‚úÖ Questions Response:\", qRes.data);\n\n// //         if (qRes.data?.error) {\n// //           console.log(\"‚ö†Ô∏è Backend says:\", qRes.data.error);\n// //           setErrorMsg(qRes.data.error);\n// //           setTestNotStarted(true);\n// //           setLoading(false);\n// //           return;\n// //         }\n\n// //         const list = Array.isArray(qRes.data.questions)\n// //           ? qRes.data.questions\n// //           : Array.isArray(qRes.data)\n// //           ? qRes.data\n// //           : [];\n\n// //         console.log(`üß© Loaded ${list.length} questions`);\n\n// //         if (!list.length) {\n// //           setErrorMsg(\"No questions available right now.\");\n// //         }\n\n// //         setQuestions(list.slice(0, questionLimit || list.length));\n// //         setTimeLeft((timeLimit || 30) * 60);\n// //       } catch (err) {\n// //         console.error(\"‚ùå Error fetching control/questions:\", err);\n// //         setErrorMsg(\"Could not load test. Check your backend connection.\");\n// //       } finally {\n// //         setLoading(false);\n// //         console.log(\"üü£ Finished loadTest()\");\n// //       }\n// //     };\n\n// //     loadTest();\n// //   }, [fullName, email, navigate]);\n\n// //   // ‚è± Countdown timer\n// //   useEffect(() => {\n// //     if (timeLeft === null) return;\n// //     if (timeLeft <= 0) {\n// //       alert(\"‚è∞ Time‚Äôs up! Submitting automatically...\");\n// //       handleSubmit();\n// //       return;\n// //     }\n// //     const t = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\n// //     return () => clearTimeout(t);\n// //   }, [timeLeft]);\n\n// //   // üö´ Detect tab switch\n// //   useEffect(() => {\n// //     const handleTab = () => {\n// //       if (document.hidden) setTestEnded(true);\n// //     };\n// //     document.addEventListener(\"visibilitychange\", handleTab);\n// //     return () => document.removeEventListener(\"visibilitychange\", handleTab);\n// //   }, []);\n\n// //   // üö® Anti-cheat: multi-tab detection, clipboard & shortcut blocking, contextmenu disable\n// //   useEffect(() => {\n// //     // unique id for this tab\n// //     const tabId = `${Date.now()}_${Math.random().toString(36).slice(2)}`;\n// //     const key = `test_tab_${tabId}`;\n// //     // write an initial heartbeat entry for this tab\n// //     try {\n// //       localStorage.setItem(key, String(Date.now()));\n// //     } catch (err) {\n// //       console.warn(\"localStorage unavailable:\", err);\n// //     }\n\n// //     // heartbeat to mark this tab as alive (so other tabs can detect it)\n// //     const hb = setInterval(() => {\n// //       try {\n// //         localStorage.setItem(key, String(Date.now()));\n// //       } catch (err) {\n// //         /* ignore */\n// //       }\n// //     }, 2000);\n\n// //     // storage event: fired on other tabs when localStorage changes ‚Äî if we see another tab key, end the test\n// //     const onStorage = (e) => {\n// //       if (!e.key) return;\n// //       // another tab created/updated a test_tab entry\n// //       if (e.key.startsWith(\"test_tab_\") && e.key !== key) {\n// //         console.warn(\"Detected another tab/window running the test:\", e.key);\n// //         setTestEnded(true);\n// //       }\n// //       // if a tab was removed and only this remains, no action needed here\n// //     };\n\n// //     window.addEventListener(\"storage\", onStorage);\n\n// //     // block copy/cut/paste/contextmenu and suspicious shortcuts ‚Äî end test when attempted\n// //     const blockAndEnd = (e) => {\n// //       try {\n// //         if (e) e.preventDefault();\n// //       } catch (err) {}\n// //       console.warn(\"Blocked action while test active - ending test.\");\n// //       setTestEnded(true);\n// //     };\n\n// //     const onCopy = (e) => blockAndEnd(e);\n// //     const onCut = (e) => blockAndEnd(e);\n// //     const onPaste = (e) => blockAndEnd(e);\n// //     const onContext = (e) => {\n// //       // prevent right click and consider as suspicious\n// //       blockAndEnd(e);\n// //     };\n\n// //     document.addEventListener(\"copy\", onCopy);\n// //     document.addEventListener(\"cut\", onCut);\n// //     document.addEventListener(\"paste\", onPaste);\n// //     document.addEventListener(\"contextmenu\", onContext);\n\n// //     // block keyboard shortcuts that could be used to copy or open new tabs/devtools\n// //     const onKey = (e) => {\n// //       const target = e.target || {};\n// //       const tag = target.tagName || \"\";\n// //       const isInput = tag === \"INPUT\" || tag === \"TEXTAREA\" || target.isContentEditable;\n\n// //       // allow normal typing inside inputs/textareas\n// //       if (isInput) return;\n\n// //       // suspicious combos\n// //       if ((e.ctrlKey || e.metaKey) && [\"c\", \"x\", \"v\", \"p\", \"t\", \"n\"].includes((e.key || \"\").toLowerCase())) {\n// //         e.preventDefault();\n// //         setTestEnded(true);\n// //         return;\n// //       }\n\n// //       // devtools keys\n// //       if (e.key === \"F12\" || (e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"i\") || (e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"c\")) {\n// //         e.preventDefault();\n// //         setTestEnded(true);\n// //       }\n// //     };\n\n// //     window.addEventListener(\"keydown\", onKey, true);\n\n// //     // cleanup on unload\n// //     const cleanup = () => {\n// //       try {\n// //         localStorage.removeItem(key);\n// //       } catch (err) {}\n// //     };\n\n// //     window.addEventListener(\"beforeunload\", cleanup);\n\n// //     return () => {\n// //       clearInterval(hb);\n// //       try {\n// //         localStorage.removeItem(key);\n// //       } catch (err) {}\n// //       window.removeEventListener(\"storage\", onStorage);\n// //       document.removeEventListener(\"copy\", onCopy);\n// //       document.removeEventListener(\"cut\", onCut);\n// //       document.removeEventListener(\"paste\", onPaste);\n// //       document.removeEventListener(\"contextmenu\", onContext);\n// //       window.removeEventListener(\"keydown\", onKey, true);\n// //       window.removeEventListener(\"beforeunload\", cleanup);\n// //     };\n// //   }, []);\n\n// //   const handleSelect = (id, val) => setAnswers({ ...answers, [id]: val });\n// //   const goNext = () => currentIdx < questions.length - 1 && setCurrentIdx(currentIdx + 1);\n// //   const goPrev = () => currentIdx > 0 && setCurrentIdx(currentIdx - 1);\n\n// //   const handleSubmit = async () => {\n// //     if (submitted) return;\n// //     if (Object.keys(answers).length < questions.length) {\n// //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\n// //     }\n\n// //     let s = 0;\n// //     questions.forEach((q) => {\n// //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s++;\n// //     });\n// //     setScore(s);\n// //     setSubmitted(true);\n\n// //     const formatted = questions.map((q) => ({\n// //       question: q.questionText,\n// //       userAnswer: answers[q._id] || \"Not answered\",\n// //       correctAnswer: q.correctAnswer || \"\",\n// //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\n// //       type: q.questionType,\n// //     }));\n\n// //     try {\n// //       await API.tests.submit({\n// //         name: fullName,\n// //         email,\n// //         answers: formatted,\n// //         totalQuestions: questions.length,\n// //         correctAnswers: s,\n// //         scorePercent: ((s / questions.length) * 100).toFixed(2),\n// //       });\n// //       setResultSaved(true);\n// //     } catch (err) {\n// //       console.error(\"‚ùå Error saving result:\", err);\n// //       alert(\"Failed to save result to server.\");\n// //     }\n// //   };\n\n// //   // ‚ö†Ô∏è If user switched tab\n// //   if (testEnded)\n// //     return (\n// //       <div className=\"container container-center text-center\">\n// //         <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\n// //         <p>You switched tabs or reloaded.</p>\n// //         <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\n// //           Go Home\n// //         </button>\n// //       </div>\n// //     );\n\n// //   // ‚ö†Ô∏è Test Not Started\n// //   if (testNotStarted)\n// //     return (\n// //       <div className=\"container container-center text-center\">\n// //         <h3 className=\"text-warning\">‚ö†Ô∏è Test Not Active</h3>\n// //         <p>Waiting for admin to start the test... Please restore the page for sometime while</p>\n// //         {/* <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\n// //           Back to Home\n// //         </button> */}\n// //       </div>\n// //     );\n\n// //   // ‚ùå Error\n// //   if (errorMsg)\n// //     return (\n// //       <div className=\"container container-center text-center\">\n// //         <h3 className=\"text-danger\">‚ùå Error</h3>\n// //         <p>{errorMsg}</p>\n// //       </div>\n// //     );\n\n// //   // ‚è≥ Loading\n// //   if (loading)\n// //     return (\n// //       <div className=\"container container-center text-center\">\n// //         <h5>Loading questions‚Ä¶</h5>\n// //       </div>\n// //     );\n\n// //   if (!questions.length)\n// //     return (\n// //       <div className=\"container container-center text-center\">\n// //         <p>No questions available.</p>\n// //       </div>\n// //     );\n\n// //     // ‚úÖ After submitting show thank-you message\n// // if (submitted && resultSaved) {\n// //   return (\n// //     <div className=\"container container-center text-center\">\n// //       <div className=\"card card-clean p-4\">\n// //         <h3 className=\"text-success\">üéâ Thank You for Completing the Test!</h3>\n// //         <p>\n// //           <strong>{fullName}</strong> ({email})\n// //         </p>\n// //         <p>Your responses have been recorded successfully.</p>\n// //         <button\n// //           className=\"btn btn-primary mt-3\"\n// //           onClick={() => navigate(\"/\")}\n// //         >\n// //           Go to Home\n// //         </button>\n// //       </div>\n// //     </div>\n// //   );\n// // }\n\n// //   // ‚úÖ Main Test View\n// //   const currentQ = questions[currentIdx];\n// //   const selectedAnswer = answers[currentQ._id] || \"\";\n\n// //   return (\n// //     <div className=\"test-container\">\n// //       <div className=\"card test-card\">\n// //         <div className=\"test-header d-flex justify-content-between align-items-center\">\n// //           <div>\n// //             <h5 className=\"text-danger fw-bold\">Candidate: {fullName}</h5>\n// //             <small>{email}</small>\n// //           </div>\n// //           <div>\n// //             <span className=\"badge bg-primary me-2\">\n// //               Q {currentIdx + 1}/{questions.length}\n// //             </span>\n// //             <span className=\"badge bg-danger\">\n// //               ‚è≥ {Math.floor(timeLeft / 60)}:\n// //               {(timeLeft % 60).toString().padStart(2, \"0\")}\n// //             </span>\n// //           </div>\n// //         </div>\n\n// //         <div className=\"test-body\">\n// //           <h6>\n// //             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\n// //           </h6>\n\n// //           {currentQ.questionType === \"MCQ\" ? (\n// //             <div className=\"options-container\">\n// //               {currentQ.options.map((opt, i) => (\n// //                 <label key={i} className={`option-item ${selectedAnswer === opt ? \"selected\" : \"\"}`}>\n// //                   <input\n// //                     type=\"radio\"\n// //                     name={`question-${currentQ._id}`}\n// //                     value={opt}\n// //                     checked={selectedAnswer === opt}\n// //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// //                   />\n// //                   {opt}\n// //                 </label>\n// //               ))}\n// //             </div>\n// //           ) : (\n// //             <textarea\n// //               className=\"theory-input\"\n// //               placeholder=\"Type your answer...\"\n// //               value={selectedAnswer}\n// //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// //               rows={5}\n// //             />\n// //           )}\n// //         </div>\n\n// //         <div className=\"test-footer d-flex justify-content-between\">\n// //           <div>\n// //             <button className=\"btn btn-secondary me-2\" disabled={currentIdx === 0} onClick={goPrev}>\n// //               Previous\n// //             </button>\n// //             <button\n// //               className=\"btn btn-secondary\"\n// //               disabled={currentIdx === questions.length - 1}\n// //               onClick={goNext}\n// //             >\n// //               Next\n// //             </button>\n// //           </div>\n// //           <button className=\"btn btn-success\" onClick={handleSubmit}>\n// //             Submit Test\n// //           </button>\n// //         </div>\n// //       </div>\n// //     </div>\n// //   );\n// // }\n\n// // // import React, { useEffect, useState } from \"react\";\n// // // import { useLocation, useNavigate } from \"react-router-dom\";\n// // // import API from \"../services/api\";\n// // // import \"../styles/TestPage.css\";\n\n// // // export default function TestPage() {\n// // //   const location = useLocation();\n// // //   const navigate = useNavigate();\n// // //   const { fullName, email } = location.state || {};\n\n// // //   const [questions, setQuestions] = useState([]);\n// // //   const [answers, setAnswers] = useState({});\n// // //   const [currentIdx, setCurrentIdx] = useState(0);\n// // //   const [loading, setLoading] = useState(true);\n// // //   const [submitted, setSubmitted] = useState(false);\n// // //   const [score, setScore] = useState(0);\n// // //   const [resultSaved, setResultSaved] = useState(false);\n// // //   const [testEnded, setTestEnded] = useState(false);\n// // //   const [testNotStarted, setTestNotStarted] = useState(false);\n// // //   const [errorMsg, setErrorMsg] = useState(\"\");\n// // //   const [timeLeft, setTimeLeft] = useState(null);\n\n// // //   // üß© Step 1: Load test control ‚Üí questions\n// // //   useEffect(() => {\n// // //     if (!fullName || !email) {\n// // //       navigate(\"/\");\n// // //       return;\n// // //     }\n\n// // //     const loadTest = async () => {\n// // //       console.log(\"üü¢ Loading test control...\");\n// // //       try {\n// // //         const controlRes = await API.testcontrol.get();\n// // //         console.log(\"‚úÖ Test control response:\", controlRes.data);\n\n// // //         if (!controlRes?.data) {\n// // //           console.log(\"‚ùå No control data found\");\n// // //           setTestNotStarted(true);\n// // //           setLoading(false);\n// // //           return;\n// // //         }\n\n// // //         const { isActive, questionLimit, timeLimit } = controlRes.data;\n\n// // //         if (!isActive) {\n// // //           console.log(\"‚ö†Ô∏è Test is inactive (waiting for admin)\");\n// // //           setTestNotStarted(true);\n// // //           setLoading(false);\n// // //           return;\n// // //         }\n\n// // //         console.log(\"üü¢ Test is active, fetching questions...\");\n// // //         const qRes = await API.questions.getAll();\n// // //         console.log(\"‚úÖ Questions response:\", qRes.data);\n\n// // //         if (qRes.data?.error) {\n// // //           console.log(\"‚ö†Ô∏è Backend says:\", qRes.data.error);\n// // //           setTestNotStarted(true);\n// // //           setLoading(false);\n// // //           return;\n// // //         }\n\n// // //         const questionsList = Array.isArray(qRes.data.questions)\n// // //           ? qRes.data.questions\n// // //           : Array.isArray(qRes.data)\n// // //           ? qRes.data\n// // //           : [];\n\n// // //         console.log(\"üß© Questions loaded:\", questionsList.length);\n\n// // //         if (!questionsList.length) {\n// // //           setErrorMsg(\"No questions found. Contact admin.\");\n// // //         }\n\n// // //         setQuestions(questionsList.slice(0, questionLimit || questionsList.length));\n// // //         setTimeLeft((timeLimit || 30) * 60);\n// // //       } catch (err) {\n// // //         console.error(\"‚ùå Error during loadTest():\", err);\n// // //         setErrorMsg(\"Failed to fetch test details.\");\n// // //       } finally {\n// // //         console.log(\"üü£ Finished loading test data\");\n// // //         setLoading(false);\n// // //       }\n// // //     };\n\n// // //     loadTest();\n// // //   }, [fullName, email, navigate]);\n\n// // //   // üïí Countdown\n// // //   useEffect(() => {\n// // //     if (timeLeft === null) return;\n// // //     if (timeLeft <= 0) {\n// // //       alert(\"‚è∞ Time‚Äôs up! Submitting automatically.\");\n// // //       handleSubmit();\n// // //       return;\n// // //     }\n// // //     const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\n// // //     return () => clearTimeout(timer);\n// // //   }, [timeLeft]);\n\n// // //   // üö´ Prevent tab switch\n// // //   useEffect(() => {\n// // //     const handleVisibility = () => {\n// // //       if (document.hidden) setTestEnded(true);\n// // //     };\n// // //     document.addEventListener(\"visibilitychange\", handleVisibility);\n// // //     return () => document.removeEventListener(\"visibilitychange\", handleVisibility);\n// // //   }, []);\n\n// // //   const handleSelect = (id, value) => {\n// // //     setAnswers({ ...answers, [id]: value });\n// // //   };\n\n// // //   const goNext = () => currentIdx < questions.length - 1 && setCurrentIdx(currentIdx + 1);\n// // //   const goPrev = () => currentIdx > 0 && setCurrentIdx(currentIdx - 1);\n\n// // //   const handleSubmit = async () => {\n// // //     if (submitted) return;\n// // //     if (Object.keys(answers).length < questions.length) {\n// // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\n// // //     }\n\n// // //     let s = 0;\n// // //     questions.forEach((q) => {\n// // //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s++;\n// // //     });\n// // //     setScore(s);\n// // //     setSubmitted(true);\n\n// // //     const formatted = questions.map((q) => ({\n// // //       question: q.questionText,\n// // //       userAnswer: answers[q._id] || \"Not answered\",\n// // //       correctAnswer: q.correctAnswer || \"\",\n// // //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\n// // //       type: q.questionType,\n// // //     }));\n\n// // //     try {\n// // //       await API.tests.submit({\n// // //         name: fullName,\n// // //         email,\n// // //         answers: formatted,\n// // //         totalQuestions: questions.length,\n// // //         correctAnswers: s,\n// // //         scorePercent: ((s / questions.length) * 100).toFixed(2),\n// // //       });\n// // //       setResultSaved(true);\n// // //     } catch (err) {\n// // //       console.error(\"Error saving result:\", err);\n// // //       alert(\"Failed to save result to server.\");\n// // //     }\n// // //   };\n\n// // //   // ‚ö†Ô∏è Test Ended\n// // //   if (testEnded)\n// // //     return (\n// // //       <div className=\"container container-center text-center\">\n// // //         <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\n// // //         <p>You left or reloaded the page.</p>\n// // //         <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\n// // //           Go Home\n// // //         </button>\n// // //       </div>\n// // //     );\n\n// // //   // ‚ö†Ô∏è Test Not Started\n// // //   if (testNotStarted)\n// // //     return (\n// // //       <div className=\"container container-center text-center\">\n// // //         <h3 className=\"text-warning\">‚ö†Ô∏è Test Not Active</h3>\n// // //         <p>Waiting for admin to start the test.</p>\n// // //         <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\n// // //           Back to Home\n// // //         </button>\n// // //       </div>\n// // //     );\n\n// // //   // ‚ùå Error state\n// // //   if (errorMsg)\n// // //     return (\n// // //       <div className=\"container container-center text-center\">\n// // //         <h3 className=\"text-danger\">‚ùå Error</h3>\n// // //         <p>{errorMsg}</p>\n// // //         <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\n// // //           Go to Home\n// // //         </button>\n// // //       </div>\n// // //     );\n\n// // //   // ‚è≥ Loading\n// // //   if (loading)\n// // //     return (\n// // //       <div className=\"container container-center text-center\">\n// // //         <h5>Loading questions‚Ä¶</h5>\n// // //       </div>\n// // //     );\n\n// // //   if (!questions.length)\n// // //     return (\n// // //       <div className=\"container container-center text-center\">\n// // //         <p>No questions available.</p>\n// // //       </div>\n// // //     );\n\n// // //   // ‚úÖ Active Test Screen\n// // //   const currentQ = questions[currentIdx];\n// // //   const selectedAnswer = answers[currentQ._id] || \"\";\n\n// // //   return (\n// // //     <div className=\"test-container\">\n// // //       <div className=\"card test-card\">\n// // //         <div className=\"test-header d-flex justify-content-between align-items-center\">\n// // //           <div>\n// // //             <h5 className=\"text-danger fw-bold\">Candidate: {fullName}</h5>\n// // //             <small>{email}</small>\n// // //           </div>\n// // //           <div>\n// // //             <span className=\"badge bg-primary me-2\">\n// // //               Q {currentIdx + 1}/{questions.length}\n// // //             </span>\n// // //             <span className=\"badge bg-danger\">\n// // //               ‚è≥ {Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, \"0\")}\n// // //             </span>\n// // //           </div>\n// // //         </div>\n\n// // //         <div className=\"test-body\">\n// // //           <h6>\n// // //             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\n// // //           </h6>\n\n// // //           {currentQ.questionType === \"MCQ\" ? (\n// // //             <div className=\"options-container\">\n// // //               {currentQ.options.map((opt, i) => (\n// // //                 <label\n// // //                   key={i}\n// // //                   className={`option-item ${selectedAnswer === opt ? \"selected\" : \"\"}`}\n// // //                 >\n// // //                   <input\n// // //                     type=\"radio\"\n// // //                     name={`question-${currentQ._id}`}\n// // //                     value={opt}\n// // //                     checked={selectedAnswer === opt}\n// // //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// // //                   />\n// // //                   {opt}\n// // //                 </label>\n// // //               ))}\n// // //             </div>\n// // //           ) : (\n// // //             <textarea\n// // //               className=\"theory-input\"\n// // //               placeholder=\"Type your answer here...\"\n// // //               value={selectedAnswer}\n// // //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// // //               rows={5}\n// // //             />\n// // //           )}\n// // //         </div>\n\n// // //         <div className=\"test-footer d-flex justify-content-between\">\n// // //           <div>\n// // //             <button className=\"btn btn-secondary me-2\" disabled={currentIdx === 0} onClick={goPrev}>\n// // //               Previous\n// // //             </button>\n// // //             <button\n// // //               className=\"btn btn-secondary\"\n// // //               disabled={currentIdx === questions.length - 1}\n// // //               onClick={goNext}\n// // //             >\n// // //               Next\n// // //             </button>\n// // //           </div>\n// // //           <button className=\"btn btn-success\" onClick={handleSubmit}>\n// // //             Submit Test\n// // //           </button>\n// // //         </div>\n// // //       </div>\n// // //     </div>\n// // //   );\n// // // }\n\n// // // // import React, { useEffect, useState } from \"react\";\n// // // // import { useLocation, useNavigate } from \"react-router-dom\";\n// // // // import API from \"../services/api\";\n// // // // import \"../styles/TestPage.css\";\n\n// // // // export default function TestPage() {\n// // // //   const location = useLocation();\n// // // //   const navigate = useNavigate();\n// // // //   const { fullName, email } = location.state || {};\n\n// // // //   const [questions, setQuestions] = useState([]);\n// // // //   const [answers, setAnswers] = useState({});\n// // // //   const [currentIdx, setCurrentIdx] = useState(0);\n// // // //   const [loading, setLoading] = useState(true);\n// // // //   const [submitted, setSubmitted] = useState(false);\n// // // //   const [score, setScore] = useState(0);\n// // // //   const [resultSaved, setResultSaved] = useState(false);\n// // // //   const [testEnded, setTestEnded] = useState(false);\n// // // //   const [testNotStarted, setTestNotStarted] = useState(false);\n// // // //   const [timeLeft, setTimeLeft] = useState(null);\n\n// // // //   // üü¢ Fetch test control and questions only when test is active\n// // // //   useEffect(() => {\n// // // //     if (!fullName || !email) {\n// // // //       navigate(\"/\");\n// // // //       return;\n// // // //     }\n\n// // // //     const initTest = async () => {\n// // // //       try {\n// // // //         // 1Ô∏è‚É£ Fetch test control first\n// // // //         const controlRes = await API.testcontrol.get();\n// // // //         const control = controlRes.data;\n\n// // // //         if (!control || !control.isActive) {\n// // // //           setTestNotStarted(true);\n// // // //           setLoading(false);\n// // // //           return;\n// // // //         }\n\n// // // //         // 2Ô∏è‚É£ Fetch all questions\n// // // //         const questionRes = await API.questions.getAll();\n// // // //         const allQuestions = Array.isArray(questionRes.data)\n// // // //           ? questionRes.data\n// // // //           : [];\n\n// // // //         // 3Ô∏è‚É£ Limit number of questions from admin config\n// // // //         const limitedQuestions = allQuestions.slice(0, control.questionLimit || allQuestions.length);\n\n// // // //         setQuestions(limitedQuestions);\n// // // //         setTimeLeft((control.timeLimit || 10) * 60); // Convert minutes to seconds\n// // // //       } catch (err) {\n// // // //         console.error(\"‚ùå Error initializing test:\", err);\n// // // //         setTestNotStarted(true);\n// // // //       } finally {\n// // // //         setLoading(false);\n// // // //       }\n// // // //     };\n\n// // // //     initTest();\n// // // //   }, [fullName, email, navigate]);\n\n// // // //   // üïí Countdown timer\n// // // //   useEffect(() => {\n// // // //     if (timeLeft === null) return;\n// // // //     if (timeLeft <= 0) {\n// // // //       alert(\"‚è∞ Time‚Äôs up! Submitting your test automatically.\");\n// // // //       handleSubmit();\n// // // //       return;\n// // // //     }\n\n// // // //     const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\n// // // //     return () => clearTimeout(timer);\n// // // //   }, [timeLeft]);\n\n// // // //   // üõë Detect tab switch, reload, or page exit\n// // // //   useEffect(() => {\n// // // //     const handleBeforeUnload = (e) => {\n// // // //       e.preventDefault();\n// // // //       e.returnValue = \"\";\n// // // //       setTestEnded(true);\n// // // //     };\n\n// // // //     const handleVisibilityChange = () => {\n// // // //       if (document.hidden) {\n// // // //         setTestEnded(true);\n// // // //       }\n// // // //     };\n\n// // // //     window.addEventListener(\"beforeunload\", handleBeforeUnload);\n// // // //     document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n\n// // // //     return () => {\n// // // //       window.removeEventListener(\"beforeunload\", handleBeforeUnload);\n// // // //       document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n// // // //     };\n// // // //   }, []);\n\n// // // //   const handleSelect = (questionId, value) => {\n// // // //     setAnswers({ ...answers, [questionId]: value });\n// // // //   };\n\n// // // //   const goNext = () => {\n// // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\n// // // //   };\n// // // //   const goPrev = () => {\n// // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\n// // // //   };\n\n// // // //   const handleSubmit = async () => {\n// // // //     if (submitted) return;\n// // // //     if (Object.keys(answers).length < questions.length) {\n// // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\n// // // //     }\n\n// // // //     let s = 0;\n// // // //     questions.forEach((q) => {\n// // // //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s += 1;\n// // // //     });\n// // // //     setScore(s);\n// // // //     setSubmitted(true);\n\n// // // //     const formattedAnswers = questions.map((q) => ({\n// // // //       question: q.questionText,\n// // // //       userAnswer: answers[q._id] || \"Not answered\",\n// // // //       correctAnswer: q.correctAnswer || \"\",\n// // // //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\n// // // //       type: q.questionType || \"Theory\",\n// // // //     }));\n\n// // // //     try {\n// // // //       await API.tests.submit({\n// // // //         name: fullName,\n// // // //         email,\n// // // //         answers: formattedAnswers,\n// // // //         totalQuestions: questions.length,\n// // // //         correctAnswers: s,\n// // // //         scorePercent: ((s / questions.length) * 100).toFixed(2),\n// // // //       });\n// // // //       setResultSaved(true);\n// // // //     } catch (err) {\n// // // //       console.error(\"Error saving result:\", err);\n// // // //       alert(\"Failed to save result to server.\");\n// // // //     }\n// // // //   };\n\n// // // //   // üõë If user switched tab or reloaded\n// // // //   if (testEnded) {\n// // // //     return (\n// // // //       <div className=\"container container-center\">\n// // // //         <div className=\"card card-clean p-4 text-center\">\n// // // //           <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\n// // // //           <p>Your session ended because you switched tabs or reloaded.</p>\n// // // //           <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\n// // // //             Go to Home\n// // // //           </button>\n// // // //         </div>\n// // // //       </div>\n// // // //     );\n// // // //   }\n\n// // // //   // üõë If test not started\n// // // //   if (testNotStarted) {\n// // // //     return (\n// // // //       <div className=\"container container-center\">\n// // // //         <div className=\"card card-clean p-4 text-center\">\n// // // //           <h3 className=\"text-warning\">‚ö†Ô∏è Test Not Active</h3>\n// // // //           <p>The test has not been started by admin yet.</p>\n// // // //           <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\n// // // //             Back to Home\n// // // //           </button>\n// // // //         </div>\n// // // //       </div>\n// // // //     );\n// // // //   }\n\n// // // //   // üü¢ Loading\n// // // //   if (loading)\n// // // //     return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\n\n// // // //   if (!questions || questions.length === 0)\n// // // //     return <div className=\"container container-center\">No questions available.</div>;\n\n// // // //   // üü¢ After submit\n// // // //   if (submitted) {\n// // // //     return (\n// // // //       <div className=\"container container-center\">\n// // // //         <div className=\"card card-clean p-4\">\n// // // //           <h3 className=\"text-success\">‚úÖ Test Completed</h3>\n// // // //           <p>\n// // // //             <strong>{fullName}</strong> ({email})\n// // // //           </p>\n// // // //           <h4>\n// // // //             Your Score: {score} / {questions.length}\n// // // //           </h4>\n\n// // // //           {resultSaved && (\n// // // //             <div className=\"alert alert-success mt-2\">\n// // // //               ‚úÖ Your result has been recorded successfully!\n// // // //             </div>\n// // // //           )}\n\n// // // //           <hr />\n// // // //           <h5>Review Answers</h5>\n// // // //           <div>\n// // // //             {questions.map((q, idx) => (\n// // // //               <div className=\"review-question\" key={q._id}>\n// // // //                 <b>Q{idx + 1}:</b> {q.questionText}\n// // // //                 <div>\n// // // //                   Your answer:{\" \"}\n// // // //                   <span\n// // // //                     className={\n// // // //                       q.questionType === \"MCQ\"\n// // // //                         ? answers[q._id] === q.correctAnswer\n// // // //                           ? \"text-success\"\n// // // //                           : \"text-danger\"\n// // // //                         : \"text-primary\"\n// // // //                     }\n// // // //                   >\n// // // //                     {answers[q._id] || \"Not answered\"}\n// // // //                   </span>\n// // // //                 </div>\n// // // //                 {q.questionType === \"MCQ\" && (\n// // // //                   <div>\n// // // //                     Correct answer:{\" \"}\n// // // //                     <span className=\"text-success\">{q.correctAnswer}</span>\n// // // //                   </div>\n// // // //                 )}\n// // // //               </div>\n// // // //             ))}\n// // // //           </div>\n\n// // // //           <div className=\"mt-4\">\n// // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>\n// // // //               Back to Home\n// // // //             </button>\n// // // //             <button\n// // // //               className=\"btn btn-outline-secondary\"\n// // // //               onClick={() => window.location.reload()}\n// // // //             >\n// // // //               Retake Test\n// // // //             </button>\n// // // //           </div>\n// // // //         </div>\n// // // //       </div>\n// // // //     );\n// // // //   }\n\n// // // //   // üü¢ Active test page\n// // // //   const currentQ = questions[currentIdx];\n// // // //   const selectedAnswer = answers[currentQ._id] || \"\";\n\n// // // //   return (\n// // // //     <div className=\"test-container\">\n// // // //       <div className=\"card test-card\">\n// // // //         <div className=\"test-header\">\n// // // //           <div>\n// // // //             <h5 className=\"text-danger fw-bold\">Candidate: {fullName}</h5>\n// // // //             <small className=\"text-muted\">{email}</small>\n// // // //           </div>\n// // // //           <div>\n// // // //             <span className=\"badge bg-primary me-2\">\n// // // //               Question {currentIdx + 1} / {questions.length}\n// // // //             </span>\n// // // //             <span className=\"badge bg-danger\">\n// // // //               ‚è≥ {Math.floor(timeLeft / 60)}:\n// // // //               {(timeLeft % 60).toString().padStart(2, \"0\")}\n// // // //             </span>\n// // // //           </div>\n// // // //         </div>\n\n// // // //         <div className=\"test-body\">\n// // // //           <h6 className=\"question-text\">\n// // // //             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\n// // // //           </h6>\n\n// // // //           {currentQ.questionType === \"MCQ\" && currentQ.options?.length > 0 ? (\n// // // //             <div className=\"options-container\">\n// // // //               {currentQ.options.map((opt, i) => (\n// // // //                 <label\n// // // //                   key={i}\n// // // //                   className={`option-item ${\n// // // //                     selectedAnswer === opt ? \"selected\" : \"\"\n// // // //                   }`}\n// // // //                 >\n// // // //                   <input\n// // // //                     type=\"radio\"\n// // // //                     name={`question-${currentQ._id}`}\n// // // //                     value={opt}\n// // // //                     checked={selectedAnswer === opt}\n// // // //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// // // //                   />\n// // // //                   {opt}\n// // // //                 </label>\n// // // //               ))}\n// // // //             </div>\n// // // //           ) : (\n// // // //             <textarea\n// // // //               className=\"theory-input\"\n// // // //               placeholder=\"Type your answer here...\"\n// // // //               value={selectedAnswer}\n// // // //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// // // //               rows={5}\n// // // //             ></textarea>\n// // // //           )}\n// // // //         </div>\n\n// // // //         <div className=\"test-footer\">\n// // // //           <div>\n// // // //             <button\n// // // //               className=\"btn btn-secondary me-3\"\n// // // //               onClick={goPrev}\n// // // //               disabled={currentIdx === 0}\n// // // //             >\n// // // //               Previous\n// // // //             </button>\n// // // //             <button\n// // // //               className=\"btn btn-secondary\"\n// // // //               onClick={goNext}\n// // // //               disabled={currentIdx === questions.length - 1}\n// // // //             >\n// // // //               Next\n// // // //             </button>\n// // // //           </div>\n\n// // // //           <div>\n// // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>\n// // // //               Submit Test\n// // // //             </button>\n// // // //           </div>\n// // // //         </div>\n// // // //       </div>\n// // // //     </div>\n// // // //   );\n// // // // }\n\n// // // // // import React, { useEffect, useState } from \"react\";\n// // // // // import { useLocation, useNavigate } from \"react-router-dom\";\n// // // // // import API from \"../services/api\";\n// // // // // import \"../styles/TestPage.css\";\n\n// // // // // export default function TestPage() {\n// // // // //   const location = useLocation();\n// // // // //   const navigate = useNavigate();\n// // // // //   const { fullName, email } = location.state || {};\n\n// // // // //   const [questions, setQuestions] = useState([]);\n// // // // //   const [answers, setAnswers] = useState({});\n// // // // //   const [currentIdx, setCurrentIdx] = useState(0);\n// // // // //   const [loading, setLoading] = useState(true);\n// // // // //   const [submitted, setSubmitted] = useState(false);\n// // // // //   const [score, setScore] = useState(0);\n// // // // //   const [resultSaved, setResultSaved] = useState(false);\n// // // // //   const [testEnded, setTestEnded] = useState(false);\n// // // // //   const [testNotStarted, setTestNotStarted] = useState(false);\n// // // // //   const [timeLeft, setTimeLeft] = useState(null);\n\n// // // // //   // üü¢ Fetch questions only when test is active\n// // // // //   useEffect(() => {\n// // // // //     if (!fullName || !email) {\n// // // // //       navigate(\"/\");\n// // // // //       return;\n// // // // //     }\n\n// // // // //     const fetchQuestions = async () => {\n// // // // //       try {\n// // // // //         const res = await API.questions.getAll();\n\n// // // // //         // üõë If test is not active\n// // // // //         if (res.data?.error || !res.data?.isActive) {\n// // // // //           setTestNotStarted(true);\n// // // // //           setLoading(false);\n// // // // //           return;\n// // // // //         }\n\n// // // // //         const questionsArray = Array.isArray(res.data)\n// // // // //           ? res.data\n// // // // //           : res.data.questions || [];\n\n// // // // //         setQuestions(questionsArray);\n// // // // //         setTimeLeft((res.data.timeLimit || 10) * 60); // Convert minutes ‚Üí seconds\n// // // // //       } catch (err) {\n// // // // //         console.error(err);\n// // // // //         alert(\"Failed to fetch questions. Please wait for admin to start the test.\");\n// // // // //         setTestNotStarted(true);\n// // // // //       } finally {\n// // // // //         setLoading(false);\n// // // // //       }\n// // // // //     };\n\n// // // // //     fetchQuestions();\n// // // // //   }, [fullName, email, navigate]);\n\n// // // // //   // üïí Countdown timer\n// // // // //   useEffect(() => {\n// // // // //     if (timeLeft === null) return;\n// // // // //     if (timeLeft <= 0) {\n// // // // //       alert(\"‚è∞ Time‚Äôs up! Submitting your test automatically.\");\n// // // // //       handleSubmit();\n// // // // //       return;\n// // // // //     }\n\n// // // // //     const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\n// // // // //     return () => clearTimeout(timer);\n// // // // //   }, [timeLeft]);\n\n// // // // //   // üõë Detect tab switch, reload, or page exit\n// // // // //   useEffect(() => {\n// // // // //     const handleBeforeUnload = (e) => {\n// // // // //       e.preventDefault();\n// // // // //       e.returnValue = \"\";\n// // // // //       setTestEnded(true);\n// // // // //     };\n\n// // // // //     const handleVisibilityChange = () => {\n// // // // //       if (document.hidden) {\n// // // // //         setTestEnded(true);\n// // // // //       }\n// // // // //     };\n\n// // // // //     window.addEventListener(\"beforeunload\", handleBeforeUnload);\n// // // // //     document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n\n// // // // //     return () => {\n// // // // //       window.removeEventListener(\"beforeunload\", handleBeforeUnload);\n// // // // //       document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n// // // // //     };\n// // // // //   }, []);\n\n// // // // //   // üü¢ Select answer\n// // // // //   const handleSelect = (questionId, value) => {\n// // // // //     setAnswers({ ...answers, [questionId]: value });\n// // // // //   };\n\n// // // // //   // üü¢ Navigation\n// // // // //   const goNext = () => {\n// // // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\n// // // // //   };\n// // // // //   const goPrev = () => {\n// // // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\n// // // // //   };\n\n// // // // //   // üü¢ Submit handler\n// // // // //   const handleSubmit = async () => {\n// // // // //     if (submitted) return; // Prevent multiple submits\n// // // // //     if (Object.keys(answers).length < questions.length) {\n// // // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\n// // // // //     }\n\n// // // // //     // Calculate score (for MCQs only)\n// // // // //     let s = 0;\n// // // // //     questions.forEach((q) => {\n// // // // //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s += 1;\n// // // // //     });\n\n// // // // //     setScore(s);\n// // // // //     setSubmitted(true);\n\n// // // // //     const formattedAnswers = questions.map((q) => ({\n// // // // //       question: q.questionText,\n// // // // //       userAnswer: answers[q._id] || \"Not answered\",\n// // // // //       correctAnswer: q.correctAnswer || \"\",\n// // // // //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\n// // // // //       type: q.questionType || \"Theory\",\n// // // // //     }));\n\n// // // // //     try {\n// // // // //       await API.tests.submit({\n// // // // //         name: fullName,\n// // // // //         email,\n// // // // //         answers: formattedAnswers,\n// // // // //         totalQuestions: questions.length,\n// // // // //         correctAnswers: s,\n// // // // //         scorePercent: ((s / questions.length) * 100).toFixed(2),\n// // // // //       });\n// // // // //       setResultSaved(true);\n// // // // //     } catch (err) {\n// // // // //       console.error(\"Error saving result:\", err);\n// // // // //       alert(\"Failed to save result to server.\");\n// // // // //     }\n// // // // //   };\n\n// // // // //   // üõë If user switched tab or reloaded\n// // // // //   if (testEnded) {\n// // // // //     return (\n// // // // //       <div className=\"container container-center\">\n// // // // //         <div className=\"card card-clean p-4 text-center\">\n// // // // //           <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\n// // // // //           <p>Your session ended because you switched tabs, reloaded, or left the page.</p>\n// // // // //           <h4 className=\"mt-3 text-success\">Thank you for your time!</h4>\n// // // // //           <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\n// // // // //             Go to Home\n// // // // //           </button>\n// // // // //         </div>\n// // // // //       </div>\n// // // // //     );\n// // // // //   }\n\n// // // // //   // üõë If test not started\n// // // // //   if (testNotStarted) {\n// // // // //     return (\n// // // // //       <div className=\"container container-center\">\n// // // // //         <div className=\"card card-clean p-4 text-center\">\n// // // // //           <h3 className=\"text-warning\">‚ö†Ô∏è Test Not Active</h3>\n// // // // //           <p>The test has not been started by admin yet.</p>\n// // // // //           <h5 className=\"mt-2\">Please contact the administrator to begin your test.</h5>\n// // // // //           <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\n// // // // //             Back to Home\n// // // // //           </button>\n// // // // //         </div>\n// // // // //       </div>\n// // // // //     );\n// // // // //   }\n\n// // // // //   // üü¢ Loading\n// // // // //   if (loading) return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\n// // // // //   if (!questions || questions.length === 0)\n// // // // //     return <div className=\"container container-center\">No questions available. Please try later.</div>;\n\n// // // // //   // üü¢ After submit (Review screen)\n// // // // //   if (submitted) {\n// // // // //     return (\n// // // // //       <div className=\"container container-center\">\n// // // // //         <div className=\"card card-clean p-4\">\n// // // // //           <h3 className=\"text-success\">Test Completed Successfully</h3>\n// // // // //           <p>\n// // // // //             <strong>{fullName}</strong> ({email})\n// // // // //           </p>\n// // // // //           <h4>\n// // // // //             Your Score: {score} / {questions.length}\n// // // // //           </h4>\n\n// // // // //           {resultSaved && (\n// // // // //             <div className=\"alert alert-success mt-2\">\n// // // // //               ‚úÖ Your result has been recorded successfully!\n// // // // //             </div>\n// // // // //           )}\n\n// // // // //           <hr />\n// // // // //           <h5>Review Answers</h5>\n// // // // //           <div>\n// // // // //             {questions.map((q, idx) => (\n// // // // //               <div className=\"review-question\" key={q._id}>\n// // // // //                 <b>Q{idx + 1}:</b> {q.questionText}\n// // // // //                 <div>\n// // // // //                   Your answer:{\" \"}\n// // // // //                   <span\n// // // // //                     className={\n// // // // //                       q.questionType === \"MCQ\"\n// // // // //                         ? answers[q._id] === q.correctAnswer\n// // // // //                           ? \"text-success\"\n// // // // //                           : \"text-danger\"\n// // // // //                         : \"text-primary\"\n// // // // //                     }\n// // // // //                   >\n// // // // //                     {answers[q._id] || \"Not answered\"}\n// // // // //                   </span>\n// // // // //                 </div>\n// // // // //                 {q.questionType === \"MCQ\" && (\n// // // // //                   <div>\n// // // // //                     Correct answer:{\" \"}\n// // // // //                     <span className=\"text-success\">{q.correctAnswer}</span>\n// // // // //                   </div>\n// // // // //                 )}\n// // // // //               </div>\n// // // // //             ))}\n// // // // //           </div>\n\n// // // // //           <div className=\"mt-4\">\n// // // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>\n// // // // //               Back to Home\n// // // // //             </button>\n// // // // //             <button className=\"btn btn-outline-secondary\" onClick={() => window.location.reload()}>\n// // // // //               Retake Test\n// // // // //             </button>\n// // // // //           </div>\n// // // // //         </div>\n// // // // //       </div>\n// // // // //     );\n// // // // //   }\n\n// // // // //   // üü¢ Active test page\n// // // // //   const currentQ = questions[currentIdx];\n// // // // //   const selectedAnswer = answers[currentQ._id] || \"\";\n\n// // // // //   return (\n// // // // //     <div className=\"test-container\">\n// // // // //       <div className=\"card test-card\">\n// // // // //         <div className=\"test-header\">\n// // // // //           <div>\n// // // // //             <h5 className=\"text-danger fw-bold\">Candidate: {fullName}</h5>\n// // // // //             <small className=\"text-muted\">{email}</small>\n// // // // //           </div>\n// // // // //           <div>\n// // // // //             <span className=\"badge bg-primary me-2\">\n// // // // //               Question {currentIdx + 1} / {questions.length}\n// // // // //             </span>\n// // // // //             <span className=\"badge bg-danger\">\n// // // // //               ‚è≥ {Math.floor(timeLeft / 60)}:\n// // // // //               {(timeLeft % 60).toString().padStart(2, \"0\")}\n// // // // //             </span>\n// // // // //           </div>\n// // // // //         </div>\n\n// // // // //         <div className=\"test-body\">\n// // // // //           <h6 className=\"question-text\">\n// // // // //             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\n// // // // //           </h6>\n\n// // // // //           {currentQ.questionType === \"MCQ\" && currentQ.options?.length > 0 ? (\n// // // // //             <div className=\"options-container\">\n// // // // //               {currentQ.options.map((opt, i) => (\n// // // // //                 <label\n// // // // //                   key={i}\n// // // // //                   className={`option-item ${\n// // // // //                     selectedAnswer === opt ? \"selected\" : \"\"\n// // // // //                   }`}\n// // // // //                 >\n// // // // //                   <input\n// // // // //                     type=\"radio\"\n// // // // //                     name={`question-${currentQ._id}`}\n// // // // //                     value={opt}\n// // // // //                     checked={selectedAnswer === opt}\n// // // // //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// // // // //                   />\n// // // // //                   {opt}\n// // // // //                 </label>\n// // // // //               ))}\n// // // // //             </div>\n// // // // //           ) : (\n// // // // //             <textarea\n// // // // //               className=\"theory-input\"\n// // // // //               placeholder=\"Type your answer here...\"\n// // // // //               value={selectedAnswer}\n// // // // //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// // // // //               rows={5}\n// // // // //             ></textarea>\n// // // // //           )}\n// // // // //         </div>\n\n// // // // //         <div className=\"test-footer\">\n// // // // //           <div>\n// // // // //             <button\n// // // // //               className=\"btn btn-secondary me-3\"\n// // // // //               onClick={goPrev}\n// // // // //               disabled={currentIdx === 0}\n// // // // //             >\n// // // // //               Previous\n// // // // //             </button>\n// // // // //             <button\n// // // // //               className=\"btn btn-secondary\"\n// // // // //               onClick={goNext}\n// // // // //               disabled={currentIdx === questions.length - 1}\n// // // // //             >\n// // // // //               Next\n// // // // //             </button>\n// // // // //           </div>\n\n// // // // //           <div>\n// // // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>\n// // // // //               Submit Test\n// // // // //             </button>\n// // // // //           </div>\n// // // // //         </div>\n// // // // //       </div>\n// // // // //     </div>\n// // // // //   );\n// // // // // }\n\n// // // // // import React, { useEffect, useState } from \"react\";\n// // // // // import { useLocation, useNavigate } from \"react-router-dom\";\n// // // // // import API from \"../services/api\";\n// // // // // import \"../styles/TestPage.css\";\n\n// // // // // function pickRandom(arr, n) {\n// // // // //   const copy = [...arr];\n// // // // //   const res = [];\n// // // // //   while (res.length < n && copy.length > 0) {\n// // // // //     const idx = Math.floor(Math.random() * copy.length);\n// // // // //     res.push(copy.splice(idx, 1)[0]);\n// // // // //   }\n// // // // //   return res;\n// // // // // }\n\n// // // // // export default function TestPage() {\n// // // // //   const location = useLocation();\n// // // // //   const navigate = useNavigate();\n// // // // //   const { fullName, email, numQ } = location.state || {};\n\n// // // // //   const [allQuestions, setAllQuestions] = useState([]);\n// // // // //   const [questions, setQuestions] = useState([]);\n// // // // //   const [answers, setAnswers] = useState({});\n// // // // //   const [currentIdx, setCurrentIdx] = useState(0);\n// // // // //   const [loading, setLoading] = useState(true);\n// // // // //   const [submitted, setSubmitted] = useState(false);\n// // // // //   const [score, setScore] = useState(0);\n// // // // //   const [resultSaved, setResultSaved] = useState(false);\n// // // // //   const [testEnded, setTestEnded] = useState(false); // üÜï detect tab switch/reload\n// // // // //   const [timeLeft, setTimeLeft] = useState(null);\n\n// // // // //   // üü¢ Fetch questions\n// // // // //   useEffect(() => {\n// // // // //     if (!fullName || !email) {\n// // // // //       navigate(\"/\");\n// // // // //       return;\n// // // // //     }\n\n// // // // //     const fetchQuestions = async () => {\n// // // // //   try {\n// // // // //     const res = await API.questions.getAll();\n// // // // //     if (res.data.error) {\n// // // // //       alert(res.data.error);\n// // // // //       navigate(\"/\");\n// // // // //       return;\n// // // // //     }\n\n// // // // //     setQuestions(res.data.questions || []);\n// // // // //     setTimeLeft(res.data.timeLimit * 60); // seconds\n// // // // //   } catch (err) {\n// // // // //     console.error(err);\n// // // // //     alert(\"Failed to fetch questions. Please wait for admin to start the test.\");\n// // // // //     navigate(\"/\");\n// // // // //   } finally {\n// // // // //     setLoading(false);\n// // // // //   }\n// // // // // };\n\n// // // // //     fetchQuestions();\n// // // // //   }, [fullName, email, navigate]);\n\n// // // // //   // üü¢ Pick random questions\n// // // // //   useEffect(() => {\n// // // // //     if (!loading && allQuestions.length > 0) {\n// // // // //       const selected = pickRandom(allQuestions, Math.min(numQ || 10, allQuestions.length));\n// // // // //       setQuestions(selected);\n// // // // //     }\n// // // // //   }, [loading, allQuestions, numQ]);\n\n// // // // //   // üõë Detect tab switch, reload, or page exit\n// // // // //   useEffect(() => {\n// // // // //     const handleBeforeUnload = (e) => {\n// // // // //       e.preventDefault();\n// // // // //       e.returnValue = \"\";\n// // // // //       setTestEnded(true);\n// // // // //     };\n\n// // // // //     const handleVisibilityChange = () => {\n// // // // //       if (document.hidden) {\n// // // // //         setTestEnded(true);\n// // // // //       }\n// // // // //     };\n\n// // // // //     window.addEventListener(\"beforeunload\", handleBeforeUnload);\n// // // // //     document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n\n// // // // //     return () => {\n// // // // //       window.removeEventListener(\"beforeunload\", handleBeforeUnload);\n// // // // //       document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n// // // // //     };\n// // // // //   }, []);\n\n// // // // //   const handleSelect = (questionId, value) => {\n// // // // //     setAnswers({ ...answers, [questionId]: value });\n// // // // //   };\n\n// // // // //   const goNext = () => {\n// // // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\n// // // // //   };\n// // // // //   const goPrev = () => {\n// // // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\n// // // // //   };\n\n// // // // //   // üü¢ Submit handler\n// // // // //   const handleSubmit = async () => {\n// // // // //     if (Object.keys(answers).length < questions.length) {\n// // // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\n// // // // //     }\n\n// // // // //     // Calculate score only for MCQs\n// // // // //     let s = 0;\n// // // // //     questions.forEach((q) => {\n// // // // //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s += 1;\n// // // // //     });\n// // // // //     setScore(s);\n// // // // //     setSubmitted(true);\n\n// // // // //     // Prepare formatted answers\n// // // // //     const formattedAnswers = questions.map((q) => ({\n// // // // //       question: q.questionText,\n// // // // //       userAnswer: answers[q._id] || \"Not answered\",\n// // // // //       correctAnswer: q.correctAnswer || \"\",\n// // // // //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\n// // // // //       type: q.questionType || \"Theory\",\n// // // // //     }));\n\n// // // // //     try {\n// // // // //       await API.tests.submit({\n// // // // //         name: fullName,\n// // // // //         email,\n// // // // //         answers: formattedAnswers,\n// // // // //         totalQuestions: questions.length,\n// // // // //         correctAnswers: s,\n// // // // //         scorePercent: ((s / questions.length) * 100).toFixed(2),\n// // // // //       });\n// // // // //       setResultSaved(true);\n// // // // //     } catch (err) {\n// // // // //       console.error(\"Error saving result:\", err);\n// // // // //       alert(\"Failed to save result to server.\");\n// // // // //     }\n// // // // //   };\n\n// // // // //   // üõë If test was ended (tab switch or reload)\n// // // // //   if (testEnded) {\n// // // // //     return (\n// // // // //       <div className=\"container container-center\">\n// // // // //         <div className=\"card card-clean p-4 text-center\">\n// // // // //           <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\n// // // // //           <p>Your test session has ended because you switched tabs, reloaded, or left the page.</p>\n// // // // //           <h4 className=\"mt-3 text-success\">Thank you for your time!</h4>\n// // // // //           <button\n// // // // //             className=\"btn btn-primary mt-3\"\n// // // // //             onClick={() => navigate(\"/\")}\n// // // // //           >\n// // // // //             Go to Home\n// // // // //           </button>\n// // // // //         </div>\n// // // // //       </div>\n// // // // //     );\n// // // // //   }\n\n// // // // //   if (loading) return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\n// // // // //   if (!questions || questions.length === 0)\n// // // // //     return <div className=\"container container-center\">No questions available. Please try later.</div>;\n\n// // // // //   if (submitted) {\n// // // // //     return (\n// // // // //       <div className=\"container container-center\">\n// // // // //         <div className=\"card card-clean p-4\">\n// // // // //           <h3 className=\"text-success\">Test Completed Successfully</h3>\n// // // // //           <p><strong>{fullName}</strong> ({email})</p>\n// // // // //           <h4>Your Score: {score} / {questions.length}</h4>\n\n// // // // //           {resultSaved && (\n// // // // //             <div className=\"alert alert-success mt-2\">\n// // // // //               ‚úÖ Your result has been recorded successfully!\n// // // // //             </div>\n// // // // //           )}\n\n// // // // //           <hr />\n// // // // //           <h5>Review Answers</h5>\n// // // // //           <div>\n// // // // //             {questions.map((q, idx) => (\n// // // // //               <div className=\"review-question\" key={q._id}>\n// // // // //                 <b>Q{idx + 1}:</b> {q.questionText}\n// // // // //                 <div>\n// // // // //                   Your answer:{\" \"}\n// // // // //                   <span\n// // // // //                     className={\n// // // // //                       q.questionType === \"MCQ\"\n// // // // //                         ? answers[q._id] === q.correctAnswer\n// // // // //                           ? \"text-success\"\n// // // // //                           : \"text-danger\"\n// // // // //                         : \"text-primary\"\n// // // // //                     }\n// // // // //                   >\n// // // // //                     {answers[q._id] || \"Not answered\"}\n// // // // //                   </span>\n// // // // //                 </div>\n// // // // //                 {q.questionType === \"MCQ\" && (\n// // // // //                   <div>\n// // // // //                     Correct answer:{\" \"}\n// // // // //                     <span className=\"text-success\">{q.correctAnswer}</span>\n// // // // //                   </div>\n// // // // //                 )}\n// // // // //               </div>\n// // // // //             ))}\n// // // // //           </div>\n\n// // // // //           <div className=\"mt-4\">\n// // // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>\n// // // // //               Back to Home\n// // // // //             </button>\n// // // // //             <button className=\"btn btn-outline-secondary\" onClick={() => window.location.reload()}>\n// // // // //               Retake Test\n// // // // //             </button>\n// // // // //           </div>\n// // // // //         </div>\n// // // // //       </div>\n// // // // //     );\n// // // // //   }\n\n// // // // //   const currentQ = questions[currentIdx];\n// // // // //   const selectedAnswer = answers[currentQ._id] || \"\";\n\n// // // // //   return (\n// // // // //     <div className=\"test-container\">\n// // // // //       <div className=\"card test-card\">\n// // // // //         <div className=\"test-header\">\n// // // // //           <div>\n// // // // //             <h5 className=\"text-danger fw-bold\">\n// // // // //               Candidate: {fullName.toLowerCase()}\n// // // // //             </h5>\n// // // // //             <small className=\"text-muted\">{email}</small>\n// // // // //           </div>\n// // // // //           <div>\n// // // // //             <span className=\"badge bg-primary\">\n// // // // //               Question {currentIdx + 1} / {questions.length}\n// // // // //             </span>\n// // // // //           </div>\n// // // // //         </div>\n\n// // // // //         <div className=\"test-body\">\n// // // // //           <h6 className=\"question-text\">\n// // // // //             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\n// // // // //           </h6>\n\n// // // // //           {currentQ.questionType === \"MCQ\" && currentQ.options?.length > 0 ? (\n// // // // //             <div className=\"options-container\">\n// // // // //               {currentQ.options.map((opt, i) => (\n// // // // //                 <label\n// // // // //                   key={i}\n// // // // //                   className={`option-item ${\n// // // // //                     selectedAnswer === opt ? \"selected\" : \"\"\n// // // // //                   }`}\n// // // // //                 >\n// // // // //                   <input\n// // // // //                     type=\"radio\"\n// // // // //                     name={`question-${currentQ._id}`}\n// // // // //                     value={opt}\n// // // // //                     checked={selectedAnswer === opt}\n// // // // //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// // // // //                   />\n// // // // //                   {opt}\n// // // // //                 </label>\n// // // // //               ))}\n// // // // //             </div>\n// // // // //           ) : (\n// // // // //             <textarea\n// // // // //               className=\"theory-input\"\n// // // // //               placeholder=\"Type your answer here...\"\n// // // // //               value={selectedAnswer}\n// // // // //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// // // // //               rows={5}\n// // // // //             ></textarea>\n// // // // //           )}\n// // // // //         </div>\n\n// // // // //         <div className=\"test-footer\">\n// // // // //           <div>\n// // // // //             <button\n// // // // //               className=\"btn btn-secondary me-3\"\n// // // // //               onClick={goPrev}\n// // // // //               disabled={currentIdx === 0}\n// // // // //             >\n// // // // //               Previous\n// // // // //             </button>\n// // // // //             <button\n// // // // //               className=\"btn btn-secondary\"\n// // // // //               onClick={goNext}\n// // // // //               disabled={currentIdx === questions.length - 1}\n// // // // //             >\n// // // // //               Next\n// // // // //             </button>\n// // // // //           </div>\n\n// // // // //           <div>\n// // // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>\n// // // // //               Submit Test\n// // // // //             </button>\n// // // // //           </div>\n// // // // //         </div>\n// // // // //       </div>\n// // // // //     </div>\n// // // // //   );\n// // // // // }\n\n// // // // // // import React, { useEffect, useState } from \"react\";\n// // // // // // import { useLocation, useNavigate } from \"react-router-dom\";\n// // // // // // import API from \"../services/api\";\n// // // // // // import \"../styles/TestPage.css\";\n\n// // // // // // function pickRandom(arr, n) {\n// // // // // //   const copy = [...arr];\n// // // // // //   const res = [];\n// // // // // //   while (res.length < n && copy.length > 0) {\n// // // // // //     const idx = Math.floor(Math.random() * copy.length);\n// // // // // //     res.push(copy.splice(idx, 1)[0]);\n// // // // // //   }\n// // // // // //   return res;\n// // // // // // }\n\n// // // // // // export default function TestPage() {\n// // // // // //   const location = useLocation();\n// // // // // //   const navigate = useNavigate();\n// // // // // //   const { fullName, email, numQ } = location.state || {};\n\n// // // // // //   const [allQuestions, setAllQuestions] = useState([]);\n// // // // // //   const [questions, setQuestions] = useState([]);\n// // // // // //   const [answers, setAnswers] = useState({});\n// // // // // //   const [currentIdx, setCurrentIdx] = useState(0);\n// // // // // //   const [loading, setLoading] = useState(true);\n// // // // // //   const [submitted, setSubmitted] = useState(false);\n// // // // // //   const [score, setScore] = useState(0);\n// // // // // //   const [resultSaved, setResultSaved] = useState(false);\n\n// // // // // //   // üü¢ Fetch questions\n// // // // // //   useEffect(() => {\n// // // // // //     if (!fullName || !email) {\n// // // // // //       navigate(\"/\");\n// // // // // //       return;\n// // // // // //     }\n\n// // // // // //     const fetchQuestions = async () => {\n// // // // // //       try {\n// // // // // //         const res = await API.questions.getAll();\n// // // // // //         setAllQuestions(res.data || []);\n// // // // // //       } catch (err) {\n// // // // // //         console.error(err);\n// // // // // //         alert(\"Failed to fetch questions from server.\");\n// // // // // //       } finally {\n// // // // // //         setLoading(false);\n// // // // // //       }\n// // // // // //     };\n\n// // // // // //     fetchQuestions();\n// // // // // //   }, [fullName, email, navigate]);\n\n// // // // // //   // üü¢ Pick random questions\n// // // // // //   useEffect(() => {\n// // // // // //     if (!loading && allQuestions.length > 0) {\n// // // // // //       const selected = pickRandom(allQuestions, Math.min(numQ || 10, allQuestions.length));\n// // // // // //       setQuestions(selected);\n// // // // // //     }\n// // // // // //   }, [loading, allQuestions, numQ]);\n\n// // // // // //   const handleSelect = (questionId, value) => {\n// // // // // //     setAnswers({ ...answers, [questionId]: value });\n// // // // // //   };\n\n// // // // // //   const goNext = () => {\n// // // // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\n// // // // // //   };\n// // // // // //   const goPrev = () => {\n// // // // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\n// // // // // //   };\n\n// // // // // //   // üü¢ Submit handler\n// // // // // //   const handleSubmit = async () => {\n// // // // // //     if (Object.keys(answers).length < questions.length) {\n// // // // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\n// // // // // //     }\n\n// // // // // //     // Calculate score only for MCQs\n// // // // // //     let s = 0;\n// // // // // //     questions.forEach((q) => {\n// // // // // //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s += 1;\n// // // // // //     });\n// // // // // //     setScore(s);\n// // // // // //     setSubmitted(true);\n\n// // // // // //     // Prepare formatted answers\n// // // // // //     const formattedAnswers = questions.map((q) => ({\n// // // // // //       question: q.questionText,\n// // // // // //       userAnswer: answers[q._id] || \"Not answered\",\n// // // // // //       correctAnswer: q.correctAnswer || \"\",\n// // // // // //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\n// // // // // //       type: q.questionType || \"Theory\",\n// // // // // //     }));\n\n// // // // // //     try {\n// // // // // //       await API.tests.submit({\n// // // // // //         name: fullName,\n// // // // // //         email,\n// // // // // //         answers: formattedAnswers,\n// // // // // //         totalQuestions: questions.length,\n// // // // // //         correctAnswers: s,\n// // // // // //         scorePercent: ((s / questions.length) * 100).toFixed(2),\n// // // // // //       });\n// // // // // //       setResultSaved(true);\n// // // // // //     } catch (err) {\n// // // // // //       console.error(\"Error saving result:\", err);\n// // // // // //       alert(\"Failed to save result to server.\");\n// // // // // //     }\n// // // // // //   };\n\n// // // // // //   if (loading) return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\n// // // // // //   if (!questions || questions.length === 0)\n// // // // // //     return <div className=\"container container-center\">No questions available. Please try later.</div>;\n\n// // // // // //   if (submitted) {\n// // // // // //     return (\n// // // // // //       <div className=\"container container-center\">\n// // // // // //         <div className=\"card card-clean p-4\">\n// // // // // //           <h3 className=\"text-success\">Test Completed Successfully</h3>\n// // // // // //           <p><strong>{fullName}</strong> ({email})</p>\n// // // // // //           <h4>Your Score: {score} / {questions.length}</h4>\n\n// // // // // //           {resultSaved && (\n// // // // // //             <div className=\"alert alert-success mt-2\">\n// // // // // //               ‚úÖ Your result has been recorded successfully!\n// // // // // //             </div>\n// // // // // //           )}\n\n// // // // // //           <hr />\n// // // // // //           <h5>Review Answers</h5>\n// // // // // //           <div>\n// // // // // //             {questions.map((q, idx) => (\n// // // // // //               <div className=\"review-question\" key={q._id}>\n// // // // // //                 <b>Q{idx + 1}:</b> {q.questionText}\n// // // // // //                 <div>\n// // // // // //                   Your answer:{\" \"}\n// // // // // //                   <span\n// // // // // //                     className={\n// // // // // //                       q.questionType === \"MCQ\"\n// // // // // //                         ? answers[q._id] === q.correctAnswer\n// // // // // //                           ? \"text-success\"\n// // // // // //                           : \"text-danger\"\n// // // // // //                         : \"text-primary\"\n// // // // // //                     }\n// // // // // //                   >\n// // // // // //                     {answers[q._id] || \"Not answered\"}\n// // // // // //                   </span>\n// // // // // //                 </div>\n// // // // // //                 {q.questionType === \"MCQ\" && (\n// // // // // //                   <div>\n// // // // // //                     Correct answer:{\" \"}\n// // // // // //                     <span className=\"text-success\">{q.correctAnswer}</span>\n// // // // // //                   </div>\n// // // // // //                 )}\n// // // // // //               </div>\n// // // // // //             ))}\n// // // // // //           </div>\n\n// // // // // //           <div className=\"mt-4\">\n// // // // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>\n// // // // // //               Back to Home\n// // // // // //             </button>\n// // // // // //             <button className=\"btn btn-outline-secondary\" onClick={() => window.location.reload()}>\n// // // // // //               Retake Test\n// // // // // //             </button>\n// // // // // //           </div>\n// // // // // //         </div>\n// // // // // //       </div>\n// // // // // //     );\n// // // // // //   }\n\n// // // // // //   const currentQ = questions[currentIdx];\n// // // // // //   const selectedAnswer = answers[currentQ._id] || \"\";\n\n// // // // // //   return (\n// // // // // //     <div className=\"test-container\">\n// // // // // //       <div className=\"card test-card\">\n// // // // // //         <div className=\"test-header\">\n// // // // // //           <div>\n// // // // // //             <h5 className=\"text-danger fw-bold\">\n// // // // // //               Candidate: {fullName.toLowerCase()}\n// // // // // //             </h5>\n// // // // // //             <small className=\"text-muted\">{email}</small>\n// // // // // //           </div>\n// // // // // //           <div>\n// // // // // //             <span className=\"badge bg-primary\">\n// // // // // //               Question {currentIdx + 1} / {questions.length}\n// // // // // //             </span>\n// // // // // //           </div>\n// // // // // //         </div>\n\n// // // // // //         <div className=\"test-body\">\n// // // // // //           <h6 className=\"question-text\">\n// // // // // //              <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\n// // // // // //           </h6>\n\n// // // // // //           {/* üß† Conditional rendering for MCQ / Theory */}\n// // // // // //           {currentQ.questionType === \"MCQ\" && currentQ.options?.length > 0 ? (\n// // // // // //             <div className=\"options-container\">\n// // // // // //               {currentQ.options.map((opt, i) => (\n// // // // // //                 <label\n// // // // // //                   key={i}\n// // // // // //                   className={`option-item ${\n// // // // // //                     selectedAnswer === opt ? \"selected\" : \"\"\n// // // // // //                   }`}\n// // // // // //                 >\n// // // // // //                   <input\n// // // // // //                     type=\"radio\"\n// // // // // //                     name={`question-${currentQ._id}`}\n// // // // // //                     value={opt}\n// // // // // //                     checked={selectedAnswer === opt}\n// // // // // //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// // // // // //                   />\n// // // // // //                   {opt}\n// // // // // //                 </label>\n// // // // // //               ))}\n// // // // // //             </div>\n// // // // // //           ) : (\n// // // // // //             <textarea\n// // // // // //               className=\"theory-input\"\n// // // // // //               placeholder=\"Type your answer here...\"\n// // // // // //               value={selectedAnswer}\n// // // // // //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\n// // // // // //               rows={5}\n// // // // // //             ></textarea>\n// // // // // //           )}\n// // // // // //         </div>\n\n// // // // // //         <div className=\"test-footer\">\n// // // // // //           <div>\n// // // // // //             <button\n// // // // // //               className=\"btn btn-secondary me-3\"\n// // // // // //               onClick={goPrev}\n// // // // // //               disabled={currentIdx === 0}\n// // // // // //             >\n// // // // // //               Previous\n// // // // // //             </button>\n// // // // // //             <button\n// // // // // //               className=\"btn btn-secondary\"\n// // // // // //               onClick={goNext}\n// // // // // //               disabled={currentIdx === questions.length - 1}\n// // // // // //             >\n// // // // // //               Next\n// // // // // //             </button>\n// // // // // //           </div>\n\n// // // // // //           <div>\n// // // // // //             {/* <button\n// // // // // //               className=\"btn btn-danger me-2\"\n// // // // // //               onClick={() => {\n// // // // // //                 if (window.confirm(\"Are you sure you want to abandon this test?\"))\n// // // // // //                   navigate(\"/\");\n// // // // // //               }}\n// // // // // //             >\n// // // // // //               Abandon\n// // // // // //             </button> */}\n// // // // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>\n// // // // // //               Submit Test\n// // // // // //             </button>\n// // // // // //           </div>\n// // // // // //         </div>\n// // // // // //       </div>\n// // // // // //     </div>\n// // // // // //   );\n// // // // // // }\n\n// // // // // // import React, { useEffect, useState } from \"react\";\n// // // // // // import { useLocation, useNavigate } from \"react-router-dom\";\n// // // // // // import API from \"../services/api\";\n// // // // // // import QuestionCard from \"../components/QuestionCard\";\n// // // // // // import \"../styles/TestPage.css\";\n\n// // // // // // function pickRandom(arr, n) {\n// // // // // //   const copy = [...arr];\n// // // // // //   const res = [];\n// // // // // //   while (res.length < n && copy.length > 0) {\n// // // // // //     const idx = Math.floor(Math.random() * copy.length);\n// // // // // //     res.push(copy.splice(idx, 1)[0]);\n// // // // // //   }\n// // // // // //   return res;\n// // // // // // }\n\n// // // // // // export default function TestPage() {\n// // // // // //   const location = useLocation();\n// // // // // //   const navigate = useNavigate();\n// // // // // //   const { fullName, email, numQ } = location.state || {};\n// // // // // //   const [allQuestions, setAllQuestions] = useState([]);\n// // // // // //   const [questions, setQuestions] = useState([]);\n// // // // // //   const [answers, setAnswers] = useState({});\n// // // // // //   const [currentIdx, setCurrentIdx] = useState(0);\n// // // // // //   const [loading, setLoading] = useState(true);\n// // // // // //   const [submitted, setSubmitted] = useState(false);\n// // // // // //   const [score, setScore] = useState(0);\n// // // // // //   const [resultSaved, setResultSaved] = useState(false);\n\n// // // // // //   useEffect(() => {\n// // // // // //     if (!fullName || !email) {\n// // // // // //       navigate(\"/\");\n// // // // // //       return;\n// // // // // //     }\n\n// // // // // //     const fetchQuestions = async () => {\n// // // // // //       try {\n// // // // // //         const res = await API.get(\"/questions\");\n// // // // // //         setAllQuestions(res.data || []);\n// // // // // //       } catch (err) {\n// // // // // //         console.error(err);\n// // // // // //         alert(\"Failed to fetch questions from server.\");\n// // // // // //       } finally {\n// // // // // //         setLoading(false);\n// // // // // //       }\n// // // // // //     };\n\n// // // // // //     fetchQuestions();\n// // // // // //   }, [fullName, email, navigate]);\n\n// // // // // //   useEffect(() => {\n// // // // // //     if (!loading && allQuestions.length > 0) {\n// // // // // //       const selected = pickRandom(allQuestions, Math.min(numQ || 10, allQuestions.length));\n// // // // // //       setQuestions(selected);\n// // // // // //     }\n// // // // // //   }, [loading, allQuestions, numQ]);\n\n// // // // // //   const handleSelect = (opt) => {\n// // // // // //     const q = questions[currentIdx];\n// // // // // //     setAnswers({ ...answers, [q._id]: opt });\n// // // // // //   };\n\n// // // // // //   const goNext = () => {\n// // // // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\n// // // // // //   };\n// // // // // //   const goPrev = () => {\n// // // // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\n// // // // // //   };\n\n// // // // // //   const handleSubmit = async () => {\n// // // // // //     if (Object.keys(answers).length < questions.length) {\n// // // // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\n// // // // // //     }\n\n// // // // // //     // calculate score\n// // // // // //     let s = 0;\n// // // // // //     questions.forEach((q) => {\n// // // // // //       if (answers[q._id] && answers[q._id] === q.correctAnswer) s += 1;\n// // // // // //     });\n// // // // // //     setScore(s);\n// // // // // //     setSubmitted(true);\n\n// // // // // //     // format answers for backend\n// // // // // //     const formattedAnswers = questions.map((q) => ({\n// // // // // //       question: q.questionText,\n// // // // // //       userAnswer: answers[q._id] || \"Not answered\",\n// // // // // //       correctAnswer: q.correctAnswer,\n// // // // // //       isCorrect: answers[q._id] === q.correctAnswer,\n// // // // // //     }));\n\n// // // // // //     try {\n// // // // // //       await API.post(\"/tests\", {\n// // // // // //         name: fullName,\n// // // // // //         email,\n// // // // // //         answers: formattedAnswers,\n// // // // // //       });\n// // // // // //       setResultSaved(true);\n// // // // // //     } catch (err) {\n// // // // // //       console.error(\"Error saving result:\", err);\n// // // // // //       alert(\"Failed to save result to server.\");\n// // // // // //     }\n// // // // // //   };\n\n// // // // // //   if (loading) return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\n// // // // // //   if (!questions || questions.length === 0)\n// // // // // //     return <div className=\"container container-center\">No questions available. Please try later.</div>;\n\n// // // // // //   if (submitted) {\n// // // // // //     return (\n// // // // // //       <div className=\"container container-center\">\n// // // // // //         <div className=\"card card-clean p-4\">\n// // // // // //           <h3 className=\"text-success\">Test Completed Successfully</h3>\n// // // // // //           <p><strong>{fullName}</strong> ({email})</p>\n// // // // // //           <h4>Your Score: {score} / {questions.length}</h4>\n\n// // // // // //           {resultSaved && (\n// // // // // //             <div className=\"alert alert-success mt-2\">\n// // // // // //               ‚úÖ Your result has been recorded successfully!\n// // // // // //             </div>\n// // // // // //           )}\n\n// // // // // //           <hr />\n// // // // // //           <h5>Review Answers</h5>\n// // // // // //           <div>\n// // // // // //             {questions.map((q, idx) => (\n// // // // // //               <div className=\"mb-3\" key={q._id}>\n// // // // // //                 <b>Q{idx + 1}:</b> {q.questionText}\n// // // // // //                 <div>\n// // // // // //                   Your answer:{\" \"}\n// // // // // //                   <span\n// // // // // //                     className={\n// // // // // //                       answers[q._id] === q.correctAnswer\n// // // // // //                         ? \"text-success\"\n// // // // // //                         : \"text-danger\"\n// // // // // //                     }\n// // // // // //                   >\n// // // // // //                     {answers[q._id] || \"Not answered\"}\n// // // // // //                   </span>\n// // // // // //                 </div>\n// // // // // //                 <div>\n// // // // // //                   Correct answer:{\" \"}\n// // // // // //                   <span className=\"text-success\">{q.correctAnswer}</span>\n// // // // // //                 </div>\n// // // // // //               </div>\n// // // // // //             ))}\n// // // // // //           </div>\n\n// // // // // //           <div className=\"mt-3\">\n// // // // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>\n// // // // // //               Back to Home\n// // // // // //             </button>\n// // // // // //             <button className=\"btn btn-outline-secondary\" onClick={() => window.location.reload()}>\n// // // // // //               Retake Test\n// // // // // //             </button>\n// // // // // //           </div>\n// // // // // //         </div>\n// // // // // //       </div>\n// // // // // //     );\n// // // // // //   }\n\n// // // // // //   const currentQ = questions[currentIdx];\n// // // // // //   const selectedForCurrent = answers[currentQ._id];\n\n// // // // // //   return (\n// // // // // //     <div className=\"container container-center\">\n// // // // // //       <div className=\"card card-clean p-4\">\n// // // // // //         <div className=\"d-flex justify-content-between align-items-start\">\n// // // // // //           <div>\n// // // // // //             <h5 className=\"mb-0\">Candidate: {fullName}</h5>\n// // // // // //             <small className=\"text-muted\">{email}</small>\n// // // // // //           </div>\n// // // // // //           <div>\n// // // // // //             <span className=\"badge bg-primary\">\n// // // // // //               Question {currentIdx + 1} / {questions.length}\n// // // // // //             </span>\n// // // // // //           </div>\n// // // // // //         </div>\n\n// // // // // //         <div className=\"mt-4\">\n// // // // // //           <QuestionCard\n// // // // // //             question={currentQ}\n// // // // // //             selectedAnswer={selectedForCurrent}\n// // // // // //             onSelect={handleSelect}\n// // // // // //           />\n// // // // // //         </div>\n\n// // // // // //         <div className=\"mt-3 d-flex justify-content-between\">\n// // // // // //           <div>\n// // // // // //             <button\n// // // // // //               className=\"btn btn-secondary me-2\"\n// // // // // //               onClick={goPrev}\n// // // // // //               disabled={currentIdx === 0}\n// // // // // //             >\n// // // // // //               Previous\n// // // // // //             </button>\n// // // // // //             <button\n// // // // // //               className=\"btn btn-secondary\"\n// // // // // //               onClick={goNext}\n// // // // // //               disabled={currentIdx === questions.length - 1}\n// // // // // //             >\n// // // // // //               Next\n// // // // // //             </button>\n// // // // // //           </div>\n\n// // // // // //           <div>\n// // // // // //             <button\n// // // // // //               className=\"btn btn-danger me-2\"\n// // // // // //               onClick={() => {\n// // // // // //                 if (window.confirm(\"Are you sure you want to abandon this test?\"))\n// // // // // //                   navigate(\"/\");\n// // // // // //               }}\n// // // // // //             >\n// // // // // //               Abandon\n// // // // // //             </button>\n\n// // // // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>\n// // // // // //               Submit Test\n// // // // // //             </button>\n// // // // // //           </div>\n// // // // // //         </div>\n// // // // // //       </div>\n// // // // // //     </div>\n// // // // // //   );\n// // // // // // }\n\n// // // // // // // import React, { useEffect, useState } from \"react\";\n// // // // // // // import { useLocation, useNavigate } from \"react-router-dom\";\n// // // // // // // import API from \"../services/api\";\n// // // // // // // import QuestionCard from \"../components/QuestionCard\";\n// // // // // // // import \"../styles/TestPage.css\";\n\n// // // // // // // function pickRandom(arr, n) {\n// // // // // // //   const copy = [...arr];\n// // // // // // //   const res = [];\n// // // // // // //   while (res.length < n && copy.length > 0) {\n// // // // // // //     const idx = Math.floor(Math.random() * copy.length);\n// // // // // // //     res.push(copy.splice(idx, 1)[0]);\n// // // // // // //   }\n// // // // // // //   return res;\n// // // // // // // }\n\n// // // // // // // export default function TestPage() {\n// // // // // // //   const location = useLocation();\n// // // // // // //   const navigate = useNavigate();\n// // // // // // //   const { fullName, email, numQ } = location.state || {};\n// // // // // // //   const [allQuestions, setAllQuestions] = useState([]);\n// // // // // // //   const [questions, setQuestions] = useState([]);\n// // // // // // //   const [answers, setAnswers] = useState({}); // { questionId: selectedOption }\n// // // // // // //   const [currentIdx, setCurrentIdx] = useState(0);\n// // // // // // //   const [loading, setLoading] = useState(true);\n// // // // // // //   const [submitted, setSubmitted] = useState(false);\n// // // // // // //   const [score, setScore] = useState(0);\n\n// // // // // // //   useEffect(() => {\n// // // // // // //     if (!fullName || !email) {\n// // // // // // //       // if page opened without details -> back to home\n// // // // // // //       navigate(\"/\");\n// // // // // // //       return;\n// // // // // // //     }\n\n// // // // // // //     const fetchQuestions = async () => {\n// // // // // // //       try {\n// // // // // // //         const res = await API.get(\"/questions\");\n// // // // // // //         setAllQuestions(res.data || []);\n// // // // // // //       } catch (err) {\n// // // // // // //         console.error(err);\n// // // // // // //         alert(\"Failed to fetch questions from server.\");\n// // // // // // //       } finally {\n// // // // // // //         setLoading(false);\n// // // // // // //       }\n// // // // // // //     };\n\n// // // // // // //     fetchQuestions();\n// // // // // // //   }, [fullName, email, navigate]);\n\n// // // // // // //   useEffect(() => {\n// // // // // // //     if (!loading && allQuestions.length > 0) {\n// // // // // // //       const chunk = pickRandom(allQuestions, Math.min(numQ || 10, allQuestions.length));\n// // // // // // //       setQuestions(chunk);\n// // // // // // //     }\n// // // // // // //   }, [loading, allQuestions, numQ]);\n\n// // // // // // //   const handleSelect = (opt) => {\n// // // // // // //     const q = questions[currentIdx];\n// // // // // // //     setAnswers({ ...answers, [q._id]: opt });\n// // // // // // //   };\n\n// // // // // // //   const goNext = () => {\n// // // // // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\n// // // // // // //   };\n// // // // // // //   const goPrev = () => {\n// // // // // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\n// // // // // // //   };\n\n// // // // // // //   const handleSubmit = () => {\n// // // // // // //     // ensure all answered\n// // // // // // //     if (Object.keys(answers).length < questions.length) {\n// // // // // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\n// // // // // // //     }\n\n// // // // // // //     // compute score\n// // // // // // //     let s = 0;\n// // // // // // //     questions.forEach((q) => {\n// // // // // // //       if (answers[q._id] && answers[q._id] === q.correctAnswer) s += 1;\n// // // // // // //     });\n// // // // // // //     setScore(s);\n// // // // // // //     setSubmitted(true);\n// // // // // // //   };\n\n// // // // // // //   if (loading) return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\n// // // // // // //   if (!questions || questions.length === 0) return <div className=\"container container-center\">No questions available. Please try later.</div>;\n\n// // // // // // //   if (submitted) {\n// // // // // // //     return (\n// // // // // // //       <div className=\"container container-center\">\n// // // // // // //         <div className=\"card card-clean p-4\">\n// // // // // // //           <h3>Test Completed</h3>\n// // // // // // //           <p><strong>{fullName}</strong> ({email})</p>\n// // // // // // //           <h4>Your score: {score} out of {questions.length}</h4>\n// // // // // // //           <hr />\n// // // // // // //           <h5>Review</h5>\n// // // // // // //           <div>\n// // // // // // //             {questions.map((q, idx) => (\n// // // // // // //               <div className=\"mb-3\" key={q._id}>\n// // // // // // //                 <b>Q{idx + 1}:</b> {q.questionText}\n// // // // // // //                 <div>Your answer: <span className={answers[q._id] === q.correctAnswer ? \"text-success\" : \"text-danger\"}>{answers[q._id] || \"Not answered\"}</span></div>\n// // // // // // //                 <div>Correct answer: <span className=\"text-success\">{q.correctAnswer}</span></div>\n// // // // // // //               </div>\n// // // // // // //             ))}\n// // // // // // //           </div>\n\n// // // // // // //           <div className=\"mt-3\">\n// // // // // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>Back to Home</button>\n// // // // // // //             <button className=\"btn btn-outline-secondary\" onClick={() => window.location.reload()}>Take New Test</button>\n// // // // // // //           </div>\n// // // // // // //         </div>\n// // // // // // //       </div>\n// // // // // // //     );\n// // // // // // //   }\n\n// // // // // // //   const currentQ = questions[currentIdx];\n// // // // // // //   const selectedForCurrent = answers[currentQ._id];\n\n// // // // // // //   return (\n// // // // // // //     <div className=\"container container-center\">\n// // // // // // //       <div className=\"card card-clean p-4\">\n// // // // // // //         <div className=\"d-flex justify-content-between align-items-start\">\n// // // // // // //           <div>\n// // // // // // //             <h5 className=\"mb-0\">Candidate: {fullName}</h5>\n// // // // // // //             <small className=\"text-muted\">{email}</small>\n// // // // // // //           </div>\n// // // // // // //           <div>\n// // // // // // //             <span className=\"badge bg-primary\">Question {currentIdx + 1} / {questions.length}</span>\n// // // // // // //           </div>\n// // // // // // //         </div>\n\n// // // // // // //         <div className=\"mt-4\">\n// // // // // // //           <QuestionCard question={currentQ} selectedAnswer={selectedForCurrent} onSelect={handleSelect} />\n// // // // // // //         </div>\n\n// // // // // // //         <div className=\"mt-3 d-flex justify-content-between\">\n// // // // // // //           <div>\n// // // // // // //             <button className=\"btn btn-secondary me-2\" onClick={goPrev} disabled={currentIdx === 0}>Previous</button>\n// // // // // // //             <button className=\"btn btn-secondary\" onClick={goNext} disabled={currentIdx === questions.length - 1}>Next</button>\n// // // // // // //           </div>\n\n// // // // // // //           <div>\n// // // // // // //             <button className=\"btn btn-danger me-2\" onClick={() => {\n// // // // // // //               if (window.confirm(\"Are you sure you want to abandon this test?\")) navigate(\"/\");\n// // // // // // //             }}>Abandon</button>\n\n// // // // // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>Submit Test</button>\n// // // // // // //           </div>\n// // // // // // //         </div>\n// // // // // // //       </div>\n// // // // // // //     </div>\n// // // // // // //   );\n// // // // // // // }\n_s(TestPage, \"fT023L10469NQ2lhut/l/WigibE=\", false, function () {\n  return [useLocation, useNavigate];\n});\n_c = TestPage;\nvar _c;\n$RefreshReg$(_c, \"TestPage\");","map":{"version":3,"names":["React","useEffect","useState","useLocation","useNavigate","API","jsxDEV","_jsxDEV","TestPage","_s","location","navigate","fullName","email","state","questions","setQuestions","answers","setAnswers","currentIdx","setCurrentIdx","loading","setLoading","submitted","setSubmitted","score","setScore","resultSaved","setResultSaved","testEnded","setTestEnded","testNotStarted","setTestNotStarted","errorMsg","setErrorMsg","timeLeft","setTimeLeft","ignoreBlur","setIgnoreBlur","initialDimensions","setInitialDimensions","width","window","outerWidth","height","outerHeight","loadTest","_qRes$data","controlRes","testcontrol","get","data","isActive","questionLimit","timeLimit","qRes","getAll","error","list","Array","isArray","length","slice","err","alert","handleSubmit","t","setTimeout","clearTimeout","handleTab","document","hidden","addEventListener","handleBlur","removeEventListener","bc","BroadcastChannel","postMessage","onmessage","msg","tabId","Date","now","Math","random","toString","key","localStorage","setItem","String","hb","setInterval","onStorage","e","startsWith","removeItem","clearInterval","blockAndEnd","preventDefault","onCopy","onCut","onPaste","tag","target","tagName","onContext","onKey","isInput","isContentEditable","ctrlKey","metaKey","includes","toLowerCase","shiftKey","initial","handleResize","abs","close","handleSelect","id","val","goNext","goPrev","Object","keys","ok","confirm","s","forEach","q","questionType","_id","correctAnswer","formatted","map","question","questionText","userAnswer","isCorrect","type","tests","submit","name","totalQuestions","correctAnswers","scorePercent","toFixed","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","currentQ","selectedAnswer","floor","padStart","options","opt","i","value","checked","onChange","placeholder","rows","disabled","_c","$RefreshReg$"],"sources":["C:/Users/HP/Downloads/INTERVIEW PROCESS/INTERVIEW PROCESS/client/src/pages/TestPage.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport API from \"../services/api\";\r\nimport \"../styles/TestPage.css\";\r\n\r\nexport default function TestPage() {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { fullName, email } = location.state || {};\r\n\r\n  const [questions, setQuestions] = useState([]);\r\n  const [answers, setAnswers] = useState({});\r\n  const [currentIdx, setCurrentIdx] = useState(0);\r\n  const [loading, setLoading] = useState(true);\r\n  const [submitted, setSubmitted] = useState(false);\r\n  const [score, setScore] = useState(0);\r\n  const [resultSaved, setResultSaved] = useState(false);\r\n  const [testEnded, setTestEnded] = useState(false);\r\n  const [testNotStarted, setTestNotStarted] = useState(false);\r\n  const [errorMsg, setErrorMsg] = useState(\"\");\r\n  const [timeLeft, setTimeLeft] = useState(null);\r\n\r\n  // IMPORTANT: Fix for cancel popup blur issue\r\n  const [ignoreBlur, setIgnoreBlur] = useState(false);\r\n\r\n  const [initialDimensions, setInitialDimensions] = useState({\r\n    width: typeof window !== \"undefined\" ? window.outerWidth : 0,\r\n    height: typeof window !== \"undefined\" ? window.outerHeight : 0,\r\n  });\r\n\r\n  // Load test controls and questions\r\n  useEffect(() => {\r\n    if (!fullName || !email) {\r\n      navigate(\"/\");\r\n      return;\r\n    }\r\n    const loadTest = async () => {\r\n      try {\r\n        const controlRes = await API.testcontrol.get();\r\n        if (!controlRes?.data) {\r\n          setTestNotStarted(true);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        const { isActive, questionLimit, timeLimit } = controlRes.data;\r\n        if (!isActive) {\r\n          setTestNotStarted(true);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        const qRes = await API.questions.getAll();\r\n        if (qRes.data?.error) {\r\n          setErrorMsg(qRes.data.error);\r\n          setTestNotStarted(true);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        const list = Array.isArray(qRes.data.questions)\r\n          ? qRes.data.questions\r\n          : Array.isArray(qRes.data)\r\n          ? qRes.data\r\n          : [];\r\n        if (!list.length) setErrorMsg(\"No questions available right now.\");\r\n        setQuestions(list.slice(0, questionLimit || list.length));\r\n        setTimeLeft((timeLimit || 30) * 60);\r\n      } catch (err) {\r\n        setErrorMsg(\"Could not load test. Check your backend connection.\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    loadTest();\r\n  }, [fullName, email, navigate]);\r\n\r\n  // Countdown Timer\r\n  useEffect(() => {\r\n    if (timeLeft === null) return;\r\n    if (timeLeft <= 0) {\r\n      alert(\"‚è∞ Time‚Äôs up! Submitting automatically...\");\r\n      handleSubmit();\r\n      return;\r\n    }\r\n    const t = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\r\n    return () => clearTimeout(t);\r\n  }, [timeLeft]);\r\n\r\n  // Detect tab switch, minimize (via blur), and maximize via resize\r\n  useEffect(() => {\r\n    const handleTab = () => {\r\n      if (document.hidden) setTestEnded(true);\r\n    };\r\n    document.addEventListener(\"visibilitychange\", handleTab);\r\n\r\n    // FIXED blur handler (now respects ignoreBlur flag)\r\n    const handleBlur = () => {\r\n      if (!ignoreBlur) {\r\n        setTestEnded(true);\r\n      }\r\n    };\r\n    window.addEventListener(\"blur\", handleBlur);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"visibilitychange\", handleTab);\r\n      window.removeEventListener(\"blur\", handleBlur);\r\n    };\r\n  }, [ignoreBlur]);\r\n\r\n  // Anti-cheat detection\r\n  useEffect(() => {\r\n    // MULTI-TAB\r\n    let bc;\r\n    try {\r\n      bc = new window.BroadcastChannel(\"anti_cheat_channel\");\r\n      bc.postMessage(\"active\");\r\n      bc.onmessage = (msg) => {\r\n        if (msg.data === \"active\") setTestEnded(true);\r\n      };\r\n    } catch (err) {\r\n      const tabId = `${Date.now()}_${Math.random().toString(36).slice(2)}`;\r\n      const key = `test_tab_${tabId}`;\r\n      try {\r\n        localStorage.setItem(key, String(Date.now()));\r\n      } catch (err) {}\r\n      const hb = setInterval(() => {\r\n        try {\r\n          localStorage.setItem(key, String(Date.now()));\r\n        } catch (err) {}\r\n      }, 2000);\r\n      const onStorage = (e) => {\r\n        if (!e.key) return;\r\n        if (e.key.startsWith(\"test_tab_\") && e.key !== key) setTestEnded(true);\r\n      };\r\n      window.addEventListener(\"storage\", onStorage);\r\n      window.addEventListener(\"beforeunload\", () => {\r\n        try {\r\n          localStorage.removeItem(key);\r\n        } catch (err) {}\r\n      });\r\n      return () => {\r\n        clearInterval(hb);\r\n        try {\r\n          localStorage.removeItem(key);\r\n        } catch (err) {}\r\n        window.removeEventListener(\"storage\", onStorage);\r\n      };\r\n    }\r\n\r\n    // BLOCK COPY/PASTE/CONTEXT MENU\r\n    const blockAndEnd = (e) => {\r\n      try {\r\n        if (e) e.preventDefault();\r\n      } catch (err) {}\r\n      setTestEnded(true);\r\n    };\r\n\r\n    const onCopy = (e) => blockAndEnd(e);\r\n    const onCut = (e) => blockAndEnd(e);\r\n\r\n    const onPaste = (e) => {\r\n      const tag = (e.target && e.target.tagName) || \"\";\r\n      if (tag === \"TEXTAREA\" || tag === \"INPUT\") return;\r\n      blockAndEnd(e);\r\n    };\r\n\r\n    const onContext = (e) => blockAndEnd(e);\r\n\r\n    document.addEventListener(\"copy\", onCopy);\r\n    document.addEventListener(\"cut\", onCut);\r\n    document.addEventListener(\"paste\", onPaste);\r\n    document.addEventListener(\"contextmenu\", onContext);\r\n\r\n    // Keyboard shortcuts\r\n    const onKey = (e) => {\r\n      const target = e.target || {};\r\n      const tag = target.tagName || \"\";\r\n      const isInput =\r\n        tag === \"INPUT\" ||\r\n        tag === \"TEXTAREA\" ||\r\n        target.isContentEditable;\r\n\r\n      if (\r\n        (e.ctrlKey || e.metaKey) &&\r\n        (\r\n          [\"c\", \"x\", \"t\", \"n\"].includes((e.key || \"\").toLowerCase()) ||\r\n          (!isInput && [\"v\", \"p\"].includes((e.key || \"\").toLowerCase()))\r\n        )\r\n      ) {\r\n        e.preventDefault();\r\n        setTestEnded(true);\r\n        return;\r\n      }\r\n      if (\r\n        e.key === \"F12\" ||\r\n        (e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"i\") ||\r\n        (e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"c\")\r\n      ) {\r\n        e.preventDefault();\r\n        setTestEnded(true);\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", onKey, true);\r\n\r\n    // RESIZE\r\n    const initial = { width: window.outerWidth, height: window.outerHeight };\r\n    setInitialDimensions(initial);\r\n\r\n    const handleResize = () => {\r\n      if (window.outerWidth === 0 && window.outerHeight === 0) {\r\n        setTestEnded(true);\r\n        return;\r\n      }\r\n      if (\r\n        Math.abs(window.outerWidth - initial.width) > 5 ||\r\n        Math.abs(window.outerHeight - initial.height) > 5\r\n      ) {\r\n        setTestEnded(true);\r\n      }\r\n    };\r\n    window.addEventListener(\"resize\", handleResize);\r\n\r\n    return () => {\r\n      try {\r\n        if (bc) bc.close();\r\n      } catch (err) {}\r\n      document.removeEventListener(\"copy\", onCopy);\r\n      document.removeEventListener(\"cut\", onCut);\r\n      document.removeEventListener(\"paste\", onPaste);\r\n      document.removeEventListener(\"contextmenu\", onContext);\r\n      window.removeEventListener(\"keydown\", onKey, true);\r\n      window.removeEventListener(\"resize\", handleResize);\r\n    };\r\n  }, []);\r\n\r\n  const handleSelect = (id, val) => setAnswers({ ...answers, [id]: val });\r\n  const goNext = () => currentIdx < questions.length - 1 && setCurrentIdx(currentIdx + 1);\r\n  const goPrev = () => currentIdx > 0 && setCurrentIdx(currentIdx - 1);\r\n\r\n  // FIXED submit function with ignoreBlur\r\n  const handleSubmit = async () => {\r\n    if (submitted) return;\r\n\r\n    if (Object.keys(answers).length < questions.length) {\r\n      setIgnoreBlur(true); // Prevent blur ‚Üí testEnded\r\n\r\n      const ok = window.confirm(\"Some questions are unanswered. Submit anyway?\");\r\n\r\n      setIgnoreBlur(false); // Restore blur protection\r\n\r\n      if (!ok) return; // User cancelled\r\n    }\r\n\r\n    let s = 0;\r\n    questions.forEach((q) => {\r\n      if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s++;\r\n    });\r\n\r\n    setScore(s);\r\n    setSubmitted(true);\r\n\r\n    const formatted = questions.map((q) => ({\r\n      question: q.questionText,\r\n      userAnswer: answers[q._id] || \"Not answered\",\r\n      correctAnswer: q.correctAnswer || \"\",\r\n      isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\r\n      type: q.questionType,\r\n    }));\r\n\r\n    try {\r\n      await API.tests.submit({\r\n        name: fullName,\r\n        email,\r\n        answers: formatted,\r\n        totalQuestions: questions.length,\r\n        correctAnswers: s,\r\n        scorePercent: ((s / questions.length) * 100).toFixed(2),\r\n      });\r\n      setResultSaved(true);\r\n    } catch (err) {\r\n      alert(\"Failed to save result to server.\");\r\n    }\r\n  };\r\n\r\n  if (testEnded)\r\n    return (\r\n      <div className=\"container container-center text-center\">\r\n        <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\r\n        <p>You switched tabs, minimized, maximized, or resized the window.</p>\r\n        <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n          Go Home\r\n        </button>\r\n      </div>\r\n    );\r\n  if (testNotStarted)\r\n    return (\r\n      <div className=\"container container-center text-center\">\r\n        <h3 className=\"text-warning\">‚ö†Ô∏è Test Not Active</h3>\r\n        <p>Waiting for admin to start the test... Please restore the page for sometime while</p>\r\n      </div>\r\n    );\r\n  if (errorMsg)\r\n    return (\r\n      <div className=\"container container-center text-center\">\r\n        <h3 className=\"text-danger\">‚ùå Error</h3>\r\n        <p>{errorMsg}</p>\r\n      </div>\r\n    );\r\n  if (loading)\r\n    return (\r\n      <div className=\"container container-center text-center\">\r\n        <h5>Loading questions‚Ä¶</h5>\r\n      </div>\r\n    );\r\n  if (!questions.length)\r\n    return (\r\n      <div className=\"container container-center text-center\">\r\n        <p>No questions available.</p>\r\n      </div>\r\n    );\r\n\r\n  if (submitted && resultSaved) {\r\n    return (\r\n      <div className=\"container container-center text-center\">\r\n        <div className=\"card card-clean p-4\">\r\n          <h3 className=\"text-success\">üéâ Thank You for Completing the Test!</h3>\r\n          <p>\r\n            <strong>{fullName}</strong> ({email})\r\n          </p>\r\n          <p>Your responses have been recorded successfully.</p>\r\n          <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n            Go to Home\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const currentQ = questions[currentIdx];\r\n  const selectedAnswer = answers[currentQ._id] || \"\";\r\n\r\n  return (\r\n    <div className=\"test-container\">\r\n      <div className=\"card test-card\">\r\n        <div className=\"test-header d-flex justify-content-between align-items-center\">\r\n          <div>\r\n            <h5 className=\"text-danger fw-bold\">Candidate: {fullName}</h5>\r\n            <small>{email}</small>\r\n          </div>\r\n          <div>\r\n            <span className=\"badge bg-primary me-2\">\r\n              Q {currentIdx + 1}/{questions.length}\r\n            </span>\r\n            <span className=\"badge bg-danger\">\r\n              ‚è≥ {Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, \"0\")}\r\n            </span>\r\n          </div>\r\n        </div>\r\n        <div className=\"test-body\">\r\n          <h6>\r\n            <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\r\n          </h6>\r\n          {currentQ.questionType === \"MCQ\" ? (\r\n            <div className=\"options-container\">\r\n              {currentQ.options.map((opt, i) => (\r\n                <label key={i} className={`option-item ${selectedAnswer === opt ? \"selected\" : \"\"}`}>\r\n                  <input\r\n                    type=\"radio\"\r\n                    name={`question-${currentQ._id}`}\r\n                    value={opt}\r\n                    checked={selectedAnswer === opt}\r\n                    onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n                  />\r\n                  {opt}\r\n                </label>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <textarea\r\n              className=\"theory-input\"\r\n              placeholder=\"Type your answer...\"\r\n              value={selectedAnswer}\r\n              onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n              rows={5}\r\n            />\r\n          )}\r\n        </div>\r\n        <div className=\"test-footer d-flex justify-content-between\">\r\n          <div>\r\n            <button className=\"btn btn-secondary me-2\" disabled={currentIdx === 0} onClick={goPrev}>\r\n              Previous\r\n            </button>\r\n            <button\r\n              className=\"btn btn-secondary\"\r\n              disabled={currentIdx === questions.length - 1}\r\n              onClick={goNext}\r\n            >\r\n              Next\r\n            </button>\r\n          </div>\r\n          <button className=\"btn btn-success\" onClick={handleSubmit}>\r\n            Submit Test\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// import React, { useEffect, useState } from \"react\";\r\n// import { useLocation, useNavigate } from \"react-router-dom\";\r\n// import API from \"../services/api\";\r\n// import \"../styles/TestPage.css\";\r\n\r\n// export default function TestPage() {\r\n//   const location = useLocation();\r\n//   const navigate = useNavigate();\r\n//   const { fullName, email } = location.state || {};\r\n\r\n//   const [questions, setQuestions] = useState([]);\r\n//   const [answers, setAnswers] = useState({});\r\n//   const [currentIdx, setCurrentIdx] = useState(0);\r\n//   const [loading, setLoading] = useState(true);\r\n//   const [submitted, setSubmitted] = useState(false);\r\n//   const [score, setScore] = useState(0);\r\n//   const [resultSaved, setResultSaved] = useState(false);\r\n//   const [testEnded, setTestEnded] = useState(false);\r\n//   const [testNotStarted, setTestNotStarted] = useState(false);\r\n//   const [errorMsg, setErrorMsg] = useState(\"\");\r\n//   const [timeLeft, setTimeLeft] = useState(null);\r\n//   // For window resize detection\r\n//   const [initialDimensions, setInitialDimensions] = useState({\r\n//     width: typeof window !== \"undefined\" ? window.outerWidth : 0,\r\n//     height: typeof window !== \"undefined\" ? window.outerHeight : 0,\r\n//   });\r\n\r\n//   // Load test controls and questions\r\n//   useEffect(() => {\r\n//     if (!fullName || !email) {\r\n//       navigate(\"/\");\r\n//       return;\r\n//     }\r\n//     const loadTest = async () => {\r\n//       try {\r\n//         const controlRes = await API.testcontrol.get();\r\n//         if (!controlRes?.data) {\r\n//           setTestNotStarted(true);\r\n//           setLoading(false);\r\n//           return;\r\n//         }\r\n//         const { isActive, questionLimit, timeLimit } = controlRes.data;\r\n//         if (!isActive) {\r\n//           setTestNotStarted(true);\r\n//           setLoading(false);\r\n//           return;\r\n//         }\r\n//         const qRes = await API.questions.getAll();\r\n//         if (qRes.data?.error) {\r\n//           setErrorMsg(qRes.data.error);\r\n//           setTestNotStarted(true);\r\n//           setLoading(false);\r\n//           return;\r\n//         }\r\n//         const list = Array.isArray(qRes.data.questions)\r\n//           ? qRes.data.questions\r\n//           : Array.isArray(qRes.data)\r\n//           ? qRes.data\r\n//           : [];\r\n//         if (!list.length) setErrorMsg(\"No questions available right now.\");\r\n//         setQuestions(list.slice(0, questionLimit || list.length));\r\n//         setTimeLeft((timeLimit || 30) * 60);\r\n//       } catch (err) {\r\n//         setErrorMsg(\"Could not load test. Check your backend connection.\");\r\n//       } finally {\r\n//         setLoading(false);\r\n//       }\r\n//     };\r\n//     loadTest();\r\n//   }, [fullName, email, navigate]);\r\n\r\n//   // Countdown Timer\r\n//   useEffect(() => {\r\n//     if (timeLeft === null) return;\r\n//     if (timeLeft <= 0) {\r\n//       alert(\"‚è∞ Time‚Äôs up! Submitting automatically...\");\r\n//       handleSubmit();\r\n//       return;\r\n//     }\r\n//     const t = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\r\n//     return () => clearTimeout(t);\r\n//   }, [timeLeft]);\r\n\r\n//   // Detect tab switch, minimize (via blur), and maximize via resize\r\n//   useEffect(() => {\r\n//     const handleTab = () => {\r\n//       if (document.hidden) setTestEnded(true);\r\n//     };\r\n//     document.addEventListener(\"visibilitychange\", handleTab);\r\n\r\n//     // Extra: Detect minimize/focus loss\r\n//     const handleBlur = () => setTestEnded(true);\r\n//     window.addEventListener(\"blur\", handleBlur);\r\n\r\n//     return () => {\r\n//       document.removeEventListener(\"visibilitychange\", handleTab);\r\n//       window.removeEventListener(\"blur\", handleBlur);\r\n//     };\r\n//   }, []);\r\n\r\n//   // Anti-cheat: Multi-tab and window detection (BroadcastChannel and localStorage fallback), clipboard/shortcut/contextmenu blocking, window resizing\r\n//   useEffect(() => {\r\n//     // --- MULTI-TAB ---\r\n//     let bc;\r\n//     try {\r\n//       bc = new window.BroadcastChannel(\"anti_cheat_channel\");\r\n//       bc.postMessage(\"active\");\r\n//       bc.onmessage = (msg) => {\r\n//         if (msg.data === \"active\") setTestEnded(true);\r\n//       };\r\n//     } catch (err) {\r\n//       // fallback: localStorage\r\n//       const tabId = `${Date.now()}_${Math.random().toString(36).slice(2)}`;\r\n//       const key = `test_tab_${tabId}`;\r\n//       try { localStorage.setItem(key, String(Date.now())); } catch (err) {}\r\n//       const hb = setInterval(() => {\r\n//         try { localStorage.setItem(key, String(Date.now())); } catch (err) {}\r\n//       }, 2000);\r\n//       const onStorage = (e) => {\r\n//         if (!e.key) return;\r\n//         if (e.key.startsWith(\"test_tab_\") && e.key !== key) setTestEnded(true);\r\n//       };\r\n//       window.addEventListener(\"storage\", onStorage);\r\n//       window.addEventListener(\"beforeunload\", () => {\r\n//         try { localStorage.removeItem(key); } catch (err) {}\r\n//       });\r\n//       return () => {\r\n//         clearInterval(hb);\r\n//         try { localStorage.removeItem(key); } catch (err) {}\r\n//         window.removeEventListener(\"storage\", onStorage);\r\n//       };\r\n//     }\r\n\r\n//     // --- BLOCK CLIPBOARD/SHORTCUTS/CONTEXTMENU ---\r\n//     const blockAndEnd = (e) => {\r\n//       try { if (e) e.preventDefault(); } catch (err) {}\r\n//       setTestEnded(true);\r\n//     };\r\n//     const onCopy = (e) => blockAndEnd(e);\r\n//     const onCut = (e) => blockAndEnd(e);\r\n//     const onPaste = (e) => {\r\n//       // Allow paste in text input/textarea for theory questions if desired\r\n//       const tag = (e.target && e.target.tagName) || \"\";\r\n//       if (tag === \"TEXTAREA\" || tag === \"INPUT\") return;\r\n//       blockAndEnd(e);\r\n//     };\r\n//     const onContext = (e) => blockAndEnd(e);\r\n//     document.addEventListener(\"copy\", onCopy);\r\n//     document.addEventListener(\"cut\", onCut);\r\n//     document.addEventListener(\"paste\", onPaste);\r\n//     document.addEventListener(\"contextmenu\", onContext);\r\n\r\n//     // Keyboard shortcuts -- allow some in inputs only\r\n//     const onKey = (e) => {\r\n//       const target = e.target || {};\r\n//       const tag = target.tagName || \"\";\r\n//       const isInput = tag === \"INPUT\" || tag === \"TEXTAREA\" || target.isContentEditable;\r\n//       if (\r\n//         (e.ctrlKey || e.metaKey) &&\r\n//         (\r\n//           [\"c\", \"x\", \"t\", \"n\"].includes((e.key || \"\").toLowerCase()) ||\r\n//           (!isInput && [\"v\", \"p\"].includes((e.key || \"\").toLowerCase()))\r\n//         )\r\n//       ) {\r\n//         e.preventDefault();\r\n//         setTestEnded(true);\r\n//         return;\r\n//       }\r\n//       if (\r\n//         e.key === \"F12\" ||\r\n//         (e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"i\") ||\r\n//         (e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"c\")\r\n//       ) {\r\n//         e.preventDefault();\r\n//         setTestEnded(true);\r\n//       }\r\n//     };\r\n//     window.addEventListener(\"keydown\", onKey, true);\r\n\r\n//     // --- WINDOW RESIZE / MAXIMIZE / MINIMIZE / SNAP ---\r\n//     // Store initial dimensions for comparison (already state)\r\n//     const initial = { width: window.outerWidth, height: window.outerHeight };\r\n//     setInitialDimensions(initial);\r\n\r\n//     const handleResize = () => {\r\n//       // If minimized, outerWidth/outerHeight may be zero\r\n//       if (window.outerWidth === 0 && window.outerHeight === 0) {\r\n//         setTestEnded(true);\r\n//         return;\r\n//       }\r\n//       // End test if resized away from initial size (can allow margin if you wish)\r\n//       if (\r\n//         Math.abs(window.outerWidth - initial.width) > 5 ||\r\n//         Math.abs(window.outerHeight - initial.height) > 5\r\n//       ) {\r\n//         setTestEnded(true);\r\n//       }\r\n//     };\r\n//     window.addEventListener(\"resize\", handleResize);\r\n\r\n//     return () => {\r\n//       try { if (bc) bc.close(); } catch (err) {}\r\n//       document.removeEventListener(\"copy\", onCopy);\r\n//       document.removeEventListener(\"cut\", onCut);\r\n//       document.removeEventListener(\"paste\", onPaste);\r\n//       document.removeEventListener(\"contextmenu\", onContext);\r\n//       window.removeEventListener(\"keydown\", onKey, true);\r\n//       window.removeEventListener(\"resize\", handleResize);\r\n//     };\r\n//   }, []);\r\n\r\n//   const handleSelect = (id, val) => setAnswers({ ...answers, [id]: val });\r\n//   const goNext = () => currentIdx < questions.length - 1 && setCurrentIdx(currentIdx + 1);\r\n//   const goPrev = () => currentIdx > 0 && setCurrentIdx(currentIdx - 1);\r\n\r\n//   const handleSubmit = async () => {\r\n//     if (submitted) return;\r\n//     if (Object.keys(answers).length < questions.length) {\r\n//       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\r\n//     }\r\n//     let s = 0;\r\n//     questions.forEach((q) => {\r\n//       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s++;\r\n//     });\r\n//     setScore(s);\r\n//     setSubmitted(true);\r\n//     const formatted = questions.map((q) => ({\r\n//       question: q.questionText,\r\n//       userAnswer: answers[q._id] || \"Not answered\",\r\n//       correctAnswer: q.correctAnswer || \"\",\r\n//       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\r\n//       type: q.questionType,\r\n//     }));\r\n//     try {\r\n//       await API.tests.submit({\r\n//         name: fullName,\r\n//         email,\r\n//         answers: formatted,\r\n//         totalQuestions: questions.length,\r\n//         correctAnswers: s,\r\n//         scorePercent: ((s / questions.length) * 100).toFixed(2),\r\n//       });\r\n//       setResultSaved(true);\r\n//     } catch (err) {\r\n//       alert(\"Failed to save result to server.\");\r\n//     }\r\n//   };\r\n\r\n//   if (testEnded)\r\n//     return (\r\n//       <div className=\"container container-center text-center\">\r\n//         <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\r\n//         <p>You switched tabs, minimized, maximized, or resized the window.</p>\r\n//         <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n//           Go Home\r\n//         </button>\r\n//       </div>\r\n//     );\r\n//   if (testNotStarted)\r\n//     return (\r\n//       <div className=\"container container-center text-center\">\r\n//         <h3 className=\"text-warning\">‚ö†Ô∏è Test Not Active</h3>\r\n//         <p>Waiting for admin to start the test... Please restore the page for sometime while</p>\r\n//       </div>\r\n//     );\r\n//   if (errorMsg)\r\n//     return (\r\n//       <div className=\"container container-center text-center\">\r\n//         <h3 className=\"text-danger\">‚ùå Error</h3>\r\n//         <p>{errorMsg}</p>\r\n//       </div>\r\n//     );\r\n//   if (loading)\r\n//     return (\r\n//       <div className=\"container container-center text-center\">\r\n//         <h5>Loading questions‚Ä¶</h5>\r\n//       </div>\r\n//     );\r\n//   if (!questions.length)\r\n//     return (\r\n//       <div className=\"container container-center text-center\">\r\n//         <p>No questions available.</p>\r\n//       </div>\r\n//     );\r\n\r\n//   if (submitted && resultSaved) {\r\n//     return (\r\n//       <div className=\"container container-center text-center\">\r\n//         <div className=\"card card-clean p-4\">\r\n//           <h3 className=\"text-success\">üéâ Thank You for Completing the Test!</h3>\r\n//           <p>\r\n//             <strong>{fullName}</strong> ({email})\r\n//           </p>\r\n//           <p>Your responses have been recorded successfully.</p>\r\n//           <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n//             Go to Home\r\n//           </button>\r\n//         </div>\r\n//       </div>\r\n//     );\r\n//   }\r\n\r\n//   const currentQ = questions[currentIdx];\r\n//   const selectedAnswer = answers[currentQ._id] || \"\";\r\n\r\n//   return (\r\n//     <div className=\"test-container\">\r\n//       <div className=\"card test-card\">\r\n//         <div className=\"test-header d-flex justify-content-between align-items-center\">\r\n//           <div>\r\n//             <h5 className=\"text-danger fw-bold\">Candidate: {fullName}</h5>\r\n//             <small>{email}</small>\r\n//           </div>\r\n//           <div>\r\n//             <span className=\"badge bg-primary me-2\">\r\n//               Q {currentIdx + 1}/{questions.length}\r\n//             </span>\r\n//             <span className=\"badge bg-danger\">\r\n//               ‚è≥ {Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, \"0\")}\r\n//             </span>\r\n//           </div>\r\n//         </div>\r\n//         <div className=\"test-body\">\r\n//           <h6>\r\n//             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\r\n//           </h6>\r\n//           {currentQ.questionType === \"MCQ\" ? (\r\n//             <div className=\"options-container\">\r\n//               {currentQ.options.map((opt, i) => (\r\n//                 <label key={i} className={`option-item ${selectedAnswer === opt ? \"selected\" : \"\"}`}>\r\n//                   <input\r\n//                     type=\"radio\"\r\n//                     name={`question-${currentQ._id}`}\r\n//                     value={opt}\r\n//                     checked={selectedAnswer === opt}\r\n//                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n//                   />\r\n//                   {opt}\r\n//                 </label>\r\n//               ))}\r\n//             </div>\r\n//           ) : (\r\n//             <textarea\r\n//               className=\"theory-input\"\r\n//               placeholder=\"Type your answer...\"\r\n//               value={selectedAnswer}\r\n//               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n//               rows={5}\r\n//             />\r\n//           )}\r\n//         </div>\r\n//         <div className=\"test-footer d-flex justify-content-between\">\r\n//           <div>\r\n//             <button className=\"btn btn-secondary me-2\" disabled={currentIdx === 0} onClick={goPrev}>\r\n//               Previous\r\n//             </button>\r\n//             <button\r\n//               className=\"btn btn-secondary\"\r\n//               disabled={currentIdx === questions.length - 1}\r\n//               onClick={goNext}\r\n//             >\r\n//               Next\r\n//             </button>\r\n//           </div>\r\n//           <button className=\"btn btn-success\" onClick={handleSubmit}>\r\n//             Submit Test\r\n//           </button>\r\n//         </div>\r\n//       </div>\r\n//     </div>\r\n//   );\r\n// }\r\n\r\n// // import React, { useEffect, useState, useRef } from \"react\";\r\n// // import { useLocation, useNavigate } from \"react-router-dom\";\r\n// // import API from \"../services/api\";\r\n// // import \"../styles/TestPage.css\";\r\n\r\n// // export default function TestPage() {\r\n// //   const location = useLocation();\r\n// //   const navigate = useNavigate();\r\n// //   const { fullName, email } = location.state || {};\r\n\r\n// //   const [questions, setQuestions] = useState([]);\r\n// //   const [answers, setAnswers] = useState({});\r\n// //   const [currentIdx, setCurrentIdx] = useState(0);\r\n// //   const [loading, setLoading] = useState(true);\r\n// //   const [submitted, setSubmitted] = useState(false);\r\n// //   const [score, setScore] = useState(0);\r\n// //   const [resultSaved, setResultSaved] = useState(false);\r\n// //   const [testEnded, setTestEnded] = useState(false);\r\n// //   const [testNotStarted, setTestNotStarted] = useState(false);\r\n// //   const [errorMsg, setErrorMsg] = useState(\"\");\r\n// //   const [timeLeft, setTimeLeft] = useState(null);\r\n\r\n// //   // ‚úÖ Step 1 ‚Äî Load test control and questions\r\n// //   useEffect(() => {\r\n// //     if (!fullName || !email) {\r\n// //       navigate(\"/\");\r\n// //       return;\r\n// //     }\r\n\r\n// //     const loadTest = async () => {\r\n// //       console.log(\"üü¢ Step 1: Fetching /api/testcontrol ...\");\r\n// //       try {\r\n// //         const controlRes = await API.testcontrol.get();\r\n// //         console.log(\"‚úÖ Test Control Response:\", controlRes.data);\r\n\r\n// //         if (!controlRes?.data) {\r\n// //           console.log(\"‚ùå No test control found in DB\");\r\n// //           setTestNotStarted(true);\r\n// //           setLoading(false);\r\n// //           return;\r\n// //         }\r\n\r\n// //         const { isActive, questionLimit, timeLimit } = controlRes.data;\r\n\r\n// //         if (!isActive) {\r\n// //           console.log(\"‚ö†Ô∏è Test inactive. Waiting for admin to start...\");\r\n// //           setTestNotStarted(true);\r\n// //           setLoading(false);\r\n// //           return;\r\n// //         }\r\n\r\n// //         console.log(\"üü¢ Test is active. Now fetching questions...\");\r\n// //         const qRes = await API.questions.getAll();\r\n// //         console.log(\"‚úÖ Questions Response:\", qRes.data);\r\n\r\n// //         if (qRes.data?.error) {\r\n// //           console.log(\"‚ö†Ô∏è Backend says:\", qRes.data.error);\r\n// //           setErrorMsg(qRes.data.error);\r\n// //           setTestNotStarted(true);\r\n// //           setLoading(false);\r\n// //           return;\r\n// //         }\r\n\r\n// //         const list = Array.isArray(qRes.data.questions)\r\n// //           ? qRes.data.questions\r\n// //           : Array.isArray(qRes.data)\r\n// //           ? qRes.data\r\n// //           : [];\r\n\r\n// //         console.log(`üß© Loaded ${list.length} questions`);\r\n\r\n// //         if (!list.length) {\r\n// //           setErrorMsg(\"No questions available right now.\");\r\n// //         }\r\n\r\n// //         setQuestions(list.slice(0, questionLimit || list.length));\r\n// //         setTimeLeft((timeLimit || 30) * 60);\r\n// //       } catch (err) {\r\n// //         console.error(\"‚ùå Error fetching control/questions:\", err);\r\n// //         setErrorMsg(\"Could not load test. Check your backend connection.\");\r\n// //       } finally {\r\n// //         setLoading(false);\r\n// //         console.log(\"üü£ Finished loadTest()\");\r\n// //       }\r\n// //     };\r\n\r\n// //     loadTest();\r\n// //   }, [fullName, email, navigate]);\r\n\r\n// //   // ‚è± Countdown timer\r\n// //   useEffect(() => {\r\n// //     if (timeLeft === null) return;\r\n// //     if (timeLeft <= 0) {\r\n// //       alert(\"‚è∞ Time‚Äôs up! Submitting automatically...\");\r\n// //       handleSubmit();\r\n// //       return;\r\n// //     }\r\n// //     const t = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\r\n// //     return () => clearTimeout(t);\r\n// //   }, [timeLeft]);\r\n\r\n// //   // üö´ Detect tab switch\r\n// //   useEffect(() => {\r\n// //     const handleTab = () => {\r\n// //       if (document.hidden) setTestEnded(true);\r\n// //     };\r\n// //     document.addEventListener(\"visibilitychange\", handleTab);\r\n// //     return () => document.removeEventListener(\"visibilitychange\", handleTab);\r\n// //   }, []);\r\n\r\n// //   // üö® Anti-cheat: multi-tab detection, clipboard & shortcut blocking, contextmenu disable\r\n// //   useEffect(() => {\r\n// //     // unique id for this tab\r\n// //     const tabId = `${Date.now()}_${Math.random().toString(36).slice(2)}`;\r\n// //     const key = `test_tab_${tabId}`;\r\n// //     // write an initial heartbeat entry for this tab\r\n// //     try {\r\n// //       localStorage.setItem(key, String(Date.now()));\r\n// //     } catch (err) {\r\n// //       console.warn(\"localStorage unavailable:\", err);\r\n// //     }\r\n\r\n// //     // heartbeat to mark this tab as alive (so other tabs can detect it)\r\n// //     const hb = setInterval(() => {\r\n// //       try {\r\n// //         localStorage.setItem(key, String(Date.now()));\r\n// //       } catch (err) {\r\n// //         /* ignore */\r\n// //       }\r\n// //     }, 2000);\r\n\r\n// //     // storage event: fired on other tabs when localStorage changes ‚Äî if we see another tab key, end the test\r\n// //     const onStorage = (e) => {\r\n// //       if (!e.key) return;\r\n// //       // another tab created/updated a test_tab entry\r\n// //       if (e.key.startsWith(\"test_tab_\") && e.key !== key) {\r\n// //         console.warn(\"Detected another tab/window running the test:\", e.key);\r\n// //         setTestEnded(true);\r\n// //       }\r\n// //       // if a tab was removed and only this remains, no action needed here\r\n// //     };\r\n\r\n// //     window.addEventListener(\"storage\", onStorage);\r\n\r\n// //     // block copy/cut/paste/contextmenu and suspicious shortcuts ‚Äî end test when attempted\r\n// //     const blockAndEnd = (e) => {\r\n// //       try {\r\n// //         if (e) e.preventDefault();\r\n// //       } catch (err) {}\r\n// //       console.warn(\"Blocked action while test active - ending test.\");\r\n// //       setTestEnded(true);\r\n// //     };\r\n\r\n// //     const onCopy = (e) => blockAndEnd(e);\r\n// //     const onCut = (e) => blockAndEnd(e);\r\n// //     const onPaste = (e) => blockAndEnd(e);\r\n// //     const onContext = (e) => {\r\n// //       // prevent right click and consider as suspicious\r\n// //       blockAndEnd(e);\r\n// //     };\r\n\r\n// //     document.addEventListener(\"copy\", onCopy);\r\n// //     document.addEventListener(\"cut\", onCut);\r\n// //     document.addEventListener(\"paste\", onPaste);\r\n// //     document.addEventListener(\"contextmenu\", onContext);\r\n\r\n// //     // block keyboard shortcuts that could be used to copy or open new tabs/devtools\r\n// //     const onKey = (e) => {\r\n// //       const target = e.target || {};\r\n// //       const tag = target.tagName || \"\";\r\n// //       const isInput = tag === \"INPUT\" || tag === \"TEXTAREA\" || target.isContentEditable;\r\n\r\n// //       // allow normal typing inside inputs/textareas\r\n// //       if (isInput) return;\r\n\r\n// //       // suspicious combos\r\n// //       if ((e.ctrlKey || e.metaKey) && [\"c\", \"x\", \"v\", \"p\", \"t\", \"n\"].includes((e.key || \"\").toLowerCase())) {\r\n// //         e.preventDefault();\r\n// //         setTestEnded(true);\r\n// //         return;\r\n// //       }\r\n\r\n// //       // devtools keys\r\n// //       if (e.key === \"F12\" || (e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"i\") || (e.ctrlKey && e.shiftKey && (e.key || \"\").toLowerCase() === \"c\")) {\r\n// //         e.preventDefault();\r\n// //         setTestEnded(true);\r\n// //       }\r\n// //     };\r\n\r\n// //     window.addEventListener(\"keydown\", onKey, true);\r\n\r\n// //     // cleanup on unload\r\n// //     const cleanup = () => {\r\n// //       try {\r\n// //         localStorage.removeItem(key);\r\n// //       } catch (err) {}\r\n// //     };\r\n\r\n// //     window.addEventListener(\"beforeunload\", cleanup);\r\n\r\n// //     return () => {\r\n// //       clearInterval(hb);\r\n// //       try {\r\n// //         localStorage.removeItem(key);\r\n// //       } catch (err) {}\r\n// //       window.removeEventListener(\"storage\", onStorage);\r\n// //       document.removeEventListener(\"copy\", onCopy);\r\n// //       document.removeEventListener(\"cut\", onCut);\r\n// //       document.removeEventListener(\"paste\", onPaste);\r\n// //       document.removeEventListener(\"contextmenu\", onContext);\r\n// //       window.removeEventListener(\"keydown\", onKey, true);\r\n// //       window.removeEventListener(\"beforeunload\", cleanup);\r\n// //     };\r\n// //   }, []);\r\n\r\n// //   const handleSelect = (id, val) => setAnswers({ ...answers, [id]: val });\r\n// //   const goNext = () => currentIdx < questions.length - 1 && setCurrentIdx(currentIdx + 1);\r\n// //   const goPrev = () => currentIdx > 0 && setCurrentIdx(currentIdx - 1);\r\n\r\n// //   const handleSubmit = async () => {\r\n// //     if (submitted) return;\r\n// //     if (Object.keys(answers).length < questions.length) {\r\n// //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\r\n// //     }\r\n\r\n// //     let s = 0;\r\n// //     questions.forEach((q) => {\r\n// //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s++;\r\n// //     });\r\n// //     setScore(s);\r\n// //     setSubmitted(true);\r\n\r\n// //     const formatted = questions.map((q) => ({\r\n// //       question: q.questionText,\r\n// //       userAnswer: answers[q._id] || \"Not answered\",\r\n// //       correctAnswer: q.correctAnswer || \"\",\r\n// //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\r\n// //       type: q.questionType,\r\n// //     }));\r\n\r\n// //     try {\r\n// //       await API.tests.submit({\r\n// //         name: fullName,\r\n// //         email,\r\n// //         answers: formatted,\r\n// //         totalQuestions: questions.length,\r\n// //         correctAnswers: s,\r\n// //         scorePercent: ((s / questions.length) * 100).toFixed(2),\r\n// //       });\r\n// //       setResultSaved(true);\r\n// //     } catch (err) {\r\n// //       console.error(\"‚ùå Error saving result:\", err);\r\n// //       alert(\"Failed to save result to server.\");\r\n// //     }\r\n// //   };\r\n\r\n// //   // ‚ö†Ô∏è If user switched tab\r\n// //   if (testEnded)\r\n// //     return (\r\n// //       <div className=\"container container-center text-center\">\r\n// //         <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\r\n// //         <p>You switched tabs or reloaded.</p>\r\n// //         <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n// //           Go Home\r\n// //         </button>\r\n// //       </div>\r\n// //     );\r\n\r\n// //   // ‚ö†Ô∏è Test Not Started\r\n// //   if (testNotStarted)\r\n// //     return (\r\n// //       <div className=\"container container-center text-center\">\r\n// //         <h3 className=\"text-warning\">‚ö†Ô∏è Test Not Active</h3>\r\n// //         <p>Waiting for admin to start the test... Please restore the page for sometime while</p>\r\n// //         {/* <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n// //           Back to Home\r\n// //         </button> */}\r\n// //       </div>\r\n// //     );\r\n\r\n// //   // ‚ùå Error\r\n// //   if (errorMsg)\r\n// //     return (\r\n// //       <div className=\"container container-center text-center\">\r\n// //         <h3 className=\"text-danger\">‚ùå Error</h3>\r\n// //         <p>{errorMsg}</p>\r\n// //       </div>\r\n// //     );\r\n\r\n// //   // ‚è≥ Loading\r\n// //   if (loading)\r\n// //     return (\r\n// //       <div className=\"container container-center text-center\">\r\n// //         <h5>Loading questions‚Ä¶</h5>\r\n// //       </div>\r\n// //     );\r\n\r\n// //   if (!questions.length)\r\n// //     return (\r\n// //       <div className=\"container container-center text-center\">\r\n// //         <p>No questions available.</p>\r\n// //       </div>\r\n// //     );\r\n\r\n// //     // ‚úÖ After submitting show thank-you message\r\n// // if (submitted && resultSaved) {\r\n// //   return (\r\n// //     <div className=\"container container-center text-center\">\r\n// //       <div className=\"card card-clean p-4\">\r\n// //         <h3 className=\"text-success\">üéâ Thank You for Completing the Test!</h3>\r\n// //         <p>\r\n// //           <strong>{fullName}</strong> ({email})\r\n// //         </p>\r\n// //         <p>Your responses have been recorded successfully.</p>\r\n// //         <button\r\n// //           className=\"btn btn-primary mt-3\"\r\n// //           onClick={() => navigate(\"/\")}\r\n// //         >\r\n// //           Go to Home\r\n// //         </button>\r\n// //       </div>\r\n// //     </div>\r\n// //   );\r\n// // }\r\n\r\n// //   // ‚úÖ Main Test View\r\n// //   const currentQ = questions[currentIdx];\r\n// //   const selectedAnswer = answers[currentQ._id] || \"\";\r\n\r\n// //   return (\r\n// //     <div className=\"test-container\">\r\n// //       <div className=\"card test-card\">\r\n// //         <div className=\"test-header d-flex justify-content-between align-items-center\">\r\n// //           <div>\r\n// //             <h5 className=\"text-danger fw-bold\">Candidate: {fullName}</h5>\r\n// //             <small>{email}</small>\r\n// //           </div>\r\n// //           <div>\r\n// //             <span className=\"badge bg-primary me-2\">\r\n// //               Q {currentIdx + 1}/{questions.length}\r\n// //             </span>\r\n// //             <span className=\"badge bg-danger\">\r\n// //               ‚è≥ {Math.floor(timeLeft / 60)}:\r\n// //               {(timeLeft % 60).toString().padStart(2, \"0\")}\r\n// //             </span>\r\n// //           </div>\r\n// //         </div>\r\n\r\n// //         <div className=\"test-body\">\r\n// //           <h6>\r\n// //             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\r\n// //           </h6>\r\n\r\n// //           {currentQ.questionType === \"MCQ\" ? (\r\n// //             <div className=\"options-container\">\r\n// //               {currentQ.options.map((opt, i) => (\r\n// //                 <label key={i} className={`option-item ${selectedAnswer === opt ? \"selected\" : \"\"}`}>\r\n// //                   <input\r\n// //                     type=\"radio\"\r\n// //                     name={`question-${currentQ._id}`}\r\n// //                     value={opt}\r\n// //                     checked={selectedAnswer === opt}\r\n// //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// //                   />\r\n// //                   {opt}\r\n// //                 </label>\r\n// //               ))}\r\n// //             </div>\r\n// //           ) : (\r\n// //             <textarea\r\n// //               className=\"theory-input\"\r\n// //               placeholder=\"Type your answer...\"\r\n// //               value={selectedAnswer}\r\n// //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// //               rows={5}\r\n// //             />\r\n// //           )}\r\n// //         </div>\r\n\r\n// //         <div className=\"test-footer d-flex justify-content-between\">\r\n// //           <div>\r\n// //             <button className=\"btn btn-secondary me-2\" disabled={currentIdx === 0} onClick={goPrev}>\r\n// //               Previous\r\n// //             </button>\r\n// //             <button\r\n// //               className=\"btn btn-secondary\"\r\n// //               disabled={currentIdx === questions.length - 1}\r\n// //               onClick={goNext}\r\n// //             >\r\n// //               Next\r\n// //             </button>\r\n// //           </div>\r\n// //           <button className=\"btn btn-success\" onClick={handleSubmit}>\r\n// //             Submit Test\r\n// //           </button>\r\n// //         </div>\r\n// //       </div>\r\n// //     </div>\r\n// //   );\r\n// // }\r\n\r\n// // // import React, { useEffect, useState } from \"react\";\r\n// // // import { useLocation, useNavigate } from \"react-router-dom\";\r\n// // // import API from \"../services/api\";\r\n// // // import \"../styles/TestPage.css\";\r\n\r\n// // // export default function TestPage() {\r\n// // //   const location = useLocation();\r\n// // //   const navigate = useNavigate();\r\n// // //   const { fullName, email } = location.state || {};\r\n\r\n// // //   const [questions, setQuestions] = useState([]);\r\n// // //   const [answers, setAnswers] = useState({});\r\n// // //   const [currentIdx, setCurrentIdx] = useState(0);\r\n// // //   const [loading, setLoading] = useState(true);\r\n// // //   const [submitted, setSubmitted] = useState(false);\r\n// // //   const [score, setScore] = useState(0);\r\n// // //   const [resultSaved, setResultSaved] = useState(false);\r\n// // //   const [testEnded, setTestEnded] = useState(false);\r\n// // //   const [testNotStarted, setTestNotStarted] = useState(false);\r\n// // //   const [errorMsg, setErrorMsg] = useState(\"\");\r\n// // //   const [timeLeft, setTimeLeft] = useState(null);\r\n\r\n// // //   // üß© Step 1: Load test control ‚Üí questions\r\n// // //   useEffect(() => {\r\n// // //     if (!fullName || !email) {\r\n// // //       navigate(\"/\");\r\n// // //       return;\r\n// // //     }\r\n\r\n// // //     const loadTest = async () => {\r\n// // //       console.log(\"üü¢ Loading test control...\");\r\n// // //       try {\r\n// // //         const controlRes = await API.testcontrol.get();\r\n// // //         console.log(\"‚úÖ Test control response:\", controlRes.data);\r\n\r\n// // //         if (!controlRes?.data) {\r\n// // //           console.log(\"‚ùå No control data found\");\r\n// // //           setTestNotStarted(true);\r\n// // //           setLoading(false);\r\n// // //           return;\r\n// // //         }\r\n\r\n// // //         const { isActive, questionLimit, timeLimit } = controlRes.data;\r\n\r\n// // //         if (!isActive) {\r\n// // //           console.log(\"‚ö†Ô∏è Test is inactive (waiting for admin)\");\r\n// // //           setTestNotStarted(true);\r\n// // //           setLoading(false);\r\n// // //           return;\r\n// // //         }\r\n\r\n// // //         console.log(\"üü¢ Test is active, fetching questions...\");\r\n// // //         const qRes = await API.questions.getAll();\r\n// // //         console.log(\"‚úÖ Questions response:\", qRes.data);\r\n\r\n// // //         if (qRes.data?.error) {\r\n// // //           console.log(\"‚ö†Ô∏è Backend says:\", qRes.data.error);\r\n// // //           setTestNotStarted(true);\r\n// // //           setLoading(false);\r\n// // //           return;\r\n// // //         }\r\n\r\n// // //         const questionsList = Array.isArray(qRes.data.questions)\r\n// // //           ? qRes.data.questions\r\n// // //           : Array.isArray(qRes.data)\r\n// // //           ? qRes.data\r\n// // //           : [];\r\n\r\n// // //         console.log(\"üß© Questions loaded:\", questionsList.length);\r\n\r\n// // //         if (!questionsList.length) {\r\n// // //           setErrorMsg(\"No questions found. Contact admin.\");\r\n// // //         }\r\n\r\n// // //         setQuestions(questionsList.slice(0, questionLimit || questionsList.length));\r\n// // //         setTimeLeft((timeLimit || 30) * 60);\r\n// // //       } catch (err) {\r\n// // //         console.error(\"‚ùå Error during loadTest():\", err);\r\n// // //         setErrorMsg(\"Failed to fetch test details.\");\r\n// // //       } finally {\r\n// // //         console.log(\"üü£ Finished loading test data\");\r\n// // //         setLoading(false);\r\n// // //       }\r\n// // //     };\r\n\r\n// // //     loadTest();\r\n// // //   }, [fullName, email, navigate]);\r\n\r\n// // //   // üïí Countdown\r\n// // //   useEffect(() => {\r\n// // //     if (timeLeft === null) return;\r\n// // //     if (timeLeft <= 0) {\r\n// // //       alert(\"‚è∞ Time‚Äôs up! Submitting automatically.\");\r\n// // //       handleSubmit();\r\n// // //       return;\r\n// // //     }\r\n// // //     const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\r\n// // //     return () => clearTimeout(timer);\r\n// // //   }, [timeLeft]);\r\n\r\n// // //   // üö´ Prevent tab switch\r\n// // //   useEffect(() => {\r\n// // //     const handleVisibility = () => {\r\n// // //       if (document.hidden) setTestEnded(true);\r\n// // //     };\r\n// // //     document.addEventListener(\"visibilitychange\", handleVisibility);\r\n// // //     return () => document.removeEventListener(\"visibilitychange\", handleVisibility);\r\n// // //   }, []);\r\n\r\n// // //   const handleSelect = (id, value) => {\r\n// // //     setAnswers({ ...answers, [id]: value });\r\n// // //   };\r\n\r\n// // //   const goNext = () => currentIdx < questions.length - 1 && setCurrentIdx(currentIdx + 1);\r\n// // //   const goPrev = () => currentIdx > 0 && setCurrentIdx(currentIdx - 1);\r\n\r\n// // //   const handleSubmit = async () => {\r\n// // //     if (submitted) return;\r\n// // //     if (Object.keys(answers).length < questions.length) {\r\n// // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\r\n// // //     }\r\n\r\n// // //     let s = 0;\r\n// // //     questions.forEach((q) => {\r\n// // //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s++;\r\n// // //     });\r\n// // //     setScore(s);\r\n// // //     setSubmitted(true);\r\n\r\n// // //     const formatted = questions.map((q) => ({\r\n// // //       question: q.questionText,\r\n// // //       userAnswer: answers[q._id] || \"Not answered\",\r\n// // //       correctAnswer: q.correctAnswer || \"\",\r\n// // //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\r\n// // //       type: q.questionType,\r\n// // //     }));\r\n\r\n// // //     try {\r\n// // //       await API.tests.submit({\r\n// // //         name: fullName,\r\n// // //         email,\r\n// // //         answers: formatted,\r\n// // //         totalQuestions: questions.length,\r\n// // //         correctAnswers: s,\r\n// // //         scorePercent: ((s / questions.length) * 100).toFixed(2),\r\n// // //       });\r\n// // //       setResultSaved(true);\r\n// // //     } catch (err) {\r\n// // //       console.error(\"Error saving result:\", err);\r\n// // //       alert(\"Failed to save result to server.\");\r\n// // //     }\r\n// // //   };\r\n\r\n// // //   // ‚ö†Ô∏è Test Ended\r\n// // //   if (testEnded)\r\n// // //     return (\r\n// // //       <div className=\"container container-center text-center\">\r\n// // //         <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\r\n// // //         <p>You left or reloaded the page.</p>\r\n// // //         <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n// // //           Go Home\r\n// // //         </button>\r\n// // //       </div>\r\n// // //     );\r\n\r\n// // //   // ‚ö†Ô∏è Test Not Started\r\n// // //   if (testNotStarted)\r\n// // //     return (\r\n// // //       <div className=\"container container-center text-center\">\r\n// // //         <h3 className=\"text-warning\">‚ö†Ô∏è Test Not Active</h3>\r\n// // //         <p>Waiting for admin to start the test.</p>\r\n// // //         <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n// // //           Back to Home\r\n// // //         </button>\r\n// // //       </div>\r\n// // //     );\r\n\r\n// // //   // ‚ùå Error state\r\n// // //   if (errorMsg)\r\n// // //     return (\r\n// // //       <div className=\"container container-center text-center\">\r\n// // //         <h3 className=\"text-danger\">‚ùå Error</h3>\r\n// // //         <p>{errorMsg}</p>\r\n// // //         <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n// // //           Go to Home\r\n// // //         </button>\r\n// // //       </div>\r\n// // //     );\r\n\r\n// // //   // ‚è≥ Loading\r\n// // //   if (loading)\r\n// // //     return (\r\n// // //       <div className=\"container container-center text-center\">\r\n// // //         <h5>Loading questions‚Ä¶</h5>\r\n// // //       </div>\r\n// // //     );\r\n\r\n// // //   if (!questions.length)\r\n// // //     return (\r\n// // //       <div className=\"container container-center text-center\">\r\n// // //         <p>No questions available.</p>\r\n// // //       </div>\r\n// // //     );\r\n\r\n// // //   // ‚úÖ Active Test Screen\r\n// // //   const currentQ = questions[currentIdx];\r\n// // //   const selectedAnswer = answers[currentQ._id] || \"\";\r\n\r\n// // //   return (\r\n// // //     <div className=\"test-container\">\r\n// // //       <div className=\"card test-card\">\r\n// // //         <div className=\"test-header d-flex justify-content-between align-items-center\">\r\n// // //           <div>\r\n// // //             <h5 className=\"text-danger fw-bold\">Candidate: {fullName}</h5>\r\n// // //             <small>{email}</small>\r\n// // //           </div>\r\n// // //           <div>\r\n// // //             <span className=\"badge bg-primary me-2\">\r\n// // //               Q {currentIdx + 1}/{questions.length}\r\n// // //             </span>\r\n// // //             <span className=\"badge bg-danger\">\r\n// // //               ‚è≥ {Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, \"0\")}\r\n// // //             </span>\r\n// // //           </div>\r\n// // //         </div>\r\n\r\n// // //         <div className=\"test-body\">\r\n// // //           <h6>\r\n// // //             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\r\n// // //           </h6>\r\n\r\n// // //           {currentQ.questionType === \"MCQ\" ? (\r\n// // //             <div className=\"options-container\">\r\n// // //               {currentQ.options.map((opt, i) => (\r\n// // //                 <label\r\n// // //                   key={i}\r\n// // //                   className={`option-item ${selectedAnswer === opt ? \"selected\" : \"\"}`}\r\n// // //                 >\r\n// // //                   <input\r\n// // //                     type=\"radio\"\r\n// // //                     name={`question-${currentQ._id}`}\r\n// // //                     value={opt}\r\n// // //                     checked={selectedAnswer === opt}\r\n// // //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// // //                   />\r\n// // //                   {opt}\r\n// // //                 </label>\r\n// // //               ))}\r\n// // //             </div>\r\n// // //           ) : (\r\n// // //             <textarea\r\n// // //               className=\"theory-input\"\r\n// // //               placeholder=\"Type your answer here...\"\r\n// // //               value={selectedAnswer}\r\n// // //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// // //               rows={5}\r\n// // //             />\r\n// // //           )}\r\n// // //         </div>\r\n\r\n// // //         <div className=\"test-footer d-flex justify-content-between\">\r\n// // //           <div>\r\n// // //             <button className=\"btn btn-secondary me-2\" disabled={currentIdx === 0} onClick={goPrev}>\r\n// // //               Previous\r\n// // //             </button>\r\n// // //             <button\r\n// // //               className=\"btn btn-secondary\"\r\n// // //               disabled={currentIdx === questions.length - 1}\r\n// // //               onClick={goNext}\r\n// // //             >\r\n// // //               Next\r\n// // //             </button>\r\n// // //           </div>\r\n// // //           <button className=\"btn btn-success\" onClick={handleSubmit}>\r\n// // //             Submit Test\r\n// // //           </button>\r\n// // //         </div>\r\n// // //       </div>\r\n// // //     </div>\r\n// // //   );\r\n// // // }\r\n\r\n// // // // import React, { useEffect, useState } from \"react\";\r\n// // // // import { useLocation, useNavigate } from \"react-router-dom\";\r\n// // // // import API from \"../services/api\";\r\n// // // // import \"../styles/TestPage.css\";\r\n\r\n// // // // export default function TestPage() {\r\n// // // //   const location = useLocation();\r\n// // // //   const navigate = useNavigate();\r\n// // // //   const { fullName, email } = location.state || {};\r\n\r\n// // // //   const [questions, setQuestions] = useState([]);\r\n// // // //   const [answers, setAnswers] = useState({});\r\n// // // //   const [currentIdx, setCurrentIdx] = useState(0);\r\n// // // //   const [loading, setLoading] = useState(true);\r\n// // // //   const [submitted, setSubmitted] = useState(false);\r\n// // // //   const [score, setScore] = useState(0);\r\n// // // //   const [resultSaved, setResultSaved] = useState(false);\r\n// // // //   const [testEnded, setTestEnded] = useState(false);\r\n// // // //   const [testNotStarted, setTestNotStarted] = useState(false);\r\n// // // //   const [timeLeft, setTimeLeft] = useState(null);\r\n\r\n// // // //   // üü¢ Fetch test control and questions only when test is active\r\n// // // //   useEffect(() => {\r\n// // // //     if (!fullName || !email) {\r\n// // // //       navigate(\"/\");\r\n// // // //       return;\r\n// // // //     }\r\n\r\n// // // //     const initTest = async () => {\r\n// // // //       try {\r\n// // // //         // 1Ô∏è‚É£ Fetch test control first\r\n// // // //         const controlRes = await API.testcontrol.get();\r\n// // // //         const control = controlRes.data;\r\n\r\n// // // //         if (!control || !control.isActive) {\r\n// // // //           setTestNotStarted(true);\r\n// // // //           setLoading(false);\r\n// // // //           return;\r\n// // // //         }\r\n\r\n// // // //         // 2Ô∏è‚É£ Fetch all questions\r\n// // // //         const questionRes = await API.questions.getAll();\r\n// // // //         const allQuestions = Array.isArray(questionRes.data)\r\n// // // //           ? questionRes.data\r\n// // // //           : [];\r\n\r\n// // // //         // 3Ô∏è‚É£ Limit number of questions from admin config\r\n// // // //         const limitedQuestions = allQuestions.slice(0, control.questionLimit || allQuestions.length);\r\n\r\n// // // //         setQuestions(limitedQuestions);\r\n// // // //         setTimeLeft((control.timeLimit || 10) * 60); // Convert minutes to seconds\r\n// // // //       } catch (err) {\r\n// // // //         console.error(\"‚ùå Error initializing test:\", err);\r\n// // // //         setTestNotStarted(true);\r\n// // // //       } finally {\r\n// // // //         setLoading(false);\r\n// // // //       }\r\n// // // //     };\r\n\r\n// // // //     initTest();\r\n// // // //   }, [fullName, email, navigate]);\r\n\r\n// // // //   // üïí Countdown timer\r\n// // // //   useEffect(() => {\r\n// // // //     if (timeLeft === null) return;\r\n// // // //     if (timeLeft <= 0) {\r\n// // // //       alert(\"‚è∞ Time‚Äôs up! Submitting your test automatically.\");\r\n// // // //       handleSubmit();\r\n// // // //       return;\r\n// // // //     }\r\n\r\n// // // //     const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\r\n// // // //     return () => clearTimeout(timer);\r\n// // // //   }, [timeLeft]);\r\n\r\n// // // //   // üõë Detect tab switch, reload, or page exit\r\n// // // //   useEffect(() => {\r\n// // // //     const handleBeforeUnload = (e) => {\r\n// // // //       e.preventDefault();\r\n// // // //       e.returnValue = \"\";\r\n// // // //       setTestEnded(true);\r\n// // // //     };\r\n\r\n// // // //     const handleVisibilityChange = () => {\r\n// // // //       if (document.hidden) {\r\n// // // //         setTestEnded(true);\r\n// // // //       }\r\n// // // //     };\r\n\r\n// // // //     window.addEventListener(\"beforeunload\", handleBeforeUnload);\r\n// // // //     document.addEventListener(\"visibilitychange\", handleVisibilityChange);\r\n\r\n// // // //     return () => {\r\n// // // //       window.removeEventListener(\"beforeunload\", handleBeforeUnload);\r\n// // // //       document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\r\n// // // //     };\r\n// // // //   }, []);\r\n\r\n// // // //   const handleSelect = (questionId, value) => {\r\n// // // //     setAnswers({ ...answers, [questionId]: value });\r\n// // // //   };\r\n\r\n// // // //   const goNext = () => {\r\n// // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\r\n// // // //   };\r\n// // // //   const goPrev = () => {\r\n// // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\r\n// // // //   };\r\n\r\n// // // //   const handleSubmit = async () => {\r\n// // // //     if (submitted) return;\r\n// // // //     if (Object.keys(answers).length < questions.length) {\r\n// // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\r\n// // // //     }\r\n\r\n// // // //     let s = 0;\r\n// // // //     questions.forEach((q) => {\r\n// // // //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s += 1;\r\n// // // //     });\r\n// // // //     setScore(s);\r\n// // // //     setSubmitted(true);\r\n\r\n// // // //     const formattedAnswers = questions.map((q) => ({\r\n// // // //       question: q.questionText,\r\n// // // //       userAnswer: answers[q._id] || \"Not answered\",\r\n// // // //       correctAnswer: q.correctAnswer || \"\",\r\n// // // //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\r\n// // // //       type: q.questionType || \"Theory\",\r\n// // // //     }));\r\n\r\n// // // //     try {\r\n// // // //       await API.tests.submit({\r\n// // // //         name: fullName,\r\n// // // //         email,\r\n// // // //         answers: formattedAnswers,\r\n// // // //         totalQuestions: questions.length,\r\n// // // //         correctAnswers: s,\r\n// // // //         scorePercent: ((s / questions.length) * 100).toFixed(2),\r\n// // // //       });\r\n// // // //       setResultSaved(true);\r\n// // // //     } catch (err) {\r\n// // // //       console.error(\"Error saving result:\", err);\r\n// // // //       alert(\"Failed to save result to server.\");\r\n// // // //     }\r\n// // // //   };\r\n\r\n// // // //   // üõë If user switched tab or reloaded\r\n// // // //   if (testEnded) {\r\n// // // //     return (\r\n// // // //       <div className=\"container container-center\">\r\n// // // //         <div className=\"card card-clean p-4 text-center\">\r\n// // // //           <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\r\n// // // //           <p>Your session ended because you switched tabs or reloaded.</p>\r\n// // // //           <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n// // // //             Go to Home\r\n// // // //           </button>\r\n// // // //         </div>\r\n// // // //       </div>\r\n// // // //     );\r\n// // // //   }\r\n\r\n// // // //   // üõë If test not started\r\n// // // //   if (testNotStarted) {\r\n// // // //     return (\r\n// // // //       <div className=\"container container-center\">\r\n// // // //         <div className=\"card card-clean p-4 text-center\">\r\n// // // //           <h3 className=\"text-warning\">‚ö†Ô∏è Test Not Active</h3>\r\n// // // //           <p>The test has not been started by admin yet.</p>\r\n// // // //           <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n// // // //             Back to Home\r\n// // // //           </button>\r\n// // // //         </div>\r\n// // // //       </div>\r\n// // // //     );\r\n// // // //   }\r\n\r\n// // // //   // üü¢ Loading\r\n// // // //   if (loading)\r\n// // // //     return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\r\n\r\n// // // //   if (!questions || questions.length === 0)\r\n// // // //     return <div className=\"container container-center\">No questions available.</div>;\r\n\r\n// // // //   // üü¢ After submit\r\n// // // //   if (submitted) {\r\n// // // //     return (\r\n// // // //       <div className=\"container container-center\">\r\n// // // //         <div className=\"card card-clean p-4\">\r\n// // // //           <h3 className=\"text-success\">‚úÖ Test Completed</h3>\r\n// // // //           <p>\r\n// // // //             <strong>{fullName}</strong> ({email})\r\n// // // //           </p>\r\n// // // //           <h4>\r\n// // // //             Your Score: {score} / {questions.length}\r\n// // // //           </h4>\r\n\r\n// // // //           {resultSaved && (\r\n// // // //             <div className=\"alert alert-success mt-2\">\r\n// // // //               ‚úÖ Your result has been recorded successfully!\r\n// // // //             </div>\r\n// // // //           )}\r\n\r\n// // // //           <hr />\r\n// // // //           <h5>Review Answers</h5>\r\n// // // //           <div>\r\n// // // //             {questions.map((q, idx) => (\r\n// // // //               <div className=\"review-question\" key={q._id}>\r\n// // // //                 <b>Q{idx + 1}:</b> {q.questionText}\r\n// // // //                 <div>\r\n// // // //                   Your answer:{\" \"}\r\n// // // //                   <span\r\n// // // //                     className={\r\n// // // //                       q.questionType === \"MCQ\"\r\n// // // //                         ? answers[q._id] === q.correctAnswer\r\n// // // //                           ? \"text-success\"\r\n// // // //                           : \"text-danger\"\r\n// // // //                         : \"text-primary\"\r\n// // // //                     }\r\n// // // //                   >\r\n// // // //                     {answers[q._id] || \"Not answered\"}\r\n// // // //                   </span>\r\n// // // //                 </div>\r\n// // // //                 {q.questionType === \"MCQ\" && (\r\n// // // //                   <div>\r\n// // // //                     Correct answer:{\" \"}\r\n// // // //                     <span className=\"text-success\">{q.correctAnswer}</span>\r\n// // // //                   </div>\r\n// // // //                 )}\r\n// // // //               </div>\r\n// // // //             ))}\r\n// // // //           </div>\r\n\r\n// // // //           <div className=\"mt-4\">\r\n// // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>\r\n// // // //               Back to Home\r\n// // // //             </button>\r\n// // // //             <button\r\n// // // //               className=\"btn btn-outline-secondary\"\r\n// // // //               onClick={() => window.location.reload()}\r\n// // // //             >\r\n// // // //               Retake Test\r\n// // // //             </button>\r\n// // // //           </div>\r\n// // // //         </div>\r\n// // // //       </div>\r\n// // // //     );\r\n// // // //   }\r\n\r\n// // // //   // üü¢ Active test page\r\n// // // //   const currentQ = questions[currentIdx];\r\n// // // //   const selectedAnswer = answers[currentQ._id] || \"\";\r\n\r\n// // // //   return (\r\n// // // //     <div className=\"test-container\">\r\n// // // //       <div className=\"card test-card\">\r\n// // // //         <div className=\"test-header\">\r\n// // // //           <div>\r\n// // // //             <h5 className=\"text-danger fw-bold\">Candidate: {fullName}</h5>\r\n// // // //             <small className=\"text-muted\">{email}</small>\r\n// // // //           </div>\r\n// // // //           <div>\r\n// // // //             <span className=\"badge bg-primary me-2\">\r\n// // // //               Question {currentIdx + 1} / {questions.length}\r\n// // // //             </span>\r\n// // // //             <span className=\"badge bg-danger\">\r\n// // // //               ‚è≥ {Math.floor(timeLeft / 60)}:\r\n// // // //               {(timeLeft % 60).toString().padStart(2, \"0\")}\r\n// // // //             </span>\r\n// // // //           </div>\r\n// // // //         </div>\r\n\r\n// // // //         <div className=\"test-body\">\r\n// // // //           <h6 className=\"question-text\">\r\n// // // //             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\r\n// // // //           </h6>\r\n\r\n// // // //           {currentQ.questionType === \"MCQ\" && currentQ.options?.length > 0 ? (\r\n// // // //             <div className=\"options-container\">\r\n// // // //               {currentQ.options.map((opt, i) => (\r\n// // // //                 <label\r\n// // // //                   key={i}\r\n// // // //                   className={`option-item ${\r\n// // // //                     selectedAnswer === opt ? \"selected\" : \"\"\r\n// // // //                   }`}\r\n// // // //                 >\r\n// // // //                   <input\r\n// // // //                     type=\"radio\"\r\n// // // //                     name={`question-${currentQ._id}`}\r\n// // // //                     value={opt}\r\n// // // //                     checked={selectedAnswer === opt}\r\n// // // //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// // // //                   />\r\n// // // //                   {opt}\r\n// // // //                 </label>\r\n// // // //               ))}\r\n// // // //             </div>\r\n// // // //           ) : (\r\n// // // //             <textarea\r\n// // // //               className=\"theory-input\"\r\n// // // //               placeholder=\"Type your answer here...\"\r\n// // // //               value={selectedAnswer}\r\n// // // //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// // // //               rows={5}\r\n// // // //             ></textarea>\r\n// // // //           )}\r\n// // // //         </div>\r\n\r\n// // // //         <div className=\"test-footer\">\r\n// // // //           <div>\r\n// // // //             <button\r\n// // // //               className=\"btn btn-secondary me-3\"\r\n// // // //               onClick={goPrev}\r\n// // // //               disabled={currentIdx === 0}\r\n// // // //             >\r\n// // // //               Previous\r\n// // // //             </button>\r\n// // // //             <button\r\n// // // //               className=\"btn btn-secondary\"\r\n// // // //               onClick={goNext}\r\n// // // //               disabled={currentIdx === questions.length - 1}\r\n// // // //             >\r\n// // // //               Next\r\n// // // //             </button>\r\n// // // //           </div>\r\n\r\n// // // //           <div>\r\n// // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>\r\n// // // //               Submit Test\r\n// // // //             </button>\r\n// // // //           </div>\r\n// // // //         </div>\r\n// // // //       </div>\r\n// // // //     </div>\r\n// // // //   );\r\n// // // // }\r\n\r\n// // // // // import React, { useEffect, useState } from \"react\";\r\n// // // // // import { useLocation, useNavigate } from \"react-router-dom\";\r\n// // // // // import API from \"../services/api\";\r\n// // // // // import \"../styles/TestPage.css\";\r\n\r\n// // // // // export default function TestPage() {\r\n// // // // //   const location = useLocation();\r\n// // // // //   const navigate = useNavigate();\r\n// // // // //   const { fullName, email } = location.state || {};\r\n\r\n// // // // //   const [questions, setQuestions] = useState([]);\r\n// // // // //   const [answers, setAnswers] = useState({});\r\n// // // // //   const [currentIdx, setCurrentIdx] = useState(0);\r\n// // // // //   const [loading, setLoading] = useState(true);\r\n// // // // //   const [submitted, setSubmitted] = useState(false);\r\n// // // // //   const [score, setScore] = useState(0);\r\n// // // // //   const [resultSaved, setResultSaved] = useState(false);\r\n// // // // //   const [testEnded, setTestEnded] = useState(false);\r\n// // // // //   const [testNotStarted, setTestNotStarted] = useState(false);\r\n// // // // //   const [timeLeft, setTimeLeft] = useState(null);\r\n\r\n// // // // //   // üü¢ Fetch questions only when test is active\r\n// // // // //   useEffect(() => {\r\n// // // // //     if (!fullName || !email) {\r\n// // // // //       navigate(\"/\");\r\n// // // // //       return;\r\n// // // // //     }\r\n\r\n// // // // //     const fetchQuestions = async () => {\r\n// // // // //       try {\r\n// // // // //         const res = await API.questions.getAll();\r\n\r\n// // // // //         // üõë If test is not active\r\n// // // // //         if (res.data?.error || !res.data?.isActive) {\r\n// // // // //           setTestNotStarted(true);\r\n// // // // //           setLoading(false);\r\n// // // // //           return;\r\n// // // // //         }\r\n\r\n// // // // //         const questionsArray = Array.isArray(res.data)\r\n// // // // //           ? res.data\r\n// // // // //           : res.data.questions || [];\r\n\r\n// // // // //         setQuestions(questionsArray);\r\n// // // // //         setTimeLeft((res.data.timeLimit || 10) * 60); // Convert minutes ‚Üí seconds\r\n// // // // //       } catch (err) {\r\n// // // // //         console.error(err);\r\n// // // // //         alert(\"Failed to fetch questions. Please wait for admin to start the test.\");\r\n// // // // //         setTestNotStarted(true);\r\n// // // // //       } finally {\r\n// // // // //         setLoading(false);\r\n// // // // //       }\r\n// // // // //     };\r\n\r\n// // // // //     fetchQuestions();\r\n// // // // //   }, [fullName, email, navigate]);\r\n\r\n// // // // //   // üïí Countdown timer\r\n// // // // //   useEffect(() => {\r\n// // // // //     if (timeLeft === null) return;\r\n// // // // //     if (timeLeft <= 0) {\r\n// // // // //       alert(\"‚è∞ Time‚Äôs up! Submitting your test automatically.\");\r\n// // // // //       handleSubmit();\r\n// // // // //       return;\r\n// // // // //     }\r\n\r\n// // // // //     const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\r\n// // // // //     return () => clearTimeout(timer);\r\n// // // // //   }, [timeLeft]);\r\n\r\n// // // // //   // üõë Detect tab switch, reload, or page exit\r\n// // // // //   useEffect(() => {\r\n// // // // //     const handleBeforeUnload = (e) => {\r\n// // // // //       e.preventDefault();\r\n// // // // //       e.returnValue = \"\";\r\n// // // // //       setTestEnded(true);\r\n// // // // //     };\r\n\r\n// // // // //     const handleVisibilityChange = () => {\r\n// // // // //       if (document.hidden) {\r\n// // // // //         setTestEnded(true);\r\n// // // // //       }\r\n// // // // //     };\r\n\r\n// // // // //     window.addEventListener(\"beforeunload\", handleBeforeUnload);\r\n// // // // //     document.addEventListener(\"visibilitychange\", handleVisibilityChange);\r\n\r\n// // // // //     return () => {\r\n// // // // //       window.removeEventListener(\"beforeunload\", handleBeforeUnload);\r\n// // // // //       document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\r\n// // // // //     };\r\n// // // // //   }, []);\r\n\r\n// // // // //   // üü¢ Select answer\r\n// // // // //   const handleSelect = (questionId, value) => {\r\n// // // // //     setAnswers({ ...answers, [questionId]: value });\r\n// // // // //   };\r\n\r\n// // // // //   // üü¢ Navigation\r\n// // // // //   const goNext = () => {\r\n// // // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\r\n// // // // //   };\r\n// // // // //   const goPrev = () => {\r\n// // // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\r\n// // // // //   };\r\n\r\n// // // // //   // üü¢ Submit handler\r\n// // // // //   const handleSubmit = async () => {\r\n// // // // //     if (submitted) return; // Prevent multiple submits\r\n// // // // //     if (Object.keys(answers).length < questions.length) {\r\n// // // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\r\n// // // // //     }\r\n\r\n// // // // //     // Calculate score (for MCQs only)\r\n// // // // //     let s = 0;\r\n// // // // //     questions.forEach((q) => {\r\n// // // // //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s += 1;\r\n// // // // //     });\r\n\r\n// // // // //     setScore(s);\r\n// // // // //     setSubmitted(true);\r\n\r\n// // // // //     const formattedAnswers = questions.map((q) => ({\r\n// // // // //       question: q.questionText,\r\n// // // // //       userAnswer: answers[q._id] || \"Not answered\",\r\n// // // // //       correctAnswer: q.correctAnswer || \"\",\r\n// // // // //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\r\n// // // // //       type: q.questionType || \"Theory\",\r\n// // // // //     }));\r\n\r\n// // // // //     try {\r\n// // // // //       await API.tests.submit({\r\n// // // // //         name: fullName,\r\n// // // // //         email,\r\n// // // // //         answers: formattedAnswers,\r\n// // // // //         totalQuestions: questions.length,\r\n// // // // //         correctAnswers: s,\r\n// // // // //         scorePercent: ((s / questions.length) * 100).toFixed(2),\r\n// // // // //       });\r\n// // // // //       setResultSaved(true);\r\n// // // // //     } catch (err) {\r\n// // // // //       console.error(\"Error saving result:\", err);\r\n// // // // //       alert(\"Failed to save result to server.\");\r\n// // // // //     }\r\n// // // // //   };\r\n\r\n// // // // //   // üõë If user switched tab or reloaded\r\n// // // // //   if (testEnded) {\r\n// // // // //     return (\r\n// // // // //       <div className=\"container container-center\">\r\n// // // // //         <div className=\"card card-clean p-4 text-center\">\r\n// // // // //           <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\r\n// // // // //           <p>Your session ended because you switched tabs, reloaded, or left the page.</p>\r\n// // // // //           <h4 className=\"mt-3 text-success\">Thank you for your time!</h4>\r\n// // // // //           <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n// // // // //             Go to Home\r\n// // // // //           </button>\r\n// // // // //         </div>\r\n// // // // //       </div>\r\n// // // // //     );\r\n// // // // //   }\r\n\r\n// // // // //   // üõë If test not started\r\n// // // // //   if (testNotStarted) {\r\n// // // // //     return (\r\n// // // // //       <div className=\"container container-center\">\r\n// // // // //         <div className=\"card card-clean p-4 text-center\">\r\n// // // // //           <h3 className=\"text-warning\">‚ö†Ô∏è Test Not Active</h3>\r\n// // // // //           <p>The test has not been started by admin yet.</p>\r\n// // // // //           <h5 className=\"mt-2\">Please contact the administrator to begin your test.</h5>\r\n// // // // //           <button className=\"btn btn-primary mt-3\" onClick={() => navigate(\"/\")}>\r\n// // // // //             Back to Home\r\n// // // // //           </button>\r\n// // // // //         </div>\r\n// // // // //       </div>\r\n// // // // //     );\r\n// // // // //   }\r\n\r\n// // // // //   // üü¢ Loading\r\n// // // // //   if (loading) return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\r\n// // // // //   if (!questions || questions.length === 0)\r\n// // // // //     return <div className=\"container container-center\">No questions available. Please try later.</div>;\r\n\r\n// // // // //   // üü¢ After submit (Review screen)\r\n// // // // //   if (submitted) {\r\n// // // // //     return (\r\n// // // // //       <div className=\"container container-center\">\r\n// // // // //         <div className=\"card card-clean p-4\">\r\n// // // // //           <h3 className=\"text-success\">Test Completed Successfully</h3>\r\n// // // // //           <p>\r\n// // // // //             <strong>{fullName}</strong> ({email})\r\n// // // // //           </p>\r\n// // // // //           <h4>\r\n// // // // //             Your Score: {score} / {questions.length}\r\n// // // // //           </h4>\r\n\r\n// // // // //           {resultSaved && (\r\n// // // // //             <div className=\"alert alert-success mt-2\">\r\n// // // // //               ‚úÖ Your result has been recorded successfully!\r\n// // // // //             </div>\r\n// // // // //           )}\r\n\r\n// // // // //           <hr />\r\n// // // // //           <h5>Review Answers</h5>\r\n// // // // //           <div>\r\n// // // // //             {questions.map((q, idx) => (\r\n// // // // //               <div className=\"review-question\" key={q._id}>\r\n// // // // //                 <b>Q{idx + 1}:</b> {q.questionText}\r\n// // // // //                 <div>\r\n// // // // //                   Your answer:{\" \"}\r\n// // // // //                   <span\r\n// // // // //                     className={\r\n// // // // //                       q.questionType === \"MCQ\"\r\n// // // // //                         ? answers[q._id] === q.correctAnswer\r\n// // // // //                           ? \"text-success\"\r\n// // // // //                           : \"text-danger\"\r\n// // // // //                         : \"text-primary\"\r\n// // // // //                     }\r\n// // // // //                   >\r\n// // // // //                     {answers[q._id] || \"Not answered\"}\r\n// // // // //                   </span>\r\n// // // // //                 </div>\r\n// // // // //                 {q.questionType === \"MCQ\" && (\r\n// // // // //                   <div>\r\n// // // // //                     Correct answer:{\" \"}\r\n// // // // //                     <span className=\"text-success\">{q.correctAnswer}</span>\r\n// // // // //                   </div>\r\n// // // // //                 )}\r\n// // // // //               </div>\r\n// // // // //             ))}\r\n// // // // //           </div>\r\n\r\n// // // // //           <div className=\"mt-4\">\r\n// // // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>\r\n// // // // //               Back to Home\r\n// // // // //             </button>\r\n// // // // //             <button className=\"btn btn-outline-secondary\" onClick={() => window.location.reload()}>\r\n// // // // //               Retake Test\r\n// // // // //             </button>\r\n// // // // //           </div>\r\n// // // // //         </div>\r\n// // // // //       </div>\r\n// // // // //     );\r\n// // // // //   }\r\n\r\n// // // // //   // üü¢ Active test page\r\n// // // // //   const currentQ = questions[currentIdx];\r\n// // // // //   const selectedAnswer = answers[currentQ._id] || \"\";\r\n\r\n// // // // //   return (\r\n// // // // //     <div className=\"test-container\">\r\n// // // // //       <div className=\"card test-card\">\r\n// // // // //         <div className=\"test-header\">\r\n// // // // //           <div>\r\n// // // // //             <h5 className=\"text-danger fw-bold\">Candidate: {fullName}</h5>\r\n// // // // //             <small className=\"text-muted\">{email}</small>\r\n// // // // //           </div>\r\n// // // // //           <div>\r\n// // // // //             <span className=\"badge bg-primary me-2\">\r\n// // // // //               Question {currentIdx + 1} / {questions.length}\r\n// // // // //             </span>\r\n// // // // //             <span className=\"badge bg-danger\">\r\n// // // // //               ‚è≥ {Math.floor(timeLeft / 60)}:\r\n// // // // //               {(timeLeft % 60).toString().padStart(2, \"0\")}\r\n// // // // //             </span>\r\n// // // // //           </div>\r\n// // // // //         </div>\r\n\r\n// // // // //         <div className=\"test-body\">\r\n// // // // //           <h6 className=\"question-text\">\r\n// // // // //             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\r\n// // // // //           </h6>\r\n\r\n// // // // //           {currentQ.questionType === \"MCQ\" && currentQ.options?.length > 0 ? (\r\n// // // // //             <div className=\"options-container\">\r\n// // // // //               {currentQ.options.map((opt, i) => (\r\n// // // // //                 <label\r\n// // // // //                   key={i}\r\n// // // // //                   className={`option-item ${\r\n// // // // //                     selectedAnswer === opt ? \"selected\" : \"\"\r\n// // // // //                   }`}\r\n// // // // //                 >\r\n// // // // //                   <input\r\n// // // // //                     type=\"radio\"\r\n// // // // //                     name={`question-${currentQ._id}`}\r\n// // // // //                     value={opt}\r\n// // // // //                     checked={selectedAnswer === opt}\r\n// // // // //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// // // // //                   />\r\n// // // // //                   {opt}\r\n// // // // //                 </label>\r\n// // // // //               ))}\r\n// // // // //             </div>\r\n// // // // //           ) : (\r\n// // // // //             <textarea\r\n// // // // //               className=\"theory-input\"\r\n// // // // //               placeholder=\"Type your answer here...\"\r\n// // // // //               value={selectedAnswer}\r\n// // // // //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// // // // //               rows={5}\r\n// // // // //             ></textarea>\r\n// // // // //           )}\r\n// // // // //         </div>\r\n\r\n// // // // //         <div className=\"test-footer\">\r\n// // // // //           <div>\r\n// // // // //             <button\r\n// // // // //               className=\"btn btn-secondary me-3\"\r\n// // // // //               onClick={goPrev}\r\n// // // // //               disabled={currentIdx === 0}\r\n// // // // //             >\r\n// // // // //               Previous\r\n// // // // //             </button>\r\n// // // // //             <button\r\n// // // // //               className=\"btn btn-secondary\"\r\n// // // // //               onClick={goNext}\r\n// // // // //               disabled={currentIdx === questions.length - 1}\r\n// // // // //             >\r\n// // // // //               Next\r\n// // // // //             </button>\r\n// // // // //           </div>\r\n\r\n// // // // //           <div>\r\n// // // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>\r\n// // // // //               Submit Test\r\n// // // // //             </button>\r\n// // // // //           </div>\r\n// // // // //         </div>\r\n// // // // //       </div>\r\n// // // // //     </div>\r\n// // // // //   );\r\n// // // // // }\r\n\r\n\r\n// // // // // import React, { useEffect, useState } from \"react\";\r\n// // // // // import { useLocation, useNavigate } from \"react-router-dom\";\r\n// // // // // import API from \"../services/api\";\r\n// // // // // import \"../styles/TestPage.css\";\r\n\r\n\r\n// // // // // function pickRandom(arr, n) {\r\n// // // // //   const copy = [...arr];\r\n// // // // //   const res = [];\r\n// // // // //   while (res.length < n && copy.length > 0) {\r\n// // // // //     const idx = Math.floor(Math.random() * copy.length);\r\n// // // // //     res.push(copy.splice(idx, 1)[0]);\r\n// // // // //   }\r\n// // // // //   return res;\r\n// // // // // }\r\n\r\n// // // // // export default function TestPage() {\r\n// // // // //   const location = useLocation();\r\n// // // // //   const navigate = useNavigate();\r\n// // // // //   const { fullName, email, numQ } = location.state || {};\r\n\r\n// // // // //   const [allQuestions, setAllQuestions] = useState([]);\r\n// // // // //   const [questions, setQuestions] = useState([]);\r\n// // // // //   const [answers, setAnswers] = useState({});\r\n// // // // //   const [currentIdx, setCurrentIdx] = useState(0);\r\n// // // // //   const [loading, setLoading] = useState(true);\r\n// // // // //   const [submitted, setSubmitted] = useState(false);\r\n// // // // //   const [score, setScore] = useState(0);\r\n// // // // //   const [resultSaved, setResultSaved] = useState(false);\r\n// // // // //   const [testEnded, setTestEnded] = useState(false); // üÜï detect tab switch/reload\r\n// // // // //   const [timeLeft, setTimeLeft] = useState(null);\r\n\r\n// // // // //   // üü¢ Fetch questions\r\n// // // // //   useEffect(() => {\r\n// // // // //     if (!fullName || !email) {\r\n// // // // //       navigate(\"/\");\r\n// // // // //       return;\r\n// // // // //     }\r\n\r\n// // // // //     const fetchQuestions = async () => {\r\n// // // // //   try {\r\n// // // // //     const res = await API.questions.getAll();\r\n// // // // //     if (res.data.error) {\r\n// // // // //       alert(res.data.error);\r\n// // // // //       navigate(\"/\");\r\n// // // // //       return;\r\n// // // // //     }\r\n\r\n// // // // //     setQuestions(res.data.questions || []);\r\n// // // // //     setTimeLeft(res.data.timeLimit * 60); // seconds\r\n// // // // //   } catch (err) {\r\n// // // // //     console.error(err);\r\n// // // // //     alert(\"Failed to fetch questions. Please wait for admin to start the test.\");\r\n// // // // //     navigate(\"/\");\r\n// // // // //   } finally {\r\n// // // // //     setLoading(false);\r\n// // // // //   }\r\n// // // // // };\r\n\r\n\r\n// // // // //     fetchQuestions();\r\n// // // // //   }, [fullName, email, navigate]);\r\n\r\n// // // // //   // üü¢ Pick random questions\r\n// // // // //   useEffect(() => {\r\n// // // // //     if (!loading && allQuestions.length > 0) {\r\n// // // // //       const selected = pickRandom(allQuestions, Math.min(numQ || 10, allQuestions.length));\r\n// // // // //       setQuestions(selected);\r\n// // // // //     }\r\n// // // // //   }, [loading, allQuestions, numQ]);\r\n\r\n// // // // //   // üõë Detect tab switch, reload, or page exit\r\n// // // // //   useEffect(() => {\r\n// // // // //     const handleBeforeUnload = (e) => {\r\n// // // // //       e.preventDefault();\r\n// // // // //       e.returnValue = \"\";\r\n// // // // //       setTestEnded(true);\r\n// // // // //     };\r\n\r\n// // // // //     const handleVisibilityChange = () => {\r\n// // // // //       if (document.hidden) {\r\n// // // // //         setTestEnded(true);\r\n// // // // //       }\r\n// // // // //     };\r\n\r\n// // // // //     window.addEventListener(\"beforeunload\", handleBeforeUnload);\r\n// // // // //     document.addEventListener(\"visibilitychange\", handleVisibilityChange);\r\n\r\n// // // // //     return () => {\r\n// // // // //       window.removeEventListener(\"beforeunload\", handleBeforeUnload);\r\n// // // // //       document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\r\n// // // // //     };\r\n// // // // //   }, []);\r\n\r\n// // // // //   const handleSelect = (questionId, value) => {\r\n// // // // //     setAnswers({ ...answers, [questionId]: value });\r\n// // // // //   };\r\n\r\n// // // // //   const goNext = () => {\r\n// // // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\r\n// // // // //   };\r\n// // // // //   const goPrev = () => {\r\n// // // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\r\n// // // // //   };\r\n\r\n// // // // //   // üü¢ Submit handler\r\n// // // // //   const handleSubmit = async () => {\r\n// // // // //     if (Object.keys(answers).length < questions.length) {\r\n// // // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\r\n// // // // //     }\r\n\r\n// // // // //     // Calculate score only for MCQs\r\n// // // // //     let s = 0;\r\n// // // // //     questions.forEach((q) => {\r\n// // // // //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s += 1;\r\n// // // // //     });\r\n// // // // //     setScore(s);\r\n// // // // //     setSubmitted(true);\r\n\r\n// // // // //     // Prepare formatted answers\r\n// // // // //     const formattedAnswers = questions.map((q) => ({\r\n// // // // //       question: q.questionText,\r\n// // // // //       userAnswer: answers[q._id] || \"Not answered\",\r\n// // // // //       correctAnswer: q.correctAnswer || \"\",\r\n// // // // //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\r\n// // // // //       type: q.questionType || \"Theory\",\r\n// // // // //     }));\r\n\r\n// // // // //     try {\r\n// // // // //       await API.tests.submit({\r\n// // // // //         name: fullName,\r\n// // // // //         email,\r\n// // // // //         answers: formattedAnswers,\r\n// // // // //         totalQuestions: questions.length,\r\n// // // // //         correctAnswers: s,\r\n// // // // //         scorePercent: ((s / questions.length) * 100).toFixed(2),\r\n// // // // //       });\r\n// // // // //       setResultSaved(true);\r\n// // // // //     } catch (err) {\r\n// // // // //       console.error(\"Error saving result:\", err);\r\n// // // // //       alert(\"Failed to save result to server.\");\r\n// // // // //     }\r\n// // // // //   };\r\n\r\n// // // // //   // üõë If test was ended (tab switch or reload)\r\n// // // // //   if (testEnded) {\r\n// // // // //     return (\r\n// // // // //       <div className=\"container container-center\">\r\n// // // // //         <div className=\"card card-clean p-4 text-center\">\r\n// // // // //           <h3 className=\"text-danger\">‚ö†Ô∏è Test Ended</h3>\r\n// // // // //           <p>Your test session has ended because you switched tabs, reloaded, or left the page.</p>\r\n// // // // //           <h4 className=\"mt-3 text-success\">Thank you for your time!</h4>\r\n// // // // //           <button\r\n// // // // //             className=\"btn btn-primary mt-3\"\r\n// // // // //             onClick={() => navigate(\"/\")}\r\n// // // // //           >\r\n// // // // //             Go to Home\r\n// // // // //           </button>\r\n// // // // //         </div>\r\n// // // // //       </div>\r\n// // // // //     );\r\n// // // // //   }\r\n\r\n// // // // //   if (loading) return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\r\n// // // // //   if (!questions || questions.length === 0)\r\n// // // // //     return <div className=\"container container-center\">No questions available. Please try later.</div>;\r\n\r\n// // // // //   if (submitted) {\r\n// // // // //     return (\r\n// // // // //       <div className=\"container container-center\">\r\n// // // // //         <div className=\"card card-clean p-4\">\r\n// // // // //           <h3 className=\"text-success\">Test Completed Successfully</h3>\r\n// // // // //           <p><strong>{fullName}</strong> ({email})</p>\r\n// // // // //           <h4>Your Score: {score} / {questions.length}</h4>\r\n\r\n// // // // //           {resultSaved && (\r\n// // // // //             <div className=\"alert alert-success mt-2\">\r\n// // // // //               ‚úÖ Your result has been recorded successfully!\r\n// // // // //             </div>\r\n// // // // //           )}\r\n\r\n// // // // //           <hr />\r\n// // // // //           <h5>Review Answers</h5>\r\n// // // // //           <div>\r\n// // // // //             {questions.map((q, idx) => (\r\n// // // // //               <div className=\"review-question\" key={q._id}>\r\n// // // // //                 <b>Q{idx + 1}:</b> {q.questionText}\r\n// // // // //                 <div>\r\n// // // // //                   Your answer:{\" \"}\r\n// // // // //                   <span\r\n// // // // //                     className={\r\n// // // // //                       q.questionType === \"MCQ\"\r\n// // // // //                         ? answers[q._id] === q.correctAnswer\r\n// // // // //                           ? \"text-success\"\r\n// // // // //                           : \"text-danger\"\r\n// // // // //                         : \"text-primary\"\r\n// // // // //                     }\r\n// // // // //                   >\r\n// // // // //                     {answers[q._id] || \"Not answered\"}\r\n// // // // //                   </span>\r\n// // // // //                 </div>\r\n// // // // //                 {q.questionType === \"MCQ\" && (\r\n// // // // //                   <div>\r\n// // // // //                     Correct answer:{\" \"}\r\n// // // // //                     <span className=\"text-success\">{q.correctAnswer}</span>\r\n// // // // //                   </div>\r\n// // // // //                 )}\r\n// // // // //               </div>\r\n// // // // //             ))}\r\n// // // // //           </div>\r\n\r\n// // // // //           <div className=\"mt-4\">\r\n// // // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>\r\n// // // // //               Back to Home\r\n// // // // //             </button>\r\n// // // // //             <button className=\"btn btn-outline-secondary\" onClick={() => window.location.reload()}>\r\n// // // // //               Retake Test\r\n// // // // //             </button>\r\n// // // // //           </div>\r\n// // // // //         </div>\r\n// // // // //       </div>\r\n// // // // //     );\r\n// // // // //   }\r\n\r\n// // // // //   const currentQ = questions[currentIdx];\r\n// // // // //   const selectedAnswer = answers[currentQ._id] || \"\";\r\n\r\n// // // // //   return (\r\n// // // // //     <div className=\"test-container\">\r\n// // // // //       <div className=\"card test-card\">\r\n// // // // //         <div className=\"test-header\">\r\n// // // // //           <div>\r\n// // // // //             <h5 className=\"text-danger fw-bold\">\r\n// // // // //               Candidate: {fullName.toLowerCase()}\r\n// // // // //             </h5>\r\n// // // // //             <small className=\"text-muted\">{email}</small>\r\n// // // // //           </div>\r\n// // // // //           <div>\r\n// // // // //             <span className=\"badge bg-primary\">\r\n// // // // //               Question {currentIdx + 1} / {questions.length}\r\n// // // // //             </span>\r\n// // // // //           </div>\r\n// // // // //         </div>\r\n\r\n// // // // //         <div className=\"test-body\">\r\n// // // // //           <h6 className=\"question-text\">\r\n// // // // //             <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\r\n// // // // //           </h6>\r\n\r\n// // // // //           {currentQ.questionType === \"MCQ\" && currentQ.options?.length > 0 ? (\r\n// // // // //             <div className=\"options-container\">\r\n// // // // //               {currentQ.options.map((opt, i) => (\r\n// // // // //                 <label\r\n// // // // //                   key={i}\r\n// // // // //                   className={`option-item ${\r\n// // // // //                     selectedAnswer === opt ? \"selected\" : \"\"\r\n// // // // //                   }`}\r\n// // // // //                 >\r\n// // // // //                   <input\r\n// // // // //                     type=\"radio\"\r\n// // // // //                     name={`question-${currentQ._id}`}\r\n// // // // //                     value={opt}\r\n// // // // //                     checked={selectedAnswer === opt}\r\n// // // // //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// // // // //                   />\r\n// // // // //                   {opt}\r\n// // // // //                 </label>\r\n// // // // //               ))}\r\n// // // // //             </div>\r\n// // // // //           ) : (\r\n// // // // //             <textarea\r\n// // // // //               className=\"theory-input\"\r\n// // // // //               placeholder=\"Type your answer here...\"\r\n// // // // //               value={selectedAnswer}\r\n// // // // //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// // // // //               rows={5}\r\n// // // // //             ></textarea>\r\n// // // // //           )}\r\n// // // // //         </div>\r\n\r\n// // // // //         <div className=\"test-footer\">\r\n// // // // //           <div>\r\n// // // // //             <button\r\n// // // // //               className=\"btn btn-secondary me-3\"\r\n// // // // //               onClick={goPrev}\r\n// // // // //               disabled={currentIdx === 0}\r\n// // // // //             >\r\n// // // // //               Previous\r\n// // // // //             </button>\r\n// // // // //             <button\r\n// // // // //               className=\"btn btn-secondary\"\r\n// // // // //               onClick={goNext}\r\n// // // // //               disabled={currentIdx === questions.length - 1}\r\n// // // // //             >\r\n// // // // //               Next\r\n// // // // //             </button>\r\n// // // // //           </div>\r\n\r\n// // // // //           <div>\r\n// // // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>\r\n// // // // //               Submit Test\r\n// // // // //             </button>\r\n// // // // //           </div>\r\n// // // // //         </div>\r\n// // // // //       </div>\r\n// // // // //     </div>\r\n// // // // //   );\r\n// // // // // }\r\n\r\n// // // // // // import React, { useEffect, useState } from \"react\";\r\n// // // // // // import { useLocation, useNavigate } from \"react-router-dom\";\r\n// // // // // // import API from \"../services/api\";\r\n// // // // // // import \"../styles/TestPage.css\";\r\n\r\n// // // // // // function pickRandom(arr, n) {\r\n// // // // // //   const copy = [...arr];\r\n// // // // // //   const res = [];\r\n// // // // // //   while (res.length < n && copy.length > 0) {\r\n// // // // // //     const idx = Math.floor(Math.random() * copy.length);\r\n// // // // // //     res.push(copy.splice(idx, 1)[0]);\r\n// // // // // //   }\r\n// // // // // //   return res;\r\n// // // // // // }\r\n\r\n// // // // // // export default function TestPage() {\r\n// // // // // //   const location = useLocation();\r\n// // // // // //   const navigate = useNavigate();\r\n// // // // // //   const { fullName, email, numQ } = location.state || {};\r\n\r\n// // // // // //   const [allQuestions, setAllQuestions] = useState([]);\r\n// // // // // //   const [questions, setQuestions] = useState([]);\r\n// // // // // //   const [answers, setAnswers] = useState({});\r\n// // // // // //   const [currentIdx, setCurrentIdx] = useState(0);\r\n// // // // // //   const [loading, setLoading] = useState(true);\r\n// // // // // //   const [submitted, setSubmitted] = useState(false);\r\n// // // // // //   const [score, setScore] = useState(0);\r\n// // // // // //   const [resultSaved, setResultSaved] = useState(false);\r\n\r\n// // // // // //   // üü¢ Fetch questions\r\n// // // // // //   useEffect(() => {\r\n// // // // // //     if (!fullName || !email) {\r\n// // // // // //       navigate(\"/\");\r\n// // // // // //       return;\r\n// // // // // //     }\r\n\r\n// // // // // //     const fetchQuestions = async () => {\r\n// // // // // //       try {\r\n// // // // // //         const res = await API.questions.getAll();\r\n// // // // // //         setAllQuestions(res.data || []);\r\n// // // // // //       } catch (err) {\r\n// // // // // //         console.error(err);\r\n// // // // // //         alert(\"Failed to fetch questions from server.\");\r\n// // // // // //       } finally {\r\n// // // // // //         setLoading(false);\r\n// // // // // //       }\r\n// // // // // //     };\r\n\r\n// // // // // //     fetchQuestions();\r\n// // // // // //   }, [fullName, email, navigate]);\r\n\r\n// // // // // //   // üü¢ Pick random questions\r\n// // // // // //   useEffect(() => {\r\n// // // // // //     if (!loading && allQuestions.length > 0) {\r\n// // // // // //       const selected = pickRandom(allQuestions, Math.min(numQ || 10, allQuestions.length));\r\n// // // // // //       setQuestions(selected);\r\n// // // // // //     }\r\n// // // // // //   }, [loading, allQuestions, numQ]);\r\n\r\n// // // // // //   const handleSelect = (questionId, value) => {\r\n// // // // // //     setAnswers({ ...answers, [questionId]: value });\r\n// // // // // //   };\r\n\r\n// // // // // //   const goNext = () => {\r\n// // // // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\r\n// // // // // //   };\r\n// // // // // //   const goPrev = () => {\r\n// // // // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\r\n// // // // // //   };\r\n\r\n// // // // // //   // üü¢ Submit handler\r\n// // // // // //   const handleSubmit = async () => {\r\n// // // // // //     if (Object.keys(answers).length < questions.length) {\r\n// // // // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\r\n// // // // // //     }\r\n\r\n// // // // // //     // Calculate score only for MCQs\r\n// // // // // //     let s = 0;\r\n// // // // // //     questions.forEach((q) => {\r\n// // // // // //       if (q.questionType === \"MCQ\" && answers[q._id] === q.correctAnswer) s += 1;\r\n// // // // // //     });\r\n// // // // // //     setScore(s);\r\n// // // // // //     setSubmitted(true);\r\n\r\n// // // // // //     // Prepare formatted answers\r\n// // // // // //     const formattedAnswers = questions.map((q) => ({\r\n// // // // // //       question: q.questionText,\r\n// // // // // //       userAnswer: answers[q._id] || \"Not answered\",\r\n// // // // // //       correctAnswer: q.correctAnswer || \"\",\r\n// // // // // //       isCorrect: q.questionType === \"MCQ\" ? answers[q._id] === q.correctAnswer : null,\r\n// // // // // //       type: q.questionType || \"Theory\",\r\n// // // // // //     }));\r\n\r\n// // // // // //     try {\r\n// // // // // //       await API.tests.submit({\r\n// // // // // //         name: fullName,\r\n// // // // // //         email,\r\n// // // // // //         answers: formattedAnswers,\r\n// // // // // //         totalQuestions: questions.length,\r\n// // // // // //         correctAnswers: s,\r\n// // // // // //         scorePercent: ((s / questions.length) * 100).toFixed(2),\r\n// // // // // //       });\r\n// // // // // //       setResultSaved(true);\r\n// // // // // //     } catch (err) {\r\n// // // // // //       console.error(\"Error saving result:\", err);\r\n// // // // // //       alert(\"Failed to save result to server.\");\r\n// // // // // //     }\r\n// // // // // //   };\r\n\r\n// // // // // //   if (loading) return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\r\n// // // // // //   if (!questions || questions.length === 0)\r\n// // // // // //     return <div className=\"container container-center\">No questions available. Please try later.</div>;\r\n\r\n// // // // // //   if (submitted) {\r\n// // // // // //     return (\r\n// // // // // //       <div className=\"container container-center\">\r\n// // // // // //         <div className=\"card card-clean p-4\">\r\n// // // // // //           <h3 className=\"text-success\">Test Completed Successfully</h3>\r\n// // // // // //           <p><strong>{fullName}</strong> ({email})</p>\r\n// // // // // //           <h4>Your Score: {score} / {questions.length}</h4>\r\n\r\n// // // // // //           {resultSaved && (\r\n// // // // // //             <div className=\"alert alert-success mt-2\">\r\n// // // // // //               ‚úÖ Your result has been recorded successfully!\r\n// // // // // //             </div>\r\n// // // // // //           )}\r\n\r\n// // // // // //           <hr />\r\n// // // // // //           <h5>Review Answers</h5>\r\n// // // // // //           <div>\r\n// // // // // //             {questions.map((q, idx) => (\r\n// // // // // //               <div className=\"review-question\" key={q._id}>\r\n// // // // // //                 <b>Q{idx + 1}:</b> {q.questionText}\r\n// // // // // //                 <div>\r\n// // // // // //                   Your answer:{\" \"}\r\n// // // // // //                   <span\r\n// // // // // //                     className={\r\n// // // // // //                       q.questionType === \"MCQ\"\r\n// // // // // //                         ? answers[q._id] === q.correctAnswer\r\n// // // // // //                           ? \"text-success\"\r\n// // // // // //                           : \"text-danger\"\r\n// // // // // //                         : \"text-primary\"\r\n// // // // // //                     }\r\n// // // // // //                   >\r\n// // // // // //                     {answers[q._id] || \"Not answered\"}\r\n// // // // // //                   </span>\r\n// // // // // //                 </div>\r\n// // // // // //                 {q.questionType === \"MCQ\" && (\r\n// // // // // //                   <div>\r\n// // // // // //                     Correct answer:{\" \"}\r\n// // // // // //                     <span className=\"text-success\">{q.correctAnswer}</span>\r\n// // // // // //                   </div>\r\n// // // // // //                 )}\r\n// // // // // //               </div>\r\n// // // // // //             ))}\r\n// // // // // //           </div>\r\n\r\n// // // // // //           <div className=\"mt-4\">\r\n// // // // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>\r\n// // // // // //               Back to Home\r\n// // // // // //             </button>\r\n// // // // // //             <button className=\"btn btn-outline-secondary\" onClick={() => window.location.reload()}>\r\n// // // // // //               Retake Test\r\n// // // // // //             </button>\r\n// // // // // //           </div>\r\n// // // // // //         </div>\r\n// // // // // //       </div>\r\n// // // // // //     );\r\n// // // // // //   }\r\n\r\n// // // // // //   const currentQ = questions[currentIdx];\r\n// // // // // //   const selectedAnswer = answers[currentQ._id] || \"\";\r\n\r\n// // // // // //   return (\r\n// // // // // //     <div className=\"test-container\">\r\n// // // // // //       <div className=\"card test-card\">\r\n// // // // // //         <div className=\"test-header\">\r\n// // // // // //           <div>\r\n// // // // // //             <h5 className=\"text-danger fw-bold\">\r\n// // // // // //               Candidate: {fullName.toLowerCase()}\r\n// // // // // //             </h5>\r\n// // // // // //             <small className=\"text-muted\">{email}</small>\r\n// // // // // //           </div>\r\n// // // // // //           <div>\r\n// // // // // //             <span className=\"badge bg-primary\">\r\n// // // // // //               Question {currentIdx + 1} / {questions.length}\r\n// // // // // //             </span>\r\n// // // // // //           </div>\r\n// // // // // //         </div>\r\n\r\n// // // // // //         <div className=\"test-body\">\r\n// // // // // //           <h6 className=\"question-text\">\r\n// // // // // //              <b>Q{currentIdx + 1}:</b> {currentQ.questionText}\r\n// // // // // //           </h6>\r\n\r\n// // // // // //           {/* üß† Conditional rendering for MCQ / Theory */}\r\n// // // // // //           {currentQ.questionType === \"MCQ\" && currentQ.options?.length > 0 ? (\r\n// // // // // //             <div className=\"options-container\">\r\n// // // // // //               {currentQ.options.map((opt, i) => (\r\n// // // // // //                 <label\r\n// // // // // //                   key={i}\r\n// // // // // //                   className={`option-item ${\r\n// // // // // //                     selectedAnswer === opt ? \"selected\" : \"\"\r\n// // // // // //                   }`}\r\n// // // // // //                 >\r\n// // // // // //                   <input\r\n// // // // // //                     type=\"radio\"\r\n// // // // // //                     name={`question-${currentQ._id}`}\r\n// // // // // //                     value={opt}\r\n// // // // // //                     checked={selectedAnswer === opt}\r\n// // // // // //                     onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// // // // // //                   />\r\n// // // // // //                   {opt}\r\n// // // // // //                 </label>\r\n// // // // // //               ))}\r\n// // // // // //             </div>\r\n// // // // // //           ) : (\r\n// // // // // //             <textarea\r\n// // // // // //               className=\"theory-input\"\r\n// // // // // //               placeholder=\"Type your answer here...\"\r\n// // // // // //               value={selectedAnswer}\r\n// // // // // //               onChange={(e) => handleSelect(currentQ._id, e.target.value)}\r\n// // // // // //               rows={5}\r\n// // // // // //             ></textarea>\r\n// // // // // //           )}\r\n// // // // // //         </div>\r\n\r\n// // // // // //         <div className=\"test-footer\">\r\n// // // // // //           <div>\r\n// // // // // //             <button\r\n// // // // // //               className=\"btn btn-secondary me-3\"\r\n// // // // // //               onClick={goPrev}\r\n// // // // // //               disabled={currentIdx === 0}\r\n// // // // // //             >\r\n// // // // // //               Previous\r\n// // // // // //             </button>\r\n// // // // // //             <button\r\n// // // // // //               className=\"btn btn-secondary\"\r\n// // // // // //               onClick={goNext}\r\n// // // // // //               disabled={currentIdx === questions.length - 1}\r\n// // // // // //             >\r\n// // // // // //               Next\r\n// // // // // //             </button>\r\n// // // // // //           </div>\r\n\r\n// // // // // //           <div>\r\n// // // // // //             {/* <button\r\n// // // // // //               className=\"btn btn-danger me-2\"\r\n// // // // // //               onClick={() => {\r\n// // // // // //                 if (window.confirm(\"Are you sure you want to abandon this test?\"))\r\n// // // // // //                   navigate(\"/\");\r\n// // // // // //               }}\r\n// // // // // //             >\r\n// // // // // //               Abandon\r\n// // // // // //             </button> */}\r\n// // // // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>\r\n// // // // // //               Submit Test\r\n// // // // // //             </button>\r\n// // // // // //           </div>\r\n// // // // // //         </div>\r\n// // // // // //       </div>\r\n// // // // // //     </div>\r\n// // // // // //   );\r\n// // // // // // }\r\n\r\n// // // // // // import React, { useEffect, useState } from \"react\";\r\n// // // // // // import { useLocation, useNavigate } from \"react-router-dom\";\r\n// // // // // // import API from \"../services/api\";\r\n// // // // // // import QuestionCard from \"../components/QuestionCard\";\r\n// // // // // // import \"../styles/TestPage.css\";\r\n\r\n// // // // // // function pickRandom(arr, n) {\r\n// // // // // //   const copy = [...arr];\r\n// // // // // //   const res = [];\r\n// // // // // //   while (res.length < n && copy.length > 0) {\r\n// // // // // //     const idx = Math.floor(Math.random() * copy.length);\r\n// // // // // //     res.push(copy.splice(idx, 1)[0]);\r\n// // // // // //   }\r\n// // // // // //   return res;\r\n// // // // // // }\r\n\r\n// // // // // // export default function TestPage() {\r\n// // // // // //   const location = useLocation();\r\n// // // // // //   const navigate = useNavigate();\r\n// // // // // //   const { fullName, email, numQ } = location.state || {};\r\n// // // // // //   const [allQuestions, setAllQuestions] = useState([]);\r\n// // // // // //   const [questions, setQuestions] = useState([]);\r\n// // // // // //   const [answers, setAnswers] = useState({});\r\n// // // // // //   const [currentIdx, setCurrentIdx] = useState(0);\r\n// // // // // //   const [loading, setLoading] = useState(true);\r\n// // // // // //   const [submitted, setSubmitted] = useState(false);\r\n// // // // // //   const [score, setScore] = useState(0);\r\n// // // // // //   const [resultSaved, setResultSaved] = useState(false);\r\n\r\n// // // // // //   useEffect(() => {\r\n// // // // // //     if (!fullName || !email) {\r\n// // // // // //       navigate(\"/\");\r\n// // // // // //       return;\r\n// // // // // //     }\r\n\r\n// // // // // //     const fetchQuestions = async () => {\r\n// // // // // //       try {\r\n// // // // // //         const res = await API.get(\"/questions\");\r\n// // // // // //         setAllQuestions(res.data || []);\r\n// // // // // //       } catch (err) {\r\n// // // // // //         console.error(err);\r\n// // // // // //         alert(\"Failed to fetch questions from server.\");\r\n// // // // // //       } finally {\r\n// // // // // //         setLoading(false);\r\n// // // // // //       }\r\n// // // // // //     };\r\n\r\n// // // // // //     fetchQuestions();\r\n// // // // // //   }, [fullName, email, navigate]);\r\n\r\n// // // // // //   useEffect(() => {\r\n// // // // // //     if (!loading && allQuestions.length > 0) {\r\n// // // // // //       const selected = pickRandom(allQuestions, Math.min(numQ || 10, allQuestions.length));\r\n// // // // // //       setQuestions(selected);\r\n// // // // // //     }\r\n// // // // // //   }, [loading, allQuestions, numQ]);\r\n\r\n// // // // // //   const handleSelect = (opt) => {\r\n// // // // // //     const q = questions[currentIdx];\r\n// // // // // //     setAnswers({ ...answers, [q._id]: opt });\r\n// // // // // //   };\r\n\r\n// // // // // //   const goNext = () => {\r\n// // // // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\r\n// // // // // //   };\r\n// // // // // //   const goPrev = () => {\r\n// // // // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\r\n// // // // // //   };\r\n\r\n// // // // // //   const handleSubmit = async () => {\r\n// // // // // //     if (Object.keys(answers).length < questions.length) {\r\n// // // // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\r\n// // // // // //     }\r\n\r\n// // // // // //     // calculate score\r\n// // // // // //     let s = 0;\r\n// // // // // //     questions.forEach((q) => {\r\n// // // // // //       if (answers[q._id] && answers[q._id] === q.correctAnswer) s += 1;\r\n// // // // // //     });\r\n// // // // // //     setScore(s);\r\n// // // // // //     setSubmitted(true);\r\n\r\n// // // // // //     // format answers for backend\r\n// // // // // //     const formattedAnswers = questions.map((q) => ({\r\n// // // // // //       question: q.questionText,\r\n// // // // // //       userAnswer: answers[q._id] || \"Not answered\",\r\n// // // // // //       correctAnswer: q.correctAnswer,\r\n// // // // // //       isCorrect: answers[q._id] === q.correctAnswer,\r\n// // // // // //     }));\r\n\r\n// // // // // //     try {\r\n// // // // // //       await API.post(\"/tests\", {\r\n// // // // // //         name: fullName,\r\n// // // // // //         email,\r\n// // // // // //         answers: formattedAnswers,\r\n// // // // // //       });\r\n// // // // // //       setResultSaved(true);\r\n// // // // // //     } catch (err) {\r\n// // // // // //       console.error(\"Error saving result:\", err);\r\n// // // // // //       alert(\"Failed to save result to server.\");\r\n// // // // // //     }\r\n// // // // // //   };\r\n\r\n// // // // // //   if (loading) return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\r\n// // // // // //   if (!questions || questions.length === 0)\r\n// // // // // //     return <div className=\"container container-center\">No questions available. Please try later.</div>;\r\n\r\n// // // // // //   if (submitted) {\r\n// // // // // //     return (\r\n// // // // // //       <div className=\"container container-center\">\r\n// // // // // //         <div className=\"card card-clean p-4\">\r\n// // // // // //           <h3 className=\"text-success\">Test Completed Successfully</h3>\r\n// // // // // //           <p><strong>{fullName}</strong> ({email})</p>\r\n// // // // // //           <h4>Your Score: {score} / {questions.length}</h4>\r\n\r\n// // // // // //           {resultSaved && (\r\n// // // // // //             <div className=\"alert alert-success mt-2\">\r\n// // // // // //               ‚úÖ Your result has been recorded successfully!\r\n// // // // // //             </div>\r\n// // // // // //           )}\r\n\r\n// // // // // //           <hr />\r\n// // // // // //           <h5>Review Answers</h5>\r\n// // // // // //           <div>\r\n// // // // // //             {questions.map((q, idx) => (\r\n// // // // // //               <div className=\"mb-3\" key={q._id}>\r\n// // // // // //                 <b>Q{idx + 1}:</b> {q.questionText}\r\n// // // // // //                 <div>\r\n// // // // // //                   Your answer:{\" \"}\r\n// // // // // //                   <span\r\n// // // // // //                     className={\r\n// // // // // //                       answers[q._id] === q.correctAnswer\r\n// // // // // //                         ? \"text-success\"\r\n// // // // // //                         : \"text-danger\"\r\n// // // // // //                     }\r\n// // // // // //                   >\r\n// // // // // //                     {answers[q._id] || \"Not answered\"}\r\n// // // // // //                   </span>\r\n// // // // // //                 </div>\r\n// // // // // //                 <div>\r\n// // // // // //                   Correct answer:{\" \"}\r\n// // // // // //                   <span className=\"text-success\">{q.correctAnswer}</span>\r\n// // // // // //                 </div>\r\n// // // // // //               </div>\r\n// // // // // //             ))}\r\n// // // // // //           </div>\r\n\r\n// // // // // //           <div className=\"mt-3\">\r\n// // // // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>\r\n// // // // // //               Back to Home\r\n// // // // // //             </button>\r\n// // // // // //             <button className=\"btn btn-outline-secondary\" onClick={() => window.location.reload()}>\r\n// // // // // //               Retake Test\r\n// // // // // //             </button>\r\n// // // // // //           </div>\r\n// // // // // //         </div>\r\n// // // // // //       </div>\r\n// // // // // //     );\r\n// // // // // //   }\r\n\r\n// // // // // //   const currentQ = questions[currentIdx];\r\n// // // // // //   const selectedForCurrent = answers[currentQ._id];\r\n\r\n// // // // // //   return (\r\n// // // // // //     <div className=\"container container-center\">\r\n// // // // // //       <div className=\"card card-clean p-4\">\r\n// // // // // //         <div className=\"d-flex justify-content-between align-items-start\">\r\n// // // // // //           <div>\r\n// // // // // //             <h5 className=\"mb-0\">Candidate: {fullName}</h5>\r\n// // // // // //             <small className=\"text-muted\">{email}</small>\r\n// // // // // //           </div>\r\n// // // // // //           <div>\r\n// // // // // //             <span className=\"badge bg-primary\">\r\n// // // // // //               Question {currentIdx + 1} / {questions.length}\r\n// // // // // //             </span>\r\n// // // // // //           </div>\r\n// // // // // //         </div>\r\n\r\n// // // // // //         <div className=\"mt-4\">\r\n// // // // // //           <QuestionCard\r\n// // // // // //             question={currentQ}\r\n// // // // // //             selectedAnswer={selectedForCurrent}\r\n// // // // // //             onSelect={handleSelect}\r\n// // // // // //           />\r\n// // // // // //         </div>\r\n\r\n// // // // // //         <div className=\"mt-3 d-flex justify-content-between\">\r\n// // // // // //           <div>\r\n// // // // // //             <button\r\n// // // // // //               className=\"btn btn-secondary me-2\"\r\n// // // // // //               onClick={goPrev}\r\n// // // // // //               disabled={currentIdx === 0}\r\n// // // // // //             >\r\n// // // // // //               Previous\r\n// // // // // //             </button>\r\n// // // // // //             <button\r\n// // // // // //               className=\"btn btn-secondary\"\r\n// // // // // //               onClick={goNext}\r\n// // // // // //               disabled={currentIdx === questions.length - 1}\r\n// // // // // //             >\r\n// // // // // //               Next\r\n// // // // // //             </button>\r\n// // // // // //           </div>\r\n\r\n// // // // // //           <div>\r\n// // // // // //             <button\r\n// // // // // //               className=\"btn btn-danger me-2\"\r\n// // // // // //               onClick={() => {\r\n// // // // // //                 if (window.confirm(\"Are you sure you want to abandon this test?\"))\r\n// // // // // //                   navigate(\"/\");\r\n// // // // // //               }}\r\n// // // // // //             >\r\n// // // // // //               Abandon\r\n// // // // // //             </button>\r\n\r\n// // // // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>\r\n// // // // // //               Submit Test\r\n// // // // // //             </button>\r\n// // // // // //           </div>\r\n// // // // // //         </div>\r\n// // // // // //       </div>\r\n// // // // // //     </div>\r\n// // // // // //   );\r\n// // // // // // }\r\n\r\n// // // // // // // import React, { useEffect, useState } from \"react\";\r\n// // // // // // // import { useLocation, useNavigate } from \"react-router-dom\";\r\n// // // // // // // import API from \"../services/api\";\r\n// // // // // // // import QuestionCard from \"../components/QuestionCard\";\r\n// // // // // // // import \"../styles/TestPage.css\";\r\n\r\n// // // // // // // function pickRandom(arr, n) {\r\n// // // // // // //   const copy = [...arr];\r\n// // // // // // //   const res = [];\r\n// // // // // // //   while (res.length < n && copy.length > 0) {\r\n// // // // // // //     const idx = Math.floor(Math.random() * copy.length);\r\n// // // // // // //     res.push(copy.splice(idx, 1)[0]);\r\n// // // // // // //   }\r\n// // // // // // //   return res;\r\n// // // // // // // }\r\n\r\n// // // // // // // export default function TestPage() {\r\n// // // // // // //   const location = useLocation();\r\n// // // // // // //   const navigate = useNavigate();\r\n// // // // // // //   const { fullName, email, numQ } = location.state || {};\r\n// // // // // // //   const [allQuestions, setAllQuestions] = useState([]);\r\n// // // // // // //   const [questions, setQuestions] = useState([]);\r\n// // // // // // //   const [answers, setAnswers] = useState({}); // { questionId: selectedOption }\r\n// // // // // // //   const [currentIdx, setCurrentIdx] = useState(0);\r\n// // // // // // //   const [loading, setLoading] = useState(true);\r\n// // // // // // //   const [submitted, setSubmitted] = useState(false);\r\n// // // // // // //   const [score, setScore] = useState(0);\r\n\r\n// // // // // // //   useEffect(() => {\r\n// // // // // // //     if (!fullName || !email) {\r\n// // // // // // //       // if page opened without details -> back to home\r\n// // // // // // //       navigate(\"/\");\r\n// // // // // // //       return;\r\n// // // // // // //     }\r\n\r\n// // // // // // //     const fetchQuestions = async () => {\r\n// // // // // // //       try {\r\n// // // // // // //         const res = await API.get(\"/questions\");\r\n// // // // // // //         setAllQuestions(res.data || []);\r\n// // // // // // //       } catch (err) {\r\n// // // // // // //         console.error(err);\r\n// // // // // // //         alert(\"Failed to fetch questions from server.\");\r\n// // // // // // //       } finally {\r\n// // // // // // //         setLoading(false);\r\n// // // // // // //       }\r\n// // // // // // //     };\r\n\r\n// // // // // // //     fetchQuestions();\r\n// // // // // // //   }, [fullName, email, navigate]);\r\n\r\n// // // // // // //   useEffect(() => {\r\n// // // // // // //     if (!loading && allQuestions.length > 0) {\r\n// // // // // // //       const chunk = pickRandom(allQuestions, Math.min(numQ || 10, allQuestions.length));\r\n// // // // // // //       setQuestions(chunk);\r\n// // // // // // //     }\r\n// // // // // // //   }, [loading, allQuestions, numQ]);\r\n\r\n// // // // // // //   const handleSelect = (opt) => {\r\n// // // // // // //     const q = questions[currentIdx];\r\n// // // // // // //     setAnswers({ ...answers, [q._id]: opt });\r\n// // // // // // //   };\r\n\r\n// // // // // // //   const goNext = () => {\r\n// // // // // // //     if (currentIdx < questions.length - 1) setCurrentIdx(currentIdx + 1);\r\n// // // // // // //   };\r\n// // // // // // //   const goPrev = () => {\r\n// // // // // // //     if (currentIdx > 0) setCurrentIdx(currentIdx - 1);\r\n// // // // // // //   };\r\n\r\n// // // // // // //   const handleSubmit = () => {\r\n// // // // // // //     // ensure all answered\r\n// // // // // // //     if (Object.keys(answers).length < questions.length) {\r\n// // // // // // //       if (!window.confirm(\"Some questions are unanswered. Submit anyway?\")) return;\r\n// // // // // // //     }\r\n\r\n// // // // // // //     // compute score\r\n// // // // // // //     let s = 0;\r\n// // // // // // //     questions.forEach((q) => {\r\n// // // // // // //       if (answers[q._id] && answers[q._id] === q.correctAnswer) s += 1;\r\n// // // // // // //     });\r\n// // // // // // //     setScore(s);\r\n// // // // // // //     setSubmitted(true);\r\n// // // // // // //   };\r\n\r\n// // // // // // //   if (loading) return <div className=\"container container-center\">Loading questions‚Ä¶</div>;\r\n// // // // // // //   if (!questions || questions.length === 0) return <div className=\"container container-center\">No questions available. Please try later.</div>;\r\n\r\n// // // // // // //   if (submitted) {\r\n// // // // // // //     return (\r\n// // // // // // //       <div className=\"container container-center\">\r\n// // // // // // //         <div className=\"card card-clean p-4\">\r\n// // // // // // //           <h3>Test Completed</h3>\r\n// // // // // // //           <p><strong>{fullName}</strong> ({email})</p>\r\n// // // // // // //           <h4>Your score: {score} out of {questions.length}</h4>\r\n// // // // // // //           <hr />\r\n// // // // // // //           <h5>Review</h5>\r\n// // // // // // //           <div>\r\n// // // // // // //             {questions.map((q, idx) => (\r\n// // // // // // //               <div className=\"mb-3\" key={q._id}>\r\n// // // // // // //                 <b>Q{idx + 1}:</b> {q.questionText}\r\n// // // // // // //                 <div>Your answer: <span className={answers[q._id] === q.correctAnswer ? \"text-success\" : \"text-danger\"}>{answers[q._id] || \"Not answered\"}</span></div>\r\n// // // // // // //                 <div>Correct answer: <span className=\"text-success\">{q.correctAnswer}</span></div>\r\n// // // // // // //               </div>\r\n// // // // // // //             ))}\r\n// // // // // // //           </div>\r\n\r\n// // // // // // //           <div className=\"mt-3\">\r\n// // // // // // //             <button className=\"btn btn-primary me-2\" onClick={() => navigate(\"/\")}>Back to Home</button>\r\n// // // // // // //             <button className=\"btn btn-outline-secondary\" onClick={() => window.location.reload()}>Take New Test</button>\r\n// // // // // // //           </div>\r\n// // // // // // //         </div>\r\n// // // // // // //       </div>\r\n// // // // // // //     );\r\n// // // // // // //   }\r\n\r\n// // // // // // //   const currentQ = questions[currentIdx];\r\n// // // // // // //   const selectedForCurrent = answers[currentQ._id];\r\n\r\n// // // // // // //   return (\r\n// // // // // // //     <div className=\"container container-center\">\r\n// // // // // // //       <div className=\"card card-clean p-4\">\r\n// // // // // // //         <div className=\"d-flex justify-content-between align-items-start\">\r\n// // // // // // //           <div>\r\n// // // // // // //             <h5 className=\"mb-0\">Candidate: {fullName}</h5>\r\n// // // // // // //             <small className=\"text-muted\">{email}</small>\r\n// // // // // // //           </div>\r\n// // // // // // //           <div>\r\n// // // // // // //             <span className=\"badge bg-primary\">Question {currentIdx + 1} / {questions.length}</span>\r\n// // // // // // //           </div>\r\n// // // // // // //         </div>\r\n\r\n// // // // // // //         <div className=\"mt-4\">\r\n// // // // // // //           <QuestionCard question={currentQ} selectedAnswer={selectedForCurrent} onSelect={handleSelect} />\r\n// // // // // // //         </div>\r\n\r\n// // // // // // //         <div className=\"mt-3 d-flex justify-content-between\">\r\n// // // // // // //           <div>\r\n// // // // // // //             <button className=\"btn btn-secondary me-2\" onClick={goPrev} disabled={currentIdx === 0}>Previous</button>\r\n// // // // // // //             <button className=\"btn btn-secondary\" onClick={goNext} disabled={currentIdx === questions.length - 1}>Next</button>\r\n// // // // // // //           </div>\r\n\r\n// // // // // // //           <div>\r\n// // // // // // //             <button className=\"btn btn-danger me-2\" onClick={() => {\r\n// // // // // // //               if (window.confirm(\"Are you sure you want to abandon this test?\")) navigate(\"/\");\r\n// // // // // // //             }}>Abandon</button>\r\n\r\n// // // // // // //             <button className=\"btn btn-success\" onClick={handleSubmit}>Submit Test</button>\r\n// // // // // // //           </div>\r\n// // // // // // //         </div>\r\n// // // // // // //       </div>\r\n// // // // // // //     </div>\r\n// // // // // // //   );\r\n// // // // // // // }\r\n"],"mappings":"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AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA/I,EAAA,CAvgGwBD,QAAQ;EAAA,QACbL,WAAW,EACXC,WAAW;AAAA;AAAAmK,EAAA,GAFN/J,QAAQ;AAAA,IAAA+J,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}